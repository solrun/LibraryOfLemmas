   [("Firewall_Common.optimize_matches_simple_ruleset",
     "simple_ruleset ?rs ==> simple_ruleset (optimize_matches ?f ?rs)",
     template_implication
      ([template_predicate
         (template_app (template_hole 1, template_var 1))],
       template_predicate
        (
           template_app
            (template_hole 1,
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("Firewall_Common.optimize_matches_a_simple_ruleset",
     "simple_ruleset ?rs ==> simple_ruleset (optimize_matches_a ?f ?rs)",
     template_implication
      ([template_predicate
         (template_app (template_hole 1, template_var 1))],
       template_predicate
        (
           template_app
            (template_hole 1,
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("Firewall_Common.optimize_matches_option_simple_ruleset",
     "simple_ruleset ?rs ==>
      simple_ruleset (optimize_matches_option ?f ?rs)",
     template_implication
      ([template_predicate
         (template_app (template_hole 1, template_var 1))],
       template_predicate
        (
           template_app
            (template_hole 1,
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("Firewall_Common.simple_ruleset_tail",
     "simple_ruleset (?r # ?rs) ==> simple_ruleset ?rs",
     template_implication
      ([template_predicate
         (
            template_app
             (template_hole 1,
              template_app
               (template_app (template_hole 0, template_var 1),
                template_var 0))
            )],
       template_predicate
        (template_app (template_hole 1, template_var 0)))),
    ("Firewall_Common.simple_ruleset_append",
     "simple_ruleset (?rs\<^sub>1 @ ?rs\<^sub>2) =
      (simple_ruleset ?rs\<^sub>1 & simple_ruleset ?rs\<^sub>2)",
     template_equation
      (template_app
        (template_hole 2,
         template_app
          (template_app (template_hole 1, template_var 1), template_var 0)),
       template_app
        (template_app
          (template_hole 0, template_app (template_hole 2, template_var 1)),
         template_app (template_hole 2, template_var 0)))),
    ("Firewall_Common.rm_LogEmpty_seq",
     "rm_LogEmpty (?rs1.0 @ ?rs2.0) =
      rm_LogEmpty ?rs1.0 @ rm_LogEmpty ?rs2.0",
     template_equation
      (template_app
        (template_hole 1,
         template_app
          (template_app (template_hole 0, template_var 1), template_var 0)),
       template_app
        (template_app
          (template_hole 0, template_app (template_hole 1, template_var 1)),
         template_app (template_hole 1, template_var 0)))),
    ("Firewall_Common.matachAny_matchNone",
     "~ has_primitive ?m ==>
      matcheq_matchAny ?m = (~ matcheq_matchNone ?m)",
     template_implication
      ([template_negation
         (
            template_predicate
             (template_app (template_hole 3, template_var 0))
            )],
       template_equation
        (template_app (template_hole 1, template_var 0),
         template_app
          (template_hole 4,
           template_app (template_hole 0, template_var 0))))),
    ("Firewall_Common.matcheq_matchNone_no_primitive",
     "~ has_primitive ?m ==>
      matcheq_matchNone (MatchNot ?m) = (~ matcheq_matchNone ?m)",
     template_implication
      ([template_negation
         (
            template_predicate
             (template_app (template_hole 3, template_var 0))
            )],
       template_equation
        (template_app
          (template_hole 1, template_app (template_hole 0, template_var 0)),
         template_app
          (template_hole 4,
           template_app (template_hole 1, template_var 0))))),
    ("Firewall_Common.optimize_matches_append",
     "optimize_matches ?f (?rs1.0 @ ?rs2.0) =
      optimize_matches ?f ?rs1.0 @ optimize_matches ?f ?rs2.0",
     template_equation
      (template_app
        (template_app (template_hole 1, template_var 2),
         template_app
          (template_app (template_hole 0, template_var 1), template_var 0)),
       template_app
        (template_app
          (template_hole 0,
           template_app
            (template_app (template_hole 1, template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 1, template_var 2),
           template_var 0)))),
    ("Firewall_Common.optimize_matches_option_append",
     "optimize_matches_option ?f (?rs1.0 @ ?rs2.0) =
      optimize_matches_option ?f ?rs1.0 @
      optimize_matches_option ?f ?rs2.0",
     template_equation
      (template_app
        (template_app (template_hole 1, template_var 2),
         template_app
          (template_app (template_hole 0, template_var 1), template_var 0)),
       template_app
        (template_app
          (template_hole 0,
           template_app
            (template_app (template_hole 1, template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 1, template_var 2),
           template_var 0)))),
    ("Firewall_Common.optimize_matches_fst",
     "optimize_matches ?f (?r # ?rs) =
      optimize_matches ?f [?r] @ optimize_matches ?f ?rs",
     template_equation
      (template_app
        (template_app (template_hole 3, template_var 2),
         template_app
          (template_app (template_hole 2, template_var 1), template_var 0)),
       template_app
        (template_app
          (template_hole 1,
           template_app
            (template_app (template_hole 3, template_var 2),
             template_app
              (template_app (template_hole 2, template_var 1),
               template_hole 0))),
         template_app
          (template_app (template_hole 3, template_var 2),
           template_var 0)))),
    ("Firewall_Common.rm_LogEmpty_filter",
     "rm_LogEmpty ?rs =
      filter (%r. get_action r ~= Log & get_action r ~= Empty) ?rs",
     template_equation
      (template_app (template_hole 7, template_var 0),
       template_app
        (template_app (template_hole 6, t_empty), template_var 0))),
    ("Firewall_Common.optimize_matches_preserves",
     "(!!r. r : set ?rs ==> ?P (?f (get_match r))) ==>
      ALL r:set (optimize_matches ?f ?rs). ?P (get_match r)",
     template_implication
      ([template_predicate (template_app (template_hole 6, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 1,
               template_app
                (template_hole 3,
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2))),
             t_empty)
           ))),
    ("Firewall_Common.optimize_matches_a_preserves",
     "(!!r. r : set ?rs ==> ?P (?f (get_action r) (get_match r))) ==>
      ALL r:set (optimize_matches_a ?f ?rs). ?P (get_match r)",
     template_implication
      ([template_predicate (template_app (template_hole 7, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 1,
               template_app
                (template_hole 4,
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2))),
             t_empty)
           ))),
    ("Firewall_Common.optimize_matches_option_preserves",
     "(!!r m. [| r : set ?rs; ?f (get_match r) = Some m |] ==> ?P m) ==>
      ALL r:set (optimize_matches_option ?f ?rs). ?P (get_match r)",
     template_implication
      ([template_predicate (template_app (template_hole 9, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 1,
               template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 0, template_var 1),
                   template_var 2))),
             t_empty)
           ))),
    ("Firewall_Common.optimize_matches_a_simple_ruleset_eq",
     "[| simple_ruleset ?rs;
         !!m a. a = Accept | a = Drop ==> ?f1.0 a m = ?f2.0 a m |]
      ==> optimize_matches_a ?f1.0 ?rs = optimize_matches_a ?f2.0 ?rs",
     template_implication
      ([template_predicate (template_app (template_hole 9, template_var 2)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 1), template_var 2),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 2)))),
    ("Firewall_Common.rules_singleton_rev_E",
     "[| [Rule ?m ?a] = ?rs\<^sub>1 @ ?rs\<^sub>2;
         [| ?rs\<^sub>1 = [Rule ?m ?a]; ?rs\<^sub>2 = [] |] ==> ?P ?m ?a;
         [| ?rs\<^sub>1 = []; ?rs\<^sub>2 = [Rule ?m ?a] |] ==> ?P ?m ?a |]
      ==> ?P ?m ?a",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 3,
              template_app
               (template_app (template_hole 2, template_var 4),
                template_var 3)),
            template_hole 1),
          template_app
           (template_app (template_hole 0, template_var 2),
            template_var 1)),
        template_implication
         ([template_equation
            (template_var 2,
             template_app
              (template_app
                (template_hole 3,
                 template_app
                  (template_app (template_hole 2, template_var 4),
                   template_var 3)),
               template_hole 1))],
          template_implication
           ([template_equation (template_var 1, template_hole 1)],
            template_predicate
             (
                template_app
                 (template_app (template_var 0, template_var 4),
                  template_var 3)
                ))),
        template_implication
         ([template_equation (template_var 2, template_hole 1)],
          template_implication
           ([template_equation
              (template_var 1,
               template_app
                (template_app
                  (template_hole 3,
                   template_app
                    (template_app (template_hole 2, template_var 4),
                     template_var 3)),
                 template_hole 1))],
            template_predicate
             (
                template_app
                 (template_app (template_var 0, template_var 4),
                  template_var 3)
                )))],
       template_predicate
        (
           template_app
            (template_app (template_var 0, template_var 4), template_var 3)
           )))]
