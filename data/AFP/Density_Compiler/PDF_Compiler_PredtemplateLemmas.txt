   [("PDF_Compiler_Pred.prob_space_empty_dens_ctxt",
     "prob_space
       (dens_ctxt_measure ({}, {}, ?\<Gamma>, %_. 1) (%_. undefined))",
     template_predicate
      (
         template_app
          (template_hole 7,
           template_app
            (template_app
              (template_hole 6,
               template_app
                (template_app (template_hole 5, template_hole 4),
                 template_app
                  (template_app (template_hole 3, template_hole 4),
                   template_app
                    (template_app (template_hole 2, template_var 0),
                     t_empty)))),
             t_empty))
         )),
    ("PDF_Compiler_Pred.branch_prob_empty_ctxt",
     "branch_prob ({}, {}, ?\<Gamma>, %_. 1) (%_. undefined) = 1",
     template_equation
      (template_app
        (template_app
          (template_hole 6,
           template_app
            (template_app (template_hole 5, template_hole 4),
             template_app
              (template_app (template_hole 3, template_hole 4),
               template_app
                (template_app (template_hole 2, template_var 0),
                 t_empty)))),
         t_empty),
       template_hole 1)),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Fail ?t \<Rightarrow> (%_ _. 0)",
     template_predicate
      (
         template_app
          (template_app
            (template_app
              (template_hole 5,
               template_app
                (template_app (template_hole 4, template_var 4),
                 template_app
                  (template_app (template_hole 3, template_var 3),
                   template_app
                    (template_app (template_hole 2, template_var 2),
                     template_var 1)))),
             template_app (template_hole 1, template_var 0)),
           t_empty)
         )),
    ("PDF_Compiler_Pred.restrict_state_measure",
     "(%x. restrict x ?V')
      : state_measure (?V Un ?V') ?\<Gamma> \<rightarrow>\<^sub>M
        state_measure ?V' ?\<Gamma>",
     template_predicate
      (
         template_app
          (template_app (template_hole 4, t_empty),
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app
                  (template_hole 1,
                   template_app
                    (template_app (template_hole 0, template_var 1),
                     template_var 2)),
                 template_var 0)),
             template_app
              (template_app (template_hole 1, template_var 2),
               template_var 0)))
         )),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "?x : ?V ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Var ?x \<Rightarrow> marg_dens (?V, ?V', ?\<Gamma>, ?\<delta>) ?x",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 6, template_var 4),
              template_var 3)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 4, template_var 3),
                   template_app
                    (template_app (template_hole 3, template_var 2),
                     template_app
                      (template_app (template_hole 2, template_var 1),
                       template_var 0)))),
               template_app (template_hole 1, template_var 4)),
             template_app
              (template_app
                (template_hole 0,
                 template_app
                  (template_app (template_hole 4, template_var 3),
                   template_app
                    (template_app (template_hole 3, template_var 2),
                     template_app
                      (template_app (template_hole 2, template_var 1),
                       template_var 0)))),
               template_var 4))
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Random ?dst ?e \<Rightarrow> apply_dist_to_dens ?dst ?f",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 5,
                  template_app
                   (template_app (template_hole 4, template_var 6),
                    template_app
                     (template_app (template_hole 3, template_var 5),
                      template_app
                       (template_app (template_hole 2, template_var 4),
                        template_var 3)))),
                template_var 2),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 4, template_var 6),
                   template_app
                    (template_app (template_hole 3, template_var 5),
                     template_app
                      (template_app (template_hole 2, template_var 4),
                       template_var 3)))),
               template_app
                (template_app (template_hole 1, template_var 0),
                 template_var 2)),
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("PDF_Compiler_Pred.has_subprob_density_distr_Fst",
     "has_subprob_density ?M (stock_measure (PRODUCT ?t1.0 ?t2.0)) ?f ==>
      has_subprob_density (distr ?M (stock_measure ?t1.0) (op_sem Fst))
       (stock_measure ?t1.0)
       (%x. \<integral>\<^sup>+ y. ?f <|x, y|>
                               \<partial>stock_measure ?t2.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 7, template_var 3),
                template_app
                 (template_hole 6,
                  template_app
                   (template_app (template_hole 5, template_var 2),
                    template_var 1))),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 7,
                 template_app
                  (template_app
                    (template_app (template_hole 4, template_var 3),
                     template_app (template_hole 6, template_var 2)),
                   template_app (template_hole 3, template_hole 2))),
               template_app (template_hole 6, template_var 2)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.has_subprob_density_distr_Snd",
     "has_subprob_density ?M (stock_measure (PRODUCT ?t1.0 ?t2.0)) ?f ==>
      has_subprob_density (distr ?M (stock_measure ?t2.0) (op_sem Snd))
       (stock_measure ?t2.0)
       (%y. \<integral>\<^sup>+ x. ?f <|x, y|>
                               \<partial>stock_measure ?t1.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 7, template_var 3),
                template_app
                 (template_hole 6,
                  template_app
                   (template_app (template_hole 5, template_var 2),
                    template_var 1))),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 7,
                 template_app
                  (template_app
                    (template_app (template_hole 4, template_var 3),
                     template_app (template_hole 6, template_var 1)),
                   template_app (template_hole 3, template_hole 2))),
               template_app (template_hole 6, template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Minus $$ ?e \<Rightarrow>
       (%\<sigma> x. ?f \<sigma> (op_sem Minus x))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 6,
                  template_app
                   (template_app (template_hole 5, template_var 5),
                    template_app
                     (template_app (template_hole 4, template_var 4),
                      template_app
                       (template_app (template_hole 3, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app (template_hole 5, template_var 5),
                   template_app
                    (template_app (template_hole 4, template_var 4),
                     template_app
                      (template_app (template_hole 3, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 2, template_hole 1),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "countable_type (val_type ?v) ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Val ?v \<Rightarrow>
       (%\<rho> x.
           branch_prob (?V, ?V', ?\<Gamma>, ?\<delta>) \<rho> *
           indicator {?v} x)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_hole 11,
              template_app (template_hole 10, template_var 4))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 9,
                 template_app
                  (template_app (template_hole 8, template_var 3),
                   template_app
                    (template_app (template_hole 7, template_var 2),
                     template_app
                      (template_app (template_hole 6, template_var 1),
                       template_var 0)))),
               template_app (template_hole 5, template_var 4)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.dens_ctxt_measure_empty_bind",
     "[| ?\<rho> : space (state_measure ?V' ?\<Gamma>);
         ?f : state_measure ?V' ?\<Gamma> \<rightarrow>\<^sub>M
              subprob_algebra ?N |]
      ==> dens_ctxt_measure ({}, ?V', ?\<Gamma>, %_. 1) ?\<rho> >>= ?f =
          ?f ?\<rho>",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 13, template_var 4),
              template_app
               (template_hole 12,
                template_app
                 (template_app (template_hole 11, template_var 3),
                  template_var 2)))
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 10, template_var 1),
              template_app
               (template_app
                 (template_hole 9,
                  template_app
                   (template_app (template_hole 11, template_var 3),
                    template_var 2)),
                template_app (template_hole 8, template_var 0)))
            )],
       template_equation
        (template_app
          (template_app
            (template_hole 6,
             template_app
              (template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 4, template_hole 3),
                   template_app
                    (template_app (template_hole 2, template_var 3),
                     template_app
                      (template_app (template_hole 1, template_var 2),
                       t_empty)))),
               template_var 4)),
           template_var 1),
         template_app (template_var 1, template_var 4)))),
    ("PDF_Compiler_Pred.expr_has_density_sound",
     "[| ({}, {}, ?\<Gamma>, %_. 1) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f;
         ?\<Gamma> \<turnstile> ?e : ?t; free_vars ?e = {} |]
      ==> has_subprob_density (expr_sem ?\<sigma> ?e) (stock_measure ?t)
           (?f (%_. undefined))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 12,
                  template_app
                   (template_app (template_hole 11, template_hole 10),
                    template_app
                     (template_app (template_hole 9, template_hole 10),
                      template_app
                       (template_app (template_hole 8, template_var 4),
                        t_empty)))),
                template_var 3),
              template_var 2)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 4),
                template_var 3),
              template_var 1)
            ),
        template_equation
         (template_app (template_hole 4, template_var 3),
          template_hole 10)],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 3,
                 template_app
                  (template_app (template_hole 2, template_var 0),
                   template_var 3)),
               template_app (template_hole 1, template_var 1)),
             template_app (template_var 2, t_empty))
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Fst $$ ?e \<Rightarrow>
       (%\<rho> x.
           \<integral>\<^sup>+ y. ?f \<rho> <|x, y|>
                              \<partial>stock_measure
   (the (expr_type ?\<Gamma> (Snd $$ ?e))))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 5),
                    template_app
                     (template_app (template_hole 9, template_var 4),
                      template_app
                       (template_app (template_hole 8, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app (template_hole 10, template_var 5),
                   template_app
                    (template_app (template_hole 9, template_var 4),
                     template_app
                      (template_app (template_hole 8, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 7, template_hole 6),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Inverse $$ ?e \<Rightarrow>
       (%\<sigma> x.
           ?f \<sigma> (op_sem Inverse x) *
           ennreal ((inverse (extract_real x))\<^sup>2))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 14,
                  template_app
                   (template_app (template_hole 13, template_var 5),
                    template_app
                     (template_app (template_hole 12, template_var 4),
                      template_app
                       (template_app (template_hole 11, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 14,
                 template_app
                  (template_app (template_hole 13, template_var 5),
                   template_app
                    (template_app (template_hole 12, template_var 4),
                     template_app
                      (template_app (template_hole 11, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 10, template_hole 9),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Snd $$ ?e \<Rightarrow>
       (%\<rho> y.
           \<integral>\<^sup>+ x. ?f \<rho> <|x, y|>
                              \<partial>stock_measure
   (the (expr_type ?\<Gamma> (Fst $$ ?e))))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 5),
                    template_app
                     (template_app (template_hole 9, template_var 4),
                      template_app
                       (template_app (template_hole 8, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app (template_hole 10, template_var 5),
                   template_app
                    (template_app (template_hole 9, template_var 4),
                     template_app
                      (template_app (template_hole 8, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 7, template_hole 6),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| randomfree ?e; free_vars ?e <= ?V' |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           Random ?dst ?e \<Rightarrow>
           (%\<rho> x.
               branch_prob (?V, ?V', ?\<Gamma>, ?\<delta>) \<rho> *
               dist_dens ?dst (expr_sem_rf \<rho> ?e) x)",
     template_implication
      ([template_predicate
         (template_app (template_hole 11, template_var 5)),
        template_inequation
         (less_equals, template_app (template_hole 9, template_var 5),
          template_var 4)],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 8,
                 template_app
                  (template_app (template_hole 7, template_var 3),
                   template_app
                    (template_app (template_hole 6, template_var 4),
                     template_app
                      (template_app (template_hole 5, template_var 2),
                       template_var 1)))),
               template_app
                (template_app (template_hole 4, template_var 0),
                 template_var 5)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| ?x : ?V; ?y : ?V; ?x ~= ?y |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           <Var ?x ,  Var ?y> \<Rightarrow>
           marg_dens2 (?V, ?V', ?\<Gamma>, ?\<delta>) ?x ?y",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 5),
              template_var 4)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 3),
              template_var 4)
            ),
        template_negation
         (template_equation (template_var 5, template_var 3))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app (template_hole 5, template_var 4),
                   template_app
                    (template_app (template_hole 4, template_var 2),
                     template_app
                      (template_app (template_hole 3, template_var 1),
                       template_var 0)))),
               template_app
                (template_app
                  (template_hole 2,
                   template_app (template_hole 1, template_var 5)),
                 template_app (template_hole 1, template_var 3))),
             template_app
              (template_app
                (template_app
                  (template_hole 0,
                   template_app
                    (template_app (template_hole 5, template_var 4),
                     template_app
                      (template_app (template_hole 4, template_var 2),
                       template_app
                        (template_app (template_hole 3, template_var 1),
                         template_var 0)))),
                 template_var 5),
               template_var 3))
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Add $$ ?e \<Rightarrow>
       (%\<sigma> z.
           \<integral>\<^sup>+ x. ?f \<sigma>
                                   <|x, op_sem Add <|z, op_sem Minus x|>|>
                              \<partial>stock_measure (val_type z))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 5),
                    template_app
                     (template_app (template_hole 9, template_var 4),
                      template_app
                       (template_app (template_hole 8, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app (template_hole 10, template_var 5),
                   template_app
                    (template_app (template_hole 9, template_var 4),
                     template_app
                      (template_app (template_hole 8, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 7, template_hole 6),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "(?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       ?e \<Rightarrow> ?f ==>
      (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
       Exp $$ ?e \<Rightarrow>
       (%\<sigma> x.
           if 0 < extract_real x
           then ?f \<sigma> (lift_RealVal safe_ln x) *
                ennreal (inverse (extract_real x))
           else 0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 15,
                  template_app
                   (template_app (template_hole 14, template_var 5),
                    template_app
                     (template_app (template_hole 13, template_var 4),
                      template_app
                       (template_app (template_hole 12, template_var 3),
                        template_var 2)))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 15,
                 template_app
                  (template_app (template_hole 14, template_var 5),
                   template_app
                    (template_app (template_hole 13, template_var 4),
                     template_app
                      (template_app (template_hole 12, template_var 3),
                       template_var 2)))),
               template_app
                (template_app (template_hole 11, template_hole 10),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f;
         randomfree ?e'; free_vars ?e' <= ?V' |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           Add $$ <?e ,  ?e'> \<Rightarrow>
           (%\<rho> x.
               ?f \<rho>
                (op_sem Add <|x, expr_sem_rf \<rho> (Minus $$ ?e')|>))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 13,
                  template_app
                   (template_app (template_hole 12, template_var 6),
                    template_app
                     (template_app (template_hole 11, template_var 5),
                      template_app
                       (template_app (template_hole 10, template_var 4),
                        template_var 3)))),
                template_var 2),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 9, template_var 0)),
        template_inequation
         (less_equals, template_app (template_hole 7, template_var 0),
          template_var 5)],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 12, template_var 6),
                   template_app
                    (template_app (template_hole 11, template_var 5),
                     template_app
                      (template_app (template_hole 10, template_var 4),
                       template_var 3)))),
               template_app
                (template_app (template_hole 6, template_hole 5),
                 template_app
                  (template_app (template_hole 4, template_var 2),
                   template_var 0))),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| countable_type (the (expr_type ?\<Gamma> (?oper $$ ?e)));
         (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           ?oper $$ ?e \<Rightarrow>
           (%\<rho> y.
               \<integral>\<^sup>+ x. (if op_sem ?oper x = y then 1
 else 0) *
?f \<rho> x
                                  \<partial>stock_measure
       (the (expr_type ?\<Gamma> ?e)))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_hole 15,
              template_app
               (template_hole 14,
                template_app
                 (template_app (template_hole 13, template_var 6),
                  template_app
                   (template_app (template_hole 12, template_var 5),
                    template_var 4))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 3),
                    template_app
                     (template_app (template_hole 9, template_var 2),
                      template_app
                       (template_app (template_hole 8, template_var 6),
                        template_var 1)))),
                template_var 4),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app (template_hole 10, template_var 3),
                   template_app
                    (template_app (template_hole 9, template_var 2),
                     template_app
                      (template_app (template_hole 8, template_var 6),
                       template_var 1)))),
               template_app
                (template_app (template_hole 12, template_var 5),
                 template_var 4)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| ({}, ?V Un ?V', ?\<Gamma>, %_. 1) \<turnstile>\<^sub>d
          ?e1.0 \<Rightarrow> ?f;
         (shift_var_set ?V, Suc ` ?V',
          case_nat (the (expr_type ?\<Gamma> ?e1.0)) ?\<Gamma>,
          insert_dens ?V ?V' ?f ?\<delta>) \<turnstile>\<^sub>d
          ?e2.0 \<Rightarrow> ?g |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           LET ?e1.0 IN ?e2.0 \<Rightarrow>
           (%\<rho>. ?g (case_nat undefined \<rho>))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 16,
                  template_app
                   (template_app (template_hole 15, template_hole 14),
                    template_app
                     (template_app
                       (template_hole 13,
                        template_app
                         (template_app (template_hole 12, template_var 7),
                          template_var 6)),
                      template_app
                       (template_app (template_hole 11, template_var 5),
                        t_empty)))),
                template_var 4),
              template_var 3)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 16,
                  template_app
                   (template_app
                     (template_hole 15,
                      template_app (template_hole 9, template_var 7)),
                    template_app
                     (template_app
                       (template_hole 13,
                        template_app
                         (template_app (template_hole 8, template_hole 7),
                          template_var 6)),
                      template_app
                       (template_app
                         (template_hole 11,
                          template_app
                           (template_app
                             (template_hole 6,
                              template_app
                               (template_hole 5,
                                template_app
                                 (template_app
                                   (template_hole 4, template_var 5),
                                  template_var 4))),
                            template_var 5)),
                        template_app
                         (template_app
                           (template_app
                             (template_app
                               (template_hole 3, template_var 7),
                              template_var 6),
                            template_var 3),
                          template_var 2))))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 16,
                 template_app
                  (template_app (template_hole 15, template_var 7),
                   template_app
                    (template_app (template_hole 13, template_var 6),
                     template_app
                      (template_app (template_hole 11, template_var 5),
                       template_var 2)))),
               template_app
                (template_app (template_hole 2, template_var 4),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| randomfree ?b;
         (?V, ?V', ?\<Gamma>,
          if_dens_det ?\<delta> ?b True) \<turnstile>\<^sub>d
          ?e1.0 \<Rightarrow> ?g1.0;
         (?V, ?V', ?\<Gamma>,
          if_dens_det ?\<delta> ?b False) \<turnstile>\<^sub>d
          ?e2.0 \<Rightarrow> ?g2.0 |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           IF ?b THEN ?e1.0 ELSE ?e2.0 \<Rightarrow>
           (%\<rho> x. ?g1.0 \<rho> x + ?g2.0 \<rho> x)",
     template_implication
      ([template_predicate (template_app (template_hole 9, template_var 8)),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 8,
                  template_app
                   (template_app (template_hole 7, template_var 7),
                    template_app
                     (template_app (template_hole 6, template_var 6),
                      template_app
                       (template_app (template_hole 5, template_var 5),
                        template_app
                         (template_app
                           (template_app (template_hole 4, template_var 4),
                            template_var 8),
                          template_hole 3))))),
                template_var 3),
              template_var 2)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 8,
                  template_app
                   (template_app (template_hole 7, template_var 7),
                    template_app
                     (template_app (template_hole 6, template_var 6),
                      template_app
                       (template_app (template_hole 5, template_var 5),
                        template_app
                         (template_app
                           (template_app (template_hole 4, template_var 4),
                            template_var 8),
                          template_hole 2))))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 8,
                 template_app
                  (template_app (template_hole 7, template_var 7),
                   template_app
                    (template_app (template_hole 6, template_var 6),
                     template_app
                      (template_app (template_hole 5, template_var 5),
                       template_var 4)))),
               template_app
                (template_app
                  (template_app (template_hole 1, template_var 8),
                   template_var 3),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f;
         val_type ?c = REAL; ?c ~= RealVal 0 |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           Mult $$ <?e ,  Val ?c> \<Rightarrow>
           (%\<rho> x.
               ?f \<rho> (op_sem Mult <|x, op_sem Inverse ?c|>) *
               ennreal (inverse \<bar>extract_real ?c\<bar>))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 22,
                  template_app
                   (template_app (template_hole 21, template_var 6),
                    template_app
                     (template_app (template_hole 20, template_var 5),
                      template_app
                       (template_app (template_hole 19, template_var 4),
                        template_var 3)))),
                template_var 2),
              template_var 1)
            ),
        template_equation
         (template_app (template_hole 17, template_var 0),
          template_hole 16),
        template_negation
         (
            template_equation
             (template_var 0,
              template_app (template_hole 13, template_hole 12))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 22,
                 template_app
                  (template_app (template_hole 21, template_var 6),
                   template_app
                    (template_app (template_hole 20, template_var 5),
                     template_app
                      (template_app (template_hole 19, template_var 4),
                       template_var 3)))),
               template_app
                (template_app (template_hole 11, template_hole 10),
                 template_app
                  (template_app (template_hole 9, template_var 2),
                   template_app (template_hole 8, template_var 0)))),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_sound_aux",
     "[| (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f;
         ?\<Gamma> \<turnstile> ?e : ?t;
         density_context ?V ?V' ?\<Gamma> ?\<delta>;
         free_vars ?e <= ?V Un ?V' |]
      ==> has_parametrized_subprob_density (state_measure ?V' ?\<Gamma>)
           (%\<rho>.
               dens_ctxt_measure (?V, ?V', ?\<Gamma>, ?\<delta>) \<rho> >>=
               (%\<sigma>. expr_sem \<sigma> ?e))
           (stock_measure ?t) ?f",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 14,
                  template_app
                   (template_app (template_hole 13, template_var 6),
                    template_app
                     (template_app (template_hole 12, template_var 5),
                      template_app
                       (template_app (template_hole 11, template_var 4),
                        template_var 3)))),
                template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 10, template_var 4),
                template_var 2),
              template_var 0)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 9, template_var 6),
                  template_var 5),
                template_var 4),
              template_var 3)
            ),
        template_inequation
         (less_equals, template_app (template_hole 7, template_var 2),
          template_app
           (template_app (template_hole 6, template_var 6),
            template_var 5))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_hole 5,
                   template_app
                    (template_app (template_hole 4, template_var 5),
                     template_var 4)),
                 t_empty),
               template_app (template_hole 0, template_var 0)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.addc_density_measurable",
     "[| (%(x, y). ?f x y)
         : borel_measurable
            (state_measure ?V' ?\<Gamma> \<Otimes>\<^sub>M
             stock_measure ?t);
         ?t = REAL | ?t = INTEG; ?\<Gamma> \<turnstile> ?e' : ?t;
         randomfree ?e'; free_vars ?e' <= ?V' |]
      ==> (%(\<rho>, x).
              ?f \<rho>
               (op_sem Add <|x, expr_sem_rf \<rho> (Minus $$ ?e')|>))
          : borel_measurable
             (state_measure ?V' ?\<Gamma> \<Otimes>\<^sub>M
              stock_measure ?t)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 20,
                template_app (template_hole 19, template_var 4)),
              template_app
               (template_app
                 (template_hole 18,
                  template_app
                   (template_app
                     (template_hole 17,
                      template_app
                       (template_app (template_hole 16, template_var 3),
                        template_var 2)),
                    template_app (template_hole 15, template_var 1))),
                template_hole 14))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 13,
                template_app
                 (template_app (template_hole 12, template_var 1),
                  template_hole 11)),
              template_app
               (template_app (template_hole 12, template_var 1),
                template_hole 10))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 9, template_var 2),
                template_var 0),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 8, template_var 0)),
        template_inequation
         (less_equals, template_app (template_hole 6, template_var 0),
          template_var 3)],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 20, template_app (template_hole 19, t_empty)),
             template_app
              (template_app
                (template_hole 18,
                 template_app
                  (template_app
                    (template_hole 17,
                     template_app
                      (template_app (template_hole 16, template_var 3),
                       template_var 2)),
                   template_app (template_hole 15, template_var 1))),
               template_hole 14))
           ))),
    ("PDF_Compiler_Pred.expr_has_density_intros",
     "[| ({}, ?V Un ?V', ?\<Gamma>, %_. 1) \<turnstile>\<^sub>d
          ?b \<Rightarrow> ?f;
         (?V, ?V', ?\<Gamma>,
          if_dens ?\<delta> ?f True) \<turnstile>\<^sub>d
          ?e1.0 \<Rightarrow> ?g1.0;
         (?V, ?V', ?\<Gamma>,
          if_dens ?\<delta> ?f False) \<turnstile>\<^sub>d
          ?e2.0 \<Rightarrow> ?g2.0 |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           IF ?b THEN ?e1.0 ELSE ?e2.0 \<Rightarrow>
           (%\<rho> x. ?g1.0 \<rho> x + ?g2.0 \<rho> x)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_hole 9),
                    template_app
                     (template_app
                       (template_hole 8,
                        template_app
                         (template_app (template_hole 7, template_var 9),
                          template_var 8)),
                      template_app
                       (template_app (template_hole 6, template_var 7),
                        t_empty)))),
                template_var 6),
              template_var 5)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 9),
                    template_app
                     (template_app (template_hole 8, template_var 8),
                      template_app
                       (template_app (template_hole 6, template_var 7),
                        template_app
                         (template_app
                           (template_app (template_hole 4, template_var 4),
                            template_var 5),
                          template_hole 3))))),
                template_var 3),
              template_var 2)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 11,
                  template_app
                   (template_app (template_hole 10, template_var 9),
                    template_app
                     (template_app (template_hole 8, template_var 8),
                      template_app
                       (template_app (template_hole 6, template_var 7),
                        template_app
                         (template_app
                           (template_app (template_hole 4, template_var 4),
                            template_var 5),
                          template_hole 2))))),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app (template_hole 10, template_var 9),
                   template_app
                    (template_app (template_hole 8, template_var 8),
                     template_app
                      (template_app (template_hole 6, template_var 7),
                       template_var 4)))),
               template_app
                (template_app
                  (template_app (template_hole 1, template_var 6),
                   template_var 3),
                 template_var 1)),
             t_empty)
           ))),
    ("PDF_Compiler_Pred.hd_cong",
     "[| (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
          ?e \<Rightarrow> ?f;
         density_context ?V ?V' ?\<Gamma> ?\<delta>;
         ?\<Gamma> \<turnstile> ?e : ?t; free_vars ?e <= ?V Un ?V';
         !!\<rho> x.
            [| \<rho> : space (state_measure ?V' ?\<Gamma>);
               x : space (stock_measure ?t) |]
            ==> ?f \<rho> x = ?f' \<rho> x |]
      ==> (?V, ?V', ?\<Gamma>, ?\<delta>) \<turnstile>\<^sub>d
           ?e \<Rightarrow> ?f'",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_hole 17,
                  template_app
                   (template_app (template_hole 16, template_var 7),
                    template_app
                     (template_app (template_hole 15, template_var 6),
                      template_app
                       (template_app (template_hole 14, template_var 5),
                        template_var 4)))),
                template_var 3),
              template_var 2)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 13, template_var 7),
                  template_var 6),
                template_var 5),
              template_var 4)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 12, template_var 5),
                template_var 3),
              template_var 1)
            ),
        template_inequation
         (less_equals, template_app (template_hole 10, template_var 3),
          template_app
           (template_app (template_hole 9, template_var 7),
            template_var 6)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 17,
                 template_app
                  (template_app (template_hole 16, template_var 7),
                   template_app
                    (template_app (template_hole 15, template_var 6),
                     template_app
                      (template_app (template_hole 14, template_var 5),
                       template_var 4)))),
               template_var 3),
             template_var 0)
           ))),
    ("PDF_Compiler_Pred.expr_has_density_sound_op",
     "[| density_context ?V ?V' ?\<Gamma> ?\<delta>;
         has_parametrized_subprob_density (state_measure ?V' ?\<Gamma>)
          (%\<rho>.
              dens_ctxt_measure (?V, ?V', ?\<Gamma>, ?\<delta>) \<rho> >>=
              (%\<sigma>. expr_sem \<sigma> ?e))
          (stock_measure ?t) ?f;
         (%(x, y). ?g x y)
         : borel_measurable
            (state_measure ?V' ?\<Gamma> \<Otimes>\<^sub>M
             stock_measure ?t');
         !!M \<rho>.
            has_subprob_density M (stock_measure ?t) (?f \<rho>) ==>
            has_density (distr M (stock_measure ?t') (op_sem ?oper))
             (stock_measure ?t') (?g \<rho>);
         ?\<Gamma> \<turnstile> ?e : ?t; op_type ?oper ?t = Some ?t';
         free_vars (?oper $$ ?e) <= ?V Un ?V' |]
      ==> has_parametrized_subprob_density (state_measure ?V' ?\<Gamma>)
           (%\<rho>.
               dens_ctxt_measure (?V, ?V', ?\<Gamma>, ?\<delta>) \<rho> >>=
               (%\<sigma>. expr_sem \<sigma> (?oper $$ ?e)))
           (stock_measure ?t') ?g",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 28, template_var 9),
                  template_var 8),
                template_var 7),
              template_var 6)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app
                   (template_hole 27,
                    template_app
                     (template_app (template_hole 26, template_var 8),
                      template_var 7)),
                  t_empty),
                template_app (template_hole 19, template_var 4)),
              template_var 3)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 18,
                template_app (template_hole 17, template_var 2)),
              template_app
               (template_app
                 (template_hole 16,
                  template_app
                   (template_app
                     (template_hole 15,
                      template_app
                       (template_app (template_hole 26, template_var 8),
                        template_var 7)),
                    template_app (template_hole 19, template_var 1))),
                template_hole 14))
            ),
        template_predicate (template_app (template_hole 13, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 7, template_var 7),
                template_var 5),
              template_var 4)
            ),
        template_equation
         (template_app
           (template_app (template_hole 5, template_var 0), template_var 4),
          template_app (template_hole 4, template_var 1)),
        template_inequation
         (less_equals,
          template_app
           (template_hole 2,
            template_app
             (template_app (template_hole 1, template_var 0),
              template_var 5)),
          template_app
           (template_app (template_hole 0, template_var 9),
            template_var 8))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_hole 27,
                   template_app
                    (template_app (template_hole 26, template_var 8),
                     template_var 7)),
                 t_empty),
               template_app (template_hole 19, template_var 1)),
             template_var 2)
           )))]
