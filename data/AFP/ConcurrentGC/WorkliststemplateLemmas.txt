   [("Worklists.valid_W_invD0",
     "[| ?r : W (?s ?p); valid_W_inv ?s |]
      ==> ?r ~: ghost_honorary_grey (?s ?q)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 3),
              template_app
               (template_hole 3,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 4, template_var 3),
                 template_app
                  (template_hole 0,
                   template_app (template_var 2, template_var 0)))
               )
           ))),
    ("Worklists.valid_W_invD0",
     "[| ?r : ghost_honorary_grey (?s ?p); valid_W_inv ?s |]
      ==> ?r ~: W (?s ?q)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 3),
              template_app
               (template_hole 3,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 4, template_var 3),
                 template_app
                  (template_hole 0,
                   template_app (template_var 2, template_var 0)))
               )
           ))),
    ("Worklists.valid_W_distinct_simps",
     "[| ?r : W (?s ?p); valid_W_inv ?s |]
      ==> (?r : W (?s ?q)) = (?p = ?q)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 3),
              template_app
               (template_hole 3,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 4, template_var 3),
                template_app
                 (template_hole 3,
                  template_app (template_var 2, template_var 0)))
              )],
         template_equation (template_var 1, template_var 0)))),
    ("Worklists.valid_W_distinct_simps",
     "[| ?r : ghost_honorary_grey (?s ?p); valid_W_inv ?s |]
      ==> (?r : ghost_honorary_grey (?s ?q)) = (?p = ?q)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 3),
              template_app
               (template_hole 3,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 4, template_var 3),
                template_app
                 (template_hole 3,
                  template_app (template_var 2, template_var 0)))
              )],
         template_equation (template_var 1, template_var 0)))),
    ("Worklists.valid_W_distinct_simps",
     "[| ?r : WL ?p ?s; valid_W_inv ?s |] ==> (?r : WL ?q ?s) = (?p = ?q)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 3),
              template_app
               (template_app (template_hole 3, template_var 2),
                template_var 1))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 4, template_var 3),
                template_app
                 (template_app (template_hole 3, template_var 0),
                  template_var 1))
              )],
         template_equation (template_var 2, template_var 0)))),
    ("Worklists.valid_W_inv_mo_co_lock",
     "[| valid_W_inv ?s; sys_mem_lock ?s = None |]
      ==> valid_W_inv (?s(sys := ?s sys(| mem_lock := Some ?p |)))",
     template_implication
      ([template_predicate (template_app (template_hole 7, template_var 1)),
        template_equation
         (template_app
           (template_hole 5,
            template_app (template_var 1, template_hole 4)),
          template_hole 3)],
       template_predicate
        (
           template_app
            (template_hole 7,
             template_app
              (template_app
                (template_app (template_hole 2, template_var 1),
                 template_hole 4),
               template_app
                (template_app (template_hole 1, t_empty),
                 template_app (template_var 1, template_hole 4))))
           ))),
    ("Worklists.valid_W_invD0",
     "[| ?r : W (?s ?p); valid_W_inv ?s; ?p ~= ?q |] ==> ?r ~: WL ?q ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 5, template_var 3),
              template_app
               (template_hole 4,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate (template_app (template_hole 3, template_var 2)),
        template_negation
         (template_equation (template_var 1, template_var 0))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 5, template_var 3),
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2))
               )
           ))),
    ("Worklists.valid_W_invD0",
     "[| ?r : ghost_honorary_grey (?s ?p); valid_W_inv ?s; ?p ~= ?q |]
      ==> ?r ~: WL ?q ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 5, template_var 3),
              template_app
               (template_hole 4,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate (template_app (template_hole 3, template_var 2)),
        template_negation
         (template_equation (template_var 1, template_var 0))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 5, template_var 3),
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2))
               )
           ))),
    ("Worklists.valid_W_invE2",
     "[| ?r : W (?s ?p); valid_W_inv ?s;
         !!obj. obj_mark obj = sys_fM ?s ==> ?P obj |]
      ==> obj_at ?P ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 8, template_var 3),
              template_app
               (template_hole 7,
                template_app (template_var 2, template_var 1)))
            ),
        template_predicate (template_app (template_hole 6, template_var 2)),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 3),
             template_var 2)
           ))),
    ("Worklists.valid_W_invE2",
     "[| ?r : ghost_honorary_grey (?s ?p); sys_mem_lock ?s ~= Some ?p;
         valid_W_inv ?s; !!obj. obj_mark obj = sys_fM ?s ==> ?P obj |]
      ==> obj_at ?P ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 12, template_var 3),
              template_app
               (template_hole 11,
                template_app (template_var 2, template_var 1)))
            ),
        template_negation
         (
            template_equation
             (template_app
               (template_hole 8,
                template_app (template_var 2, template_hole 7)),
              template_app (template_hole 6, template_var 1))
            ),
        template_predicate (template_app (template_hole 5, template_var 2)),
        template_predicate (template_app (template_hole 4, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 3),
             template_var 2)
           ))),
    ("Worklists.valid_W_inv_mo_co_W",
     "[| valid_W_inv ?s; marked ?y ?s; ghost_honorary_grey (?s ?p) = {?y};
         ?p ~= sys |]
      ==> valid_W_inv
           (?s(?p := ?s ?p
                 (| W := insert ?y (W (?s ?p)),
                    ghost_honorary_grey := {} |)))",
     template_implication
      ([template_predicate
         (template_app (template_hole 15, template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 14, t_empty), template_var 1),
              template_var 2)
            ),
        template_equation
         (template_app
           (template_hole 8, template_app (template_var 2, template_var 0)),
          template_app
           (template_app (template_hole 7, template_var 1),
            template_hole 6)),
        template_negation
         (template_equation (template_var 0, template_hole 10))],
       template_predicate
        (
           template_app
            (template_hole 15,
             template_app
              (template_app
                (template_app (template_hole 3, template_var 2),
                 template_var 0),
               template_app
                (template_app (template_hole 2, t_empty),
                 template_app
                  (template_app (template_hole 1, t_empty),
                   template_app (template_var 2, template_var 0)))))
           ))),
    ("Worklists.valid_W_inv_ghg_disjoint",
     "[| white ?y ?s; sys_mem_lock ?s = Some ?p; valid_W_inv ?s;
         ?p0.0 ~= ?p1.0 |]
      ==> WL ?p0.0 (?s(?p := ?s ?p(| ghost_honorary_grey := {?y} |))) Int
          WL ?p1.0 (?s(?p := ?s ?p(| ghost_honorary_grey := {?y} |))) =
          {}",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 14, template_var 4),
              template_var 3)
            ),
        template_equation
         (template_app
           (template_hole 12,
            template_app (template_var 3, template_hole 11)),
          template_app (template_hole 10, template_var 2)),
        template_predicate (template_app (template_hole 9, template_var 3)),
        template_negation
         (template_equation (template_var 1, template_var 0))],
       template_equation
        (template_app
          (template_app
            (template_hole 5,
             template_app
              (template_app (template_hole 4, template_var 1),
               template_app
                (template_app
                  (template_app (template_hole 3, template_var 3),
                   template_var 2),
                 template_app
                  (template_app (template_hole 2, t_empty),
                   template_app (template_var 3, template_var 2))))),
           template_app
            (template_app (template_hole 4, template_var 0),
             template_app
              (template_app
                (template_app (template_hole 3, template_var 3),
                 template_var 2),
               template_app
                (template_app (template_hole 2, t_empty),
                 template_app (template_var 3, template_var 2))))),
         template_hole 0))),
    ("Worklists.valid_W_inv_mo_co_unlock",
     "[| sys_mem_lock ?s = Some ?p; sys_mem_store_buffers ?p ?s = [];
         !!r. r : ghost_honorary_grey (?s ?p) ==> marked r ?s;
         valid_W_inv ?s |]
      ==> valid_W_inv (?s(sys := mem_lock_update Map.empty (?s sys)))",
     template_implication
      ([template_equation
         (template_app
           (template_hole 16,
            template_app (template_var 1, template_hole 15)),
          template_app (template_hole 14, template_var 0)),
        template_equation
         (template_app
           (template_app
             (template_hole 12,
              template_app (template_var 1, template_hole 15)),
            template_var 0),
          template_hole 11),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate
         (template_app (template_hole 3, template_var 1))],
       template_predicate
        (
           template_app
            (template_hole 3,
             template_app
              (template_app
                (template_app (template_hole 2, template_var 1),
                 template_hole 15),
               template_app
                (template_app (template_hole 1, t_empty),
                 template_app (template_var 1, template_hole 15))))
           ))),
    ("Worklists.valid_W_inv_sys_mem_store_buffersD",
     "[| sys_mem_store_buffers ?p ?s = mw_Phase ?ph # ?ws;
         mw_Mark ?r ?fl : set ?ws; valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s & filter is_mw_Mark ?ws = [mw_Mark ?r ?fl]",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 21,
              template_app (template_var 5, template_hole 20)),
            template_var 4),
          template_app
           (template_app
             (template_hole 19,
              template_app (template_hole 18, template_var 3)),
            template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 1),
                  template_var 0)),
              template_app (template_hole 15, template_var 2))
            ),
        template_predicate
         (template_app (template_hole 14, template_var 5))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 13,
               template_app
                (template_app (template_hole 12, template_var 0),
                 template_app
                  (template_hole 11,
                   template_app (template_var 5, template_hole 20)))),
             template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 10, template_var 1),
                   template_app
                    (template_hole 9,
                     template_app (template_var 5, template_var 4)))),
               template_app
                (template_app
                  (template_hole 13,
                   template_app
                    (template_app
                      (template_hole 8,
                       template_app
                        (template_hole 7,
                         template_app (template_var 5, template_hole 20))),
                     template_app (template_hole 6, template_var 4))),
                 template_app
                  (template_app
                    (template_hole 13,
                     template_app
                      (template_app (template_hole 5, template_var 1),
                       template_var 5)),
                   template_app
                    (template_app
                      (template_hole 22,
                       template_app
                        (template_app (template_hole 4, t_empty),
                         template_var 2)),
                     template_app
                      (template_app
                        (template_hole 19,
                         template_app
                          (template_app (template_hole 16, template_var 1),
                           template_var 0)),
                       template_hole 0))))))
           ))),
    ("Worklists.valid_W_inv_sys_mem_store_buffersD",
     "[| sys_mem_store_buffers ?p ?s = mw_fA ?fl' # ?ws;
         mw_Mark ?r ?fl : set ?ws; valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s & filter is_mw_Mark ?ws = [mw_Mark ?r ?fl]",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 21,
              template_app (template_var 5, template_hole 20)),
            template_var 4),
          template_app
           (template_app
             (template_hole 19,
              template_app (template_hole 18, template_var 3)),
            template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 1),
                  template_var 0)),
              template_app (template_hole 15, template_var 2))
            ),
        template_predicate
         (template_app (template_hole 14, template_var 5))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 13,
               template_app
                (template_app (template_hole 12, template_var 0),
                 template_app
                  (template_hole 11,
                   template_app (template_var 5, template_hole 20)))),
             template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 10, template_var 1),
                   template_app
                    (template_hole 9,
                     template_app (template_var 5, template_var 4)))),
               template_app
                (template_app
                  (template_hole 13,
                   template_app
                    (template_app
                      (template_hole 8,
                       template_app
                        (template_hole 7,
                         template_app (template_var 5, template_hole 20))),
                     template_app (template_hole 6, template_var 4))),
                 template_app
                  (template_app
                    (template_hole 13,
                     template_app
                      (template_app (template_hole 5, template_var 1),
                       template_var 5)),
                   template_app
                    (template_app
                      (template_hole 22,
                       template_app
                        (template_app (template_hole 4, t_empty),
                         template_var 2)),
                     template_app
                      (template_app
                        (template_hole 19,
                         template_app
                          (template_app (template_hole 16, template_var 1),
                           template_var 0)),
                       template_hole 0))))))
           ))),
    ("Worklists.valid_W_inv_sys_mem_store_buffersD",
     "[| sys_mem_store_buffers ?p ?s = mw_fM ?fl' # ?ws;
         mw_Mark ?r ?fl : set ?ws; valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s & filter is_mw_Mark ?ws = [mw_Mark ?r ?fl]",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 21,
              template_app (template_var 5, template_hole 20)),
            template_var 4),
          template_app
           (template_app
             (template_hole 19,
              template_app (template_hole 18, template_var 3)),
            template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 1),
                  template_var 0)),
              template_app (template_hole 15, template_var 2))
            ),
        template_predicate
         (template_app (template_hole 14, template_var 5))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 13,
               template_app
                (template_app (template_hole 12, template_var 0),
                 template_app
                  (template_hole 11,
                   template_app (template_var 5, template_hole 20)))),
             template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 10, template_var 1),
                   template_app
                    (template_hole 9,
                     template_app (template_var 5, template_var 4)))),
               template_app
                (template_app
                  (template_hole 13,
                   template_app
                    (template_app
                      (template_hole 8,
                       template_app
                        (template_hole 7,
                         template_app (template_var 5, template_hole 20))),
                     template_app (template_hole 6, template_var 4))),
                 template_app
                  (template_app
                    (template_hole 13,
                     template_app
                      (template_app (template_hole 5, template_var 1),
                       template_var 5)),
                   template_app
                    (template_app
                      (template_hole 22,
                       template_app
                        (template_app (template_hole 4, t_empty),
                         template_var 2)),
                     template_app
                      (template_app
                        (template_hole 19,
                         template_app
                          (template_app (template_hole 16, template_var 1),
                           template_var 0)),
                       template_hole 0))))))
           ))),
    ("Worklists.valid_W_inv_sys_mem_store_buffersD",
     "[| sys_mem_store_buffers ?p ?s = mw_Mutate ?r' ?f ?r'' # ?ws;
         mw_Mark ?r ?fl : set ?ws; valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s & filter is_mw_Mark ?ws = [mw_Mark ?r ?fl]",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 21,
              template_app (template_var 7, template_hole 20)),
            template_var 6),
          template_app
           (template_app
             (template_hole 19,
              template_app
               (template_app
                 (template_app (template_hole 18, template_var 5),
                  template_var 4),
                template_var 3)),
            template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 1),
                  template_var 0)),
              template_app (template_hole 15, template_var 2))
            ),
        template_predicate
         (template_app (template_hole 14, template_var 7))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 13,
               template_app
                (template_app (template_hole 12, template_var 0),
                 template_app
                  (template_hole 11,
                   template_app (template_var 7, template_hole 20)))),
             template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 10, template_var 1),
                   template_app
                    (template_hole 9,
                     template_app (template_var 7, template_var 6)))),
               template_app
                (template_app
                  (template_hole 13,
                   template_app
                    (template_app
                      (template_hole 8,
                       template_app
                        (template_hole 7,
                         template_app (template_var 7, template_hole 20))),
                     template_app (template_hole 6, template_var 6))),
                 template_app
                  (template_app
                    (template_hole 13,
                     template_app
                      (template_app (template_hole 5, template_var 1),
                       template_var 7)),
                   template_app
                    (template_app
                      (template_hole 22,
                       template_app
                        (template_app (template_hole 4, t_empty),
                         template_var 2)),
                     template_app
                      (template_app
                        (template_hole 19,
                         template_app
                          (template_app (template_hole 16, template_var 1),
                           template_var 0)),
                       template_hole 0))))))
           ))),
    ("Worklists.valid_W_inv_mo_co_mark",
     "[| valid_W_inv ?s; white ?y ?s; sys_mem_lock ?s = Some ?p;
         filter is_mw_Mark (sys_mem_store_buffers ?p ?s) = []; ?p ~= sys |]
      ==> valid_W_inv
           (?s(?p := ?s ?p(| ghost_honorary_grey := {?y} |),
               sys := ?s sys
                 (| mem_store_buffers := (mem_store_buffers (?s sys))
                      (?p :=
                         sys_mem_store_buffers ?p ?s @
                         [mw_Mark ?y (sys_fM ?s)]) |)))",
     template_implication
      ([template_predicate
         (template_app (template_hole 24, template_var 2)),
        template_predicate
         (
            template_app
             (template_app (template_hole 23, template_var 1),
              template_var 2)
            ),
        template_equation
         (template_app
           (template_hole 21,
            template_app (template_var 2, template_hole 20)),
          template_app (template_hole 19, template_var 0)),
        template_equation
         (template_app
           (template_app (template_hole 17, t_empty),
            template_app
             (template_app
               (template_hole 12,
                template_app (template_var 2, template_hole 20)),
              template_var 0)),
          template_hole 11),
        template_negation
         (template_equation (template_var 0, template_hole 20))],
       template_predicate
        (
           template_app
            (template_hole 24,
             template_app
              (template_app
                (template_app
                  (template_hole 8,
                   template_app
                    (template_app
                      (template_app (template_hole 8, template_var 2),
                       template_var 0),
                     template_app
                      (template_app (template_hole 7, t_empty),
                       template_app (template_var 2, template_var 0)))),
                 template_hole 20),
               template_app
                (template_app (template_hole 4, t_empty),
                 template_app (template_var 2, template_hole 20))))
           )))]
