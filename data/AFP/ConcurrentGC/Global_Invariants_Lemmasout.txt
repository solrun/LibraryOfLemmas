Loading theory "ConcurrentIMP.CIMP_pred" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP")
Loading theory "HOL-Library.Function_Algebras" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs" via "HOL-Library.BigO")
Loading theory "HOL-Library.Case_Converter" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "HOL-Library.Simps_Case_Conv")
Loading theory "HOL-Library.Nat_Bijection" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs" via "HOL-Library.Stream")
instantiation
  fun :: (type, plus) plus
  plus_fun == plus :: ('a => 'b) => ('a => 'b) => 'a => 'b
instantiation
  fun :: (type, zero) zero
  zero_fun == zero_class.zero :: 'a => 'b
instantiation
  fun :: (type, times) times
  times_fun == times :: ('a => 'b) => ('a => 'b) => 'a => 'b
instantiation
  fun :: (type, one) one
  one_fun == one_class.one :: 'a => 'b
Found termination order: "(%p. size (snd p)) <*mlex*> {}"
### theory "HOL-Library.Function_Algebras"
### 0.135s elapsed time, 0.553s cpu time, 0.041s GC time
Loading theory "HOL-Library.Set_Algebras" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs" via "HOL-Library.BigO")
### theory "ConcurrentIMP.CIMP_pred"
### 0.140s elapsed time, 0.575s cpu time, 0.041s GC time
Loading theory "ConcurrentIMP.Infinite_Sequences" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP" via "ConcurrentIMP.CIMP_lang" via "ConcurrentIMP.LTL")
instantiation
  set :: (plus) plus
  plus_set == plus :: 'a set => 'a set => 'a set
instantiation
  set :: (times) times
  times_set == times :: 'a set => 'a set => 'a set
consts
  stake :: "nat => (nat => 'a) => 'a list"
instantiation
  set :: (zero) zero
  zero_set == zero_class.zero :: 'a set
consts
  shift :: "'a list => (nat => 'a) => nat => 'a"
instantiation
  set :: (one) one
  one_set == one_class.one :: 'a set
signature CASE_CONVERTER =
  sig
    type elimination_strategy
    val keep_constructor_context: elimination_strategy
    val replace_by_type:
       (Proof.context -> string * string -> bool) -> elimination_strategy
    val to_case:
       Proof.context ->
         elimination_strategy ->
           (string * typ -> int) -> thm list -> thm list option
  end
structure Case_Converter: CASE_CONVERTER
### theory "HOL-Library.Case_Converter"
### 0.260s elapsed time, 1.052s cpu time, 0.041s GC time
Loading theory "HOL-Library.Simps_Case_Conv" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis")
Found termination order: "size_list size <*mlex*> {}"
### theory "ConcurrentIMP.Infinite_Sequences"
### 0.197s elapsed time, 0.777s cpu time, 0.072s GC time
Loading theory "ConcurrentIMP.LTL" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP" via "ConcurrentIMP.CIMP_lang")
### theory "HOL-Library.Set_Algebras"
### 0.215s elapsed time, 0.848s cpu time, 0.072s GC time
Loading theory "HOL-Library.Sublist" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model")
signature SIMPS_CASE_CONV =
  sig
    val gen_to_simps: Proof.context -> thm list -> thm -> thm list
    val to_case: Proof.context -> thm list -> thm
    val to_simps: Proof.context -> thm -> thm list
  end
structure Simps_Case_Conv: SIMPS_CASE_CONV
### theory "HOL-Library.Simps_Case_Conv"
### 0.110s elapsed time, 0.428s cpu time, 0.072s GC time
Loading theory "HOL-Library.Tree" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs" via "Draft.Templates")
### theory "HOL-Library.Nat_Bijection"
### 0.428s elapsed time, 1.713s cpu time, 0.113s GC time
Loading theory "HOL-Library.Stream" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs")
consts
  prefixes :: "'a list => 'a list list"
### theory "ConcurrentIMP.LTL"
### 0.432s elapsed time, 1.686s cpu time, 0.278s GC time
Loading theory "ConcurrentIMP.CIMP_lang" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP")
Found termination order: "(%p. length (snd p)) <*mlex*> {}"
consts
  shift :: "'a list => 'a stream => 'a stream"
Proofs for coinductive predicate(s) "streamsp"
  Proving monotonicity ...
consts
  left :: "'a tree => 'a tree"
consts
  right :: "'a tree => 'a tree"
consts
  snth :: "'a stream => nat => 'a"
consts
  stake :: "nat => 'a stream => 'a list"
Found termination order: "size <*mlex*> {}"
consts
  sdrop :: "nat => 'a stream => 'a stream"
Found termination order: "size <*mlex*> {}"
consts
  sfilter :: "('a => bool) => 'a stream => 'a stream"
consts
  cycle :: "'a list => 'a stream"
Found termination order: "size <*mlex*> {}"
consts
  suffixes :: "'a list => 'a list list"
consts
  siterate :: "('a => 'a) => 'a => 'a stream"
class height = type +
  fixes height :: "'a => nat"
instantiation
  tree :: (type) height
  height_tree == height :: 'a tree => nat
Proofs for inductive predicate(s) "list_emb"
  Proving monotonicity ...
consts
  flat :: "'a list stream => 'a stream"
Found termination order: "size <*mlex*> {}"
consts
  sinterleave :: "'a stream => 'a stream => 'a stream"
consts
  szip :: "'a stream => 'b stream => ('a * 'b) stream"
Found termination order: "size <*mlex*> {}"
consts
  smap2 :: "('a => 'b => 'c) => 'a stream => 'b stream => 'c stream"
### theory "HOL-Library.Stream"
### 1.185s elapsed time, 4.437s cpu time, 1.147s GC time
Loading theory "HOL-Library.BigO" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs")
Found termination order: "size <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
consts
  sublists :: "'a list => 'a list list"
Found termination order: "(%p. size (fst p)) <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
### theory "HOL-Library.Sublist"
### 1.707s elapsed time, 6.487s cpu time, 1.344s GC time
Found termination order: "(%p. size (snd p)) <*mlex*> {}"
Found termination order: "size <*mlex*> {}"
### theory "HOL-Library.BigO"
### 0.865s elapsed time, 3.062s cpu time, 0.441s GC time
### theory "HOL-Library.Tree"
### 2.246s elapsed time, 8.059s cpu time, 1.655s GC time
Loading theory "Draft.Templates" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.ExtrEqs")
datatype template_term
=
     t_empty
   | template_app of template_term * template_term
   | template_hole of int
   | template_var of int
datatype sign
= equals | greater_equals | greater_than | less_equals | less_than
datatype template
=
     template_bimplication of template * template
   | template_dunno
   | template_equation of template_term * template_term
   | template_implication of template list * template
   | template_inequation of sign * template_term * template_term
   | template_negation of template
   | template_predicate of template_term
constructor t_empty: template_term
constructor template_app: template_term * template_term -> template_term
constructor template_hole: int -> template_term
constructor template_var: int -> template_term
constructor equals: sign
constructor greater_equals: sign
constructor greater_than: sign
constructor less_equals: sign
constructor less_than: sign
constructor template_bimplication: template * template -> template
constructor template_dunno: template
constructor template_equation: template_term * template_term -> template
constructor template_implication: template list * template -> template
constructor template_inequation:
   sign * template_term * template_term -> template
constructor template_negation: template -> template
constructor template_predicate: template_term -> template
val vfs = fn: term -> (indexname * typ) list * (string * typ) list
val indexOf = fn: ''a list -> ''a -> int -> int
val has_eq = fn: term -> bool
val term2template = fn:
   (indexname * typ) list -> (string * typ) list -> term -> template_term
val lemma2predicate = fn: term -> term -> template
val makeTemplatewithContext = fn: term -> term -> template
val lemma2template = fn: term -> template
val thm2template = fn: thm -> template
val tterm2string = fn: template_term -> string
val template2string = fn: template -> string
val t = "height ?t <= size ?t": thm
val th =
   Const ("HOL.Trueprop", "bool => prop") $
     (Const ("Orderings.ord_class.less_eq", "nat => nat => bool") $
       (Const ("Tree.height_class.height", "?'a tree => nat") $
         Var (("t", 0), "?'a tree")) $
       (Const ("Nat.size_class.size", "?'a tree => nat") $
         Var (("t", 0), "?'a tree"))):
   term
### theory "Draft.Templates"
### 0.057s elapsed time, 0.113s cpu time, 0.000s GC time
Loading theory "Draft.ExtrEqs" (required by "Draft.Global_Invariants_LemmasMoreTemplates")
val eqpattern =
   Pattern
    (
       Const ("HOL.Trueprop", "bool => prop") $
         (Const ("HOL.eq", "?'a => ?'a => bool") $
           Var (("_dummy_", 1), "?'a") $ Var (("_dummy_", 2), "?'a"))
       ):
   term Find_Theorems.criterion
val badeqpattern = Pattern (Const ("Pure.eq", "?'a => ?'a => prop")):
   term Find_Theorems.criterion
val undefpattern =
   Pattern
    (
       Const ("HOL.Trueprop", "bool => prop") $
         (Const ("HOL.eq", "?'a => ?'a => bool") $
           Var (("_dummy_", 1), "?'a") $ Const ("HOL.undefined", "?'a"))
       ):
   term Find_Theorems.criterion
val thmpattern =
   Pattern
    (Const ("HOL.Trueprop", "bool => prop") $ Var (("_dummy_", 1), "bool")):
   term Find_Theorems.criterion
val badnames =
   ["*nitpick*", "*Nitpick*", "*full_exhaustive*", "*_def*", "Enum.finite*",
    "*Quickcheck*", "ATP*", "*Nunchaku*", "*Code*", "*BNF*", "*SMT*",
    "*.*.*"]:
   string list
val unwanted_names =
   [(false, Name "*nitpick*"), (false, Name "*Nitpick*"),
    (false, Name "*full_exhaustive*"), (false, Name "*_def*"),
    (false, Name "Enum.finite*"), (false, Name "*Quickcheck*"),
    (false, Name "ATP*"), (false, Name "*Nunchaku*"),
    (false, Name "*Code*"), (false, Name "*BNF*"), (false, Name "*SMT*"),
    (false, Name "*.*.*")]:
   (bool * term Find_Theorems.criterion) list
val has_vars = fn: term -> bool
val get_all_eqs = fn: string -> Proof.context -> (string * thm) list
val get_all_thms = fn: string -> Proof.context -> (string * thm) list
val get_noneq_thms = fn: string -> Proof.context -> (string * thm) list
val template_eqs = fn:
   string -> Proof.context -> (string * thm * template) list
val template_thms = fn:
   string -> Proof.context -> (string * thm * template) list
### theory "Draft.ExtrEqs"
### 0.824s elapsed time, 1.997s cpu time, 0.899s GC time
Proofs for inductive predicate(s) "small_step"
  Proving monotonicity ...
Proofs for inductive predicate(s) "system_step"
  Proving monotonicity ...
consts
  atC :: "('answer, 'location, 'question, 'state) com => 'location set"
consts
  atCs ::
    "('answer, 'location, 'question, 'state) com list => 'location set"
### theory "ConcurrentIMP.CIMP_lang"
### 4.330s elapsed time, 10.290s cpu time, 2.438s GC time
Loading theory "ConcurrentIMP.CIMP_vcg" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP")
Found termination order: "{}"
Found termination order: "(%p. size (fst p)) <*mlex*> {}"
Found termination order: "size_list size <*mlex*> {}"
Proofs for inductive predicate(s) "basic_com"
  Proving monotonicity ...
Proofs for inductive predicate(s) "ctxtp"
  Proving monotonicity ...
Found termination order: "size <*mlex*> {}"
Found termination order: "{}"
Proofs for inductive predicate(s) "vcg"
  Proving monotonicity ...
Found termination order: "(%p. size (fst p)) <*mlex*> {}"
Found termination order: "{}"
### theory "ConcurrentIMP.CIMP_vcg"
### 3.055s elapsed time, 4.189s cpu time, 1.335s GC time
Loading theory "ConcurrentIMP.CIMP_vcg_rules" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model" via "ConcurrentIMP.CIMP")
### theory "ConcurrentIMP.CIMP_vcg_rules"
### 0.264s elapsed time, 0.313s cpu time, 0.051s GC time
Loading theory "ConcurrentIMP.CIMP" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis" via "Draft.Model")
val ss_only = fn: thm list -> Proof.context -> Proof.context
val HOL_ss_only = fn: thm list -> Proof.context -> Proof.context
signature CIMP =
  sig
    val com_locs_fold: (term * 'a -> 'a) -> 'a -> term -> 'a
    val com_locs_fold_no_response: (term * 'a -> 'a) -> 'a -> term -> 'a
    val com_locs_map: (term -> 'a) -> term -> 'a list
    val com_locs_map_no_response: (term -> 'a) -> term -> 'a list
    val def_locset: thm -> local_theory -> local_theory
    val intern_com: Facts.ref -> local_theory -> local_theory
  end
structure Cimp: CIMP
### theory "ConcurrentIMP.CIMP"
### 0.120s elapsed time, 0.120s cpu time, 0.000s GC time
Loading theory "Draft.Model" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants" via "Draft.Proofs_Basis")
locale mut_m
  fixes m :: "'mut"
locale mut_m'
  fixes m :: "'mut"
    and m' :: "'mut"
  assumes "mut_m' m m'"
locale gc
locale sys
locale sys
locale mut_m
  fixes m :: "'mut"
locale gc
locale sys
locale mut_m
  fixes m :: "'mut"
locale gc
consts
  gc_coms ::
    "'mut process_name
     => (('field, 'payload, 'ref) response, char list,
         'mut process_name * ('field, 'mut, 'payload, 'ref) request_op,
         ('field, 'mut, 'payload, 'ref) Model.local_state) com"
### theory "Draft.Model"
### 8.675s elapsed time, 10.588s cpu time, 2.558s GC time
Loading theory "Draft.Proofs_Basis" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas" via "Draft.Global_Invariants")
locale gc
locale mut_m
  fixes m :: "'mut"
locale sys
locale mut_m
  fixes m :: "'mut"
### theory "Draft.Proofs_Basis"
### 4.868s elapsed time, 5.126s cpu time, 0.327s GC time
Loading theory "Draft.Global_Invariants" (required by "Draft.Global_Invariants_LemmasMoreTemplates" via "Draft.Global_Invariants_Lemmas")
locale mut_m
  fixes m :: "'mut"
consts
  mutator_phase_inv_aux ::
    "hs_phase
     => ('mut process_name
         => ('field, 'mut, 'payload, 'ref) Model.local_state)
        => bool"
consts
  sys_phase_inv_aux ::
    "hs_phase
     => ('mut process_name
         => ('field, 'mut, 'payload, 'ref) Model.local_state)
        => bool"
locale gc_system
  fixes initial_mark :: "bool"
### theory "Draft.Global_Invariants"
### 0.400s elapsed time, 0.448s cpu time, 0.066s GC time
Loading theory "Draft.Global_Invariants_Lemmas" (required by "Draft.Global_Invariants_LemmasMoreTemplates")
### Rewrite rule not in simpset:
### (!!x. x = ?a ==> PROP ?P x) == PROP ?P ?a
### Rewrite rule not in simpset:
### (!!x. ?a = x ==> PROP ?P x) == PROP ?P ?a
### Simplification procedure "HOL.defined_all" not in simpset
locale mut_m
  fixes m :: "'mut"
locale mut_m
  fixes m :: "'mut"
locale mut_m
  fixes m :: "'mut"
locale mut_m
  fixes m :: "'mut"
### theory "Draft.Global_Invariants_Lemmas"
### 1.231s elapsed time, 1.308s cpu time, 0.105s GC time
Loading theory "Draft.Global_Invariants_LemmasMoreTemplates"
val templateLemmas =
   [("Global_Invariants_Lemmas.has_white_path_to_refl",
     "(?x has_white_path_to ?x) ?s",
     template_predicate
      (
         template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 1),
           template_var 0)
         )),
    ("Global_Invariants_Lemmas.white_heap_imp_no_black_refs",
     "white_heap ?s ==> no_black_refs ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 1, template_var 0))],
       template_predicate
        (template_app (template_hole 0, template_var 0)))),
    ("Global_Invariants_Lemmas.handshake_phase_rel_simps",
     "handshake_phase_rel hp_Idle ?in_sync ?ph = (?ph = ph_Idle)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_hole 2),
                template_var 1),
              template_var 0)
            )],
       template_equation (template_var 0, template_hole 0))),
    ("Global_Invariants_Lemmas.handshake_phase_rel_simps",
     "handshake_phase_rel hp_Mark ?in_sync ?ph = (?ph = ph_Mark)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_hole 2),
                template_var 1),
              template_var 0)
            )],
       template_equation (template_var 0, template_hole 0))),
    ("Global_Invariants_Lemmas.heap_colours_colours",
     "black_heap ?s ==> ~ white ?r ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 0, template_var 0),
                 template_var 1)
               )
           ))),
    ("Global_Invariants_Lemmas.no_black_refsD",
     "no_black_refs ?s ==> ~ black ?r ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 0, template_var 0),
                 template_var 1)
               )
           ))),
    ("Global_Invariants_Lemmas.no_grey_refs_not_grey_reachableD",
     "no_grey_refs ?s ==> ~ grey_reachable ?x ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 0, template_var 0),
                 template_var 1)
               )
           ))),
    ("Global_Invariants_Lemmas.heap_colours_colours",
     "white_heap ?s ==> ~ black ?r ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 0, template_var 0),
                 template_var 1)
               )
           ))),
    ("Global_Invariants_Lemmas.in_snapshotI",
     "black ?r ?s ==> in_snapshot ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 1), template_var 0)
           ))),
    ("Global_Invariants_Lemmas.grey_reachableI",
     "grey ?g ?s ==> grey_reachable ?g ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 1), template_var 0)
           ))),
    ("Global_Invariants_Lemmas.in_snapshotI",
     "grey ?r ?s ==> in_snapshot ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 1), template_var 0)
           ))),
    ("Global_Invariants_Lemmas.valid_W_inv_sys_ghg_empty_iff",
     "valid_W_inv ?s ==> sys_ghost_honorary_grey ?s = {}",
     template_implication
      ([template_predicate
         (template_app (template_hole 4, template_var 0))],
       template_equation
        (template_app
          (template_hole 2, template_app (template_var 0, template_hole 1)),
         template_hole 0))),
    ("Global_Invariants_Lemmas.grey_protects_whiteI",
     "grey ?g ?s ==> (?g grey_protects_white ?g) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 1),
               template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.no_grey_refsD",
     "no_grey_refs ?s ==> ?r ~: W (?s ?p)",
     template_implication
      ([template_predicate
         (template_app (template_hole 3, template_var 2))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_app
                  (template_hole 0,
                   template_app (template_var 2, template_var 0)))
               )
           ))),
    ("Global_Invariants_Lemmas.no_grey_refsD",
     "no_grey_refs ?s ==> ?r ~: ghost_honorary_grey (?s ?p)",
     template_implication
      ([template_predicate
         (template_app (template_hole 3, template_var 2))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_app
                  (template_hole 0,
                   template_app (template_var 2, template_var 0)))
               )
           ))),
    ("Global_Invariants_Lemmas.no_grey_refsD",
     "no_grey_refs ?s ==> ?r ~: WL ?p ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 3, template_var 2))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2))
               )
           ))),
    ("Global_Invariants_Lemmas.white_valid_ref",
     "white ?r ?s ==> obj_at (%s. True) ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.grey_protects_white_reaches",
     "(?g grey_protects_white ?w) ?s ==> (?g reaches ?w) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 1, template_var 2),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.has_white_path_to_reaches",
     "(?x has_white_path_to ?y) ?s ==> (?x reaches ?y) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 1, template_var 2),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.greyI", "?r : W (?s ?p) ==> grey ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_hole 1,
                template_app (template_var 1, template_var 0)))
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 2), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.greyI",
     "?r : ghost_honorary_grey (?s ?p) ==> grey ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_hole 1,
                template_app (template_var 1, template_var 0)))
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 2), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.greyI", "?r : WL ?p ?s ==> grey ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_app (template_hole 1, template_var 1),
                template_var 0))
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 2), template_var 0)
           ))),
    ("Global_Invariants_Lemmas.blackD", "black ?r ?s ==> ?r ~: WL ?p ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 3, template_var 2),
              template_var 1)
            )],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 1, template_var 2),
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 1))
               )
           ))),
    ("Global_Invariants_Lemmas.reachableI",
     "?x : mut_m.tso_store_refs ?m ?s ==> mut_m.reachable ?m ?x ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_app (template_hole 1, template_var 1),
                template_var 0))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 1),
               template_var 2),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.WL_eq_imp",
     "eq_imp (%_ s. (ghost_honorary_grey (s ?p), W (s ?p))) (WL ?p)",
     template_predicate
      (
         template_app
          (template_app (template_hole 4, t_empty),
           template_app (template_hole 0, template_var 0))
         )),
    ("Global_Invariants_Lemmas.WLI", "?r : W (?s ?p) ==> ?r : WL ?p ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_hole 1,
                template_app (template_var 1, template_var 0)))
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 2, template_var 2),
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("Global_Invariants_Lemmas.WLI",
     "?r : ghost_honorary_grey (?s ?p) ==> ?r : WL ?p ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_app
               (template_hole 1,
                template_app (template_var 1, template_var 0)))
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 2, template_var 2),
             template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1))
           ))),
    ("Global_Invariants_Lemmas.reachableI2",
     "?x : ghost_honorary_root (?s (mutator ?m)) ==>
      mut_m.reachable ?m ?x ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 3, template_var 2),
              template_app
               (template_hole 2,
                template_app
                 (template_var 1,
                  template_app (template_hole 1, template_var 0))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.reachableI",
     "?x : roots (?s (mutator ?m)) ==> mut_m.reachable ?m ?x ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 3, template_var 2),
              template_app
               (template_hole 2,
                template_app
                 (template_var 1,
                  template_app (template_hole 1, template_var 0))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.has_white_path_toD",
     "(?x has_white_path_to ?y) ?s ==> white ?y ?s | ?x = ?y",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 2),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_var 0)),
             template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1))
           ))),
    ("Global_Invariants_Lemmas.grey_eq_imp",
     "eq_imp (%_ s. ?r : (UN p. WL p s)) (grey ?r)",
     template_predicate
      (
         template_app
          (template_app (template_hole 6, t_empty),
           template_app (template_hole 0, template_var 0))
         )),
    ("Global_Invariants_Lemmas.handshake_phase_rel_simps",
     "handshake_phase_rel hp_IdleInit ?in_sync ?ph =
      (?ph = ph_Idle | ?in_sync & ?ph = ph_Init)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_hole 5),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_hole 2)),
             template_app
              (template_app (template_hole 1, template_var 1),
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_hole 0)))
           ))),
    ("Global_Invariants_Lemmas.handshake_phase_rel_simps",
     "handshake_phase_rel hp_InitMark ?in_sync ?ph =
      (?ph = ph_Init | ?in_sync & ?ph = ph_Mark)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_hole 5),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_hole 2)),
             template_app
              (template_app (template_hole 1, template_var 1),
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_hole 0)))
           ))),
    ("Global_Invariants_Lemmas.in_snapshot_valid_ref",
     "[| in_snapshot ?r ?s; valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 3, template_var 1),
              template_var 0)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.in_snapshotI",
     "[| white ?w ?s; (?g grey_protects_white ?w) ?s |]
      ==> in_snapshot ?w ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 1, template_var 0),
                template_var 2),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 2), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.white_eq_imp",
     "eq_imp (%_ s. (sys_fM s, map_option obj_mark (sys_heap s ?r)))
       (white ?r)",
     template_predicate
      (
         template_app
          (template_app (template_hole 7, t_empty),
           template_app (template_hole 0, template_var 0))
         )),
    ("Global_Invariants_Lemmas.tso_store_invD",
     "tso_store_inv ?s ==>
      sys_mem_store_buffers (mutator ?m) ?s ~= mw_Phase ?ph # ?ws",
     template_implication
      ([template_predicate
         (template_app (template_hole 7, template_var 3))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_var 3, template_hole 3)),
               template_app (template_hole 2, template_var 2)),
             template_app
              (template_app
                (template_hole 1,
                 template_app (template_hole 0, template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.tso_store_invD",
     "tso_store_inv ?s ==>
      sys_mem_store_buffers (mutator ?m) ?s ~= mw_fA ?fl # ?ws",
     template_implication
      ([template_predicate
         (template_app (template_hole 7, template_var 3))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_var 3, template_hole 3)),
               template_app (template_hole 2, template_var 2)),
             template_app
              (template_app
                (template_hole 1,
                 template_app (template_hole 0, template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.tso_store_invD",
     "tso_store_inv ?s ==>
      sys_mem_store_buffers (mutator ?m) ?s ~= mw_fM ?fl # ?ws",
     template_implication
      ([template_predicate
         (template_app (template_hole 7, template_var 3))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_var 3, template_hole 3)),
               template_app (template_hole 2, template_var 2)),
             template_app
              (template_app
                (template_hole 1,
                 template_app (template_hole 0, template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.blackD", "black ?r ?s ==> marked ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 5, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 4, t_empty), template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.valid_W_inv_colours",
     "[| white ?x ?s; valid_W_inv ?s |] ==> ?x ~: W (?s ?p)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 2),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 3, template_var 1))],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app (template_hole 1, template_var 2),
                 template_app
                  (template_hole 0,
                   template_app (template_var 1, template_var 0)))
               )
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| mut_m.reachable ?m ?x ?s; valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?x ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 2),
                template_var 1),
              template_var 0)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(mutator ?m' := ?s (mutator ?m')(| roots := ?roots' |))) =
      mut_m.tso_store_refs ?m ?s",
     template_equation
      (template_app
        (template_app (template_hole 3, template_var 3),
         template_app
          (template_app
            (template_app (template_hole 2, template_var 2),
             template_app (template_hole 1, template_var 1)),
           template_app
            (template_app (template_hole 0, t_empty),
             template_app
              (template_var 2,
               template_app (template_hole 1, template_var 1))))),
       template_app
        (template_app (template_hole 3, template_var 3), template_var 2))),
    ("Global_Invariants_Lemmas.tso_store_invD",
     "tso_store_inv ?s ==>
      sys_mem_store_buffers gc ?s ~= mw_Mutate ?r ?f ?r' # ?ws",
     template_implication
      ([template_predicate
         (template_app (template_hole 7, template_var 4))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_var 4, template_hole 3)),
               template_hole 2),
             template_app
              (template_app
                (template_hole 1,
                 template_app
                  (template_app
                    (template_app (template_hole 0, template_var 3),
                     template_var 2),
                   template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.tso_store_invD",
     "tso_store_inv ?s ==>
      sys_mem_store_buffers gc ?s ~= mw_Mutate_Payload ?r ?f ?pl # ?ws",
     template_implication
      ([template_predicate
         (template_app (template_hole 7, template_var 4))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_var 4, template_hole 3)),
               template_hole 2),
             template_app
              (template_app
                (template_hole 1,
                 template_app
                  (template_app
                    (template_app (template_hole 0, template_var 3),
                     template_var 2),
                   template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.marked_not_white",
     "white ?r ?s ==> ~ marked ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 6, template_var 1),
              template_var 0)
            )],
       template_negation
        (
           template_predicate
            (
               template_app
                (template_app
                  (template_app (template_hole 4, t_empty), template_var 1),
                 template_var 0)
               )
           ))),
    ("Global_Invariants_Lemmas.whiteI",
     "obj_at (%obj. obj_mark obj = (~ sys_fM ?s)) ?r ?s ==> white ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, t_empty), template_var 0),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 0), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.valid_W_invE",
     "[| ?r : W (?s ?p); valid_W_inv ?s |] ==> obj_at (%s. True) ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 2),
              template_app
               (template_hole 3,
                template_app (template_var 1, template_var 0)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.grey_protects_whiteD",
     "(?g grey_protects_white ?w) ?s ==>
      grey ?g ?s & (?g = ?w | white ?w ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, template_var 2),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 2),
                 template_var 0)),
             template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app (template_hole 1, template_var 2),
                   template_var 1)),
               template_app
                (template_app (template_hole 0, template_var 1),
                 template_var 0)))
           ))),
    ("Global_Invariants_Lemmas.handshake_phase_rel_simps",
     "handshake_phase_rel hp_IdleMarkSweep ?in_sync ?ph =
      (?ph = ph_Mark | ?in_sync & ?ph : {ph_Idle, ph_Sweep})",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 10, template_hole 9),
                template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app (template_hole 7, template_var 0),
                 template_hole 6)),
             template_app
              (template_app (template_hole 5, template_var 1),
               template_app
                (template_app (template_hole 4, template_var 0),
                 template_app
                  (template_app (template_hole 3, template_hole 2),
                   template_app
                    (template_app (template_hole 3, template_hole 1),
                     template_hole 0)))))
           ))),
    ("Global_Invariants_Lemmas.mutator_reachable_tso",
     "sys_mem_store_buffers (mutator ?m) ?s =
      mw_Mutate_Payload ?r ?f ?pl # ?ws ==>
      mut_m.reachable ?m ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 5,
              template_app (template_var 5, template_hole 4)),
            template_app (template_hole 3, template_var 4)),
          template_app
           (template_app
             (template_hole 2,
              template_app
               (template_app
                 (template_app (template_hole 1, template_var 3),
                  template_var 2),
                template_var 1)),
            template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 4),
               template_var 3),
             template_var 5)
           ))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) =
      mut_m.tso_store_refs ?m ?s",
     template_equation
      (template_app
        (template_app (template_hole 6, template_var 2),
         template_app
          (template_app
            (template_app (template_hole 5, template_var 1),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app (template_var 1, template_hole 4)))),
       template_app
        (template_app (template_hole 6, template_var 2), template_var 1))),
    ("Global_Invariants_Lemmas.colours_sweep_loop_free",
     "grey ?r (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) =
      grey ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 6, template_var 2),
         template_app
          (template_app
            (template_app (template_hole 5, template_var 1),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app (template_var 1, template_hole 4)))),
       template_app
        (template_app (template_hole 6, template_var 2), template_var 1))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| mut_m.reachable ?m ?x ?s; valid_refs_inv ?s |]
      ==> EX obj. sys_heap ?s ?x = Some obj",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 2),
                template_var 1),
              template_var 0)
            ),
        template_predicate
         (template_app (template_hole 5, template_var 0))],
       template_predicate (template_app (template_hole 4, t_empty)))),
    ("Global_Invariants_Lemmas.grey_reachableE",
     "[| (?g points_to ?y) ?s; grey_reachable ?g ?s |]
      ==> grey_reachable ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 4, t_empty), template_var 1),
              template_var 0)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 0, template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 2), template_var 0)
           ))),
    ("Global_Invariants_Lemmas.no_grey_refs_marked",
     "[| marked ?r ?s; no_grey_refs ?s |] ==> black ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, t_empty), template_var 0),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 1, template_var 1))],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 0), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(mutator ?m' := ?s (mutator ?m')
             (| ghost_honorary_root := set_option ?opt_r',
                ref := ?opt_r' |))) =
      mut_m.tso_store_refs ?m ?s",
     template_equation
      (template_app
        (template_app (template_hole 5, template_var 3),
         template_app
          (template_app
            (template_app (template_hole 4, template_var 2),
             template_app (template_hole 3, template_var 1)),
           template_app
            (template_app (template_hole 2, t_empty),
             template_app
              (template_app (template_hole 1, t_empty),
               template_app
                (template_var 2,
                 template_app (template_hole 3, template_var 1)))))),
       template_app
        (template_app (template_hole 5, template_var 3), template_var 2))),
    ("Global_Invariants_Lemmas.has_white_path_to_blacken",
     "(?x has_white_path_to ?w) (?s(gc := ?s gc(| W := gc_W ?s - ?rs |))) =
      (?x has_white_path_to ?w) ?s",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 5, template_var 3), template_var 2),
         template_app
          (template_app
            (template_app (template_hole 4, template_var 1),
             template_hole 3),
           template_app
            (template_app (template_hole 2, t_empty),
             template_app (template_var 1, template_hole 3)))),
       template_app
        (template_app
          (template_app (template_hole 5, template_var 3), template_var 2),
         template_var 1))),
    ("Global_Invariants_Lemmas.handshake_in_syncD",
     "[| All (ghost_hs_in_sync (?s sys)); handshake_phase_inv ?s |]
      ==> ALL m'. ghost_hs_phase (?s (mutator m')) = sys_ghost_hs_phase ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_hole 6,
              template_app
               (template_hole 5,
                template_app (template_var 0, template_hole 4)))
            ),
        template_predicate
         (template_app (template_hole 3, template_var 0))],
       template_predicate (template_app (template_hole 6, t_empty)))),
    ("Global_Invariants_Lemmas.no_grey_refs_bwD",
     "[| sys_heap ?s ?r = Some ?obj; no_grey_refs ?s |]
      ==> black ?r ?s | white ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 6,
              template_app (template_var 2, template_hole 5)),
            template_var 1),
          template_app (template_hole 4, template_var 0)),
        template_predicate
         (template_app (template_hole 3, template_var 2))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_var 2)),
             template_app
              (template_app (template_hole 0, template_var 1),
               template_var 2))
           ))),
    ("Global_Invariants_Lemmas.has_white_path_toE",
     "[| (?x points_to ?y) ?s; white ?y ?s |]
      ==> (?x has_white_path_to ?y) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, t_empty), template_var 1),
              template_var 0)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 2),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 1),
               template_var 2),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.valid_W_invE",
     "[| mw_Mark ?r ?fl : set (sys_mem_store_buffers ?p ?s);
         valid_W_inv ?s |]
      ==> ?r : ghost_honorary_grey (?s ?p)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 7,
                template_app
                 (template_app (template_hole 6, template_var 3),
                  template_var 2)),
              template_app
               (template_hole 5,
                template_app
                 (template_app
                   (template_hole 4,
                    template_app (template_var 1, template_hole 3)),
                  template_var 0)))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_predicate
        (
           template_app
            (template_app (template_hole 1, template_var 3),
             template_app
              (template_hole 0,
               template_app (template_var 1, template_var 0)))
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| grey ?x ?s; (?x reaches ?y) ?s; valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 2),
                template_var 0),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 0),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.valid_ref_valid_null_ref_simps",
     "valid_null_ref ?r'
       (?s(sys := do_store_action ?w (?s sys)
             (| mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      valid_null_ref ?r' ?s",
     template_equation
      (template_app
        (template_app (template_hole 6, template_var 4),
         template_app
          (template_app
            (template_app (template_hole 5, template_var 3),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 0, template_var 0),
               template_app (template_var 3, template_hole 4))))),
       template_app
        (template_app (template_hole 6, template_var 4), template_var 3))),
    ("Global_Invariants_Lemmas.valid_W_invE",
     "[| ?r : W (?s ?p); valid_W_inv ?s |] ==> marked ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 7, template_var 2),
              template_app
               (template_hole 6,
                template_app (template_var 1, template_var 0)))
            ),
        template_predicate
         (template_app (template_hole 5, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 4, t_empty), template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.reachable_points_to",
     "[| (?x points_to ?y) ?s; mut_m.reachable ?m ?x ?s |]
      ==> mut_m.reachable ?m ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 4, t_empty), template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 0, template_var 0),
                template_var 2),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 3),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.grey_reachable_eq_imp",
     "eq_imp
       (%r' s.
           (UN p. WL p s,
            Set.bind (set_option (sys_heap s r')) (ran o obj_fields)))
       (grey_reachable ?r)",
     template_predicate
      (
         template_app
          (template_app (template_hole 13, t_empty),
           template_app (template_hole 0, template_var 0))
         )),
    ("Global_Invariants_Lemmas.tso_store_inv_sys_load_GC",
     "tso_store_inv ?s ==>
      sys_load gc (mr_Ref ?r ?f) (?s sys) =
      mv_Ref (Option.bind (sys_heap ?s ?r) (%obj. obj_fields obj ?f))",
     template_implication
      ([template_predicate
         (template_app (template_hole 9, template_var 2))],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 7, template_hole 6),
             template_app
              (template_app (template_hole 5, template_var 1),
               template_var 0)),
           template_app (template_var 2, template_hole 4)),
         template_app
          (template_hole 3,
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app
                  (template_hole 1,
                   template_app (template_var 2, template_hole 4)),
                 template_var 1)),
             t_empty))))),
    ("Global_Invariants_Lemmas.reachable_sweep_loop_free",
     "mut_m.reachable ?m ?r
       (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) ==>
      mut_m.reachable ?m ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 3),
                template_var 2),
              template_app
               (template_app
                 (template_app (template_hole 5, template_var 1),
                  template_hole 4),
                template_app
                 (template_app (template_hole 3, t_empty),
                  template_app (template_var 1, template_hole 4))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 6, template_var 3),
               template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : mut_m.tso_store_refs ?m ?s; (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 5, template_var 3),
              template_app
               (template_app (template_hole 4, template_var 2),
                template_var 1))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 3),
                template_var 0),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 0),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.ghost_honorary_grey_mo_co_mark",
     "ghost_honorary_grey (?s ?p) = {} ==>
      white ?w (?s(?p := ?s ?p(| ghost_honorary_grey := {?r} |))) =
      white ?w ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 6, template_app (template_var 3, template_var 2)),
          template_hole 5)],
       template_equation
        (template_app
          (template_app (template_hole 3, template_var 1),
           template_app
            (template_app
              (template_app (template_hole 2, template_var 3),
               template_var 2),
             template_app
              (template_app (template_hole 1, t_empty),
               template_app (template_var 3, template_var 2)))),
         template_app
          (template_app (template_hole 3, template_var 1),
           template_var 3)))),
    ("Global_Invariants_Lemmas.not_white_marked",
     "[| ~ white ?r ?s; obj_at (%s. True) ?r ?s |] ==> marked ?r ?s",
     template_implication
      ([template_negation
         (
            template_predicate
             (
                template_app
                 (template_app (template_hole 6, template_var 1),
                  template_var 0)
                )
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, t_empty), template_var 1),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 5, t_empty), template_var 1),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : ghost_honorary_root (?s (mutator ?m)); (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 6, template_var 3),
              template_app
               (template_hole 5,
                template_app
                 (template_var 2,
                  template_app (template_hole 4, template_var 1))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 3),
                template_var 0),
              template_var 2)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 0),
             template_var 2)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : roots (?s (mutator ?m)); (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 6, template_var 3),
              template_app
               (template_hole 5,
                template_app
                 (template_var 2,
                  template_app (template_hole 4, template_var 1))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 3),
                template_var 0),
              template_var 2)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 2))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 0),
             template_var 2)
           ))),
    ("Global_Invariants_Lemmas.colours_sweep_loop_free",
     "black ?r (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) =
      (black ?r ?s & ?r ~= ?r')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 2),
              template_app
               (template_app
                 (template_app (template_hole 8, template_var 1),
                  template_hole 7),
                template_app
                 (template_app (template_hole 6, t_empty),
                  template_app (template_var 1, template_hole 7))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 9, template_var 2),
                 template_var 1)),
             template_app
              (template_hole 1,
               template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 0)))
           ))),
    ("Global_Invariants_Lemmas.colours_sweep_loop_free",
     "white ?r (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) =
      (white ?r ?s & ?r ~= ?r')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 2),
              template_app
               (template_app
                 (template_app (template_hole 8, template_var 1),
                  template_hole 7),
                template_app
                 (template_app (template_hole 6, t_empty),
                  template_app (template_var 1, template_hole 7))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 9, template_var 2),
                 template_var 1)),
             template_app
              (template_hole 1,
               template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 0)))
           ))),
    ("Global_Invariants_Lemmas.tso_store_inv_fun_upd",
     "(!!x. sys_mem_store_buffers x (?s(?fld := ?val)) =
            sys_mem_store_buffers x ?s) ==>
      tso_store_inv (?s(?fld := ?val)) = tso_store_inv ?s",
     template_implication
      ([template_predicate (template_app (template_hole 7, t_empty))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 3, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.mut_do_store_action",
     "[| sys_mem_store_buffers (mutator ?m) ?s = ?w # ?ws;
         tso_store_inv ?s |]
      ==> fA (do_store_action ?w (?s sys)) = sys_fA ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 7,
              template_app (template_var 3, template_hole 6)),
            template_app (template_hole 5, template_var 2)),
          template_app
           (template_app (template_hole 4, template_var 1),
            template_var 0)),
        template_predicate
         (template_app (template_hole 3, template_var 3))],
       template_equation
        (template_app
          (template_hole 1,
           template_app
            (template_app (template_hole 0, template_var 1),
             template_app (template_var 3, template_hole 6))),
         template_app
          (template_hole 1,
           template_app (template_var 3, template_hole 6))))),
    ("Global_Invariants_Lemmas.mut_do_store_action",
     "[| sys_mem_store_buffers (mutator ?m) ?s = ?w # ?ws;
         tso_store_inv ?s |]
      ==> fM (do_store_action ?w (?s sys)) = sys_fM ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 7,
              template_app (template_var 3, template_hole 6)),
            template_app (template_hole 5, template_var 2)),
          template_app
           (template_app (template_hole 4, template_var 1),
            template_var 0)),
        template_predicate
         (template_app (template_hole 3, template_var 3))],
       template_equation
        (template_app
          (template_hole 1,
           template_app
            (template_app (template_hole 0, template_var 1),
             template_app (template_var 3, template_hole 6))),
         template_app
          (template_hole 1,
           template_app (template_var 3, template_hole 6))))),
    ("Global_Invariants_Lemmas.mut_do_store_action",
     "[| sys_mem_store_buffers (mutator ?m) ?s = ?w # ?ws;
         tso_store_inv ?s |]
      ==> phase (do_store_action ?w (?s sys)) = sys_phase ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 7,
              template_app (template_var 3, template_hole 6)),
            template_app (template_hole 5, template_var 2)),
          template_app
           (template_app (template_hole 4, template_var 1),
            template_var 0)),
        template_predicate
         (template_app (template_hole 3, template_var 3))],
       template_equation
        (template_app
          (template_hole 1,
           template_app
            (template_app (template_hole 0, template_var 1),
             template_app (template_var 3, template_hole 6))),
         template_app
          (template_hole 1,
           template_app (template_var 3, template_hole 6))))),
    ("Global_Invariants_Lemmas.black_eq_imp",
     "eq_imp
       (%_ s. (?r : (UN p. WL p s), sys_fM s,
               map_option obj_mark (sys_heap s ?r)))
       (black ?r)",
     template_predicate
      (
         template_app
          (template_app (template_hole 13, t_empty),
           template_app (template_hole 0, template_var 0))
         )),
    ("Global_Invariants_Lemmas.valid_ref_valid_null_ref_simps",
     "obj_at (%s. True) ?r
       (?s(sys := do_store_action ?w (?s sys)
             (| mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      obj_at (%s. True) ?r ?s",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 7, t_empty), template_var 4),
         template_app
          (template_app
            (template_app (template_hole 5, template_var 3),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 0, template_var 0),
               template_app (template_var 3, template_hole 4))))),
       template_app
        (template_app
          (template_app (template_hole 7, t_empty), template_var 4),
         template_var 3))),
    ("Global_Invariants_Lemmas.valid_W_invE",
     "[| ?r : ghost_honorary_grey (?s ?p); sys_mem_lock ?s ~= Some ?p;
         valid_W_inv ?s |]
      ==> obj_at (%s. True) ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 2),
              template_app
               (template_hole 8,
                template_app (template_var 1, template_var 0)))
            ),
        template_negation
         (
            template_equation
             (template_app
               (template_hole 5,
                template_app (template_var 1, template_hole 4)),
              template_app (template_hole 3, template_var 0))
            ),
        template_predicate
         (template_app (template_hole 2, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.grey_protects_whiteE",
     "[| (?g points_to ?w) ?s; grey ?g ?s; white ?w ?s |]
      ==> (?g grey_protects_white ?w) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, t_empty), template_var 1),
              template_var 0)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 2, template_var 1),
              template_var 0)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 1, template_var 2),
              template_var 0)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 1),
               template_var 2),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.obj_at_ref_sweep_loop_free",
     "obj_at ?P ?r
       (?s(sys := ?s sys(| heap := (sys_heap ?s)(?r' := None) |))) =
      (obj_at ?P ?r ?s & ?r ~= ?r')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 9, template_var 3),
                template_var 2),
              template_app
               (template_app
                 (template_app (template_hole 8, template_var 1),
                  template_hole 7),
                template_app
                 (template_app (template_hole 6, t_empty),
                  template_app (template_var 1, template_hole 7))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 3),
                   template_var 2),
                 template_var 1)),
             template_app
              (template_hole 1,
               template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 0)))
           ))),
    ("Global_Invariants_Lemmas.no_pending_phase_sys_load",
     "filter is_mw_Phase (sys_mem_store_buffers ?p ?s) = [] ==>
      sys_load ?p mr_Phase (?s sys) = mv_Phase (sys_phase ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 11, t_empty),
            template_app
             (template_app
               (template_hole 7,
                template_app (template_var 1, template_hole 6)),
              template_var 0)),
          template_hole 5)],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 3, template_var 0),
             template_hole 2),
           template_app (template_var 1, template_hole 6)),
         template_app
          (template_hole 1,
           template_app
            (template_hole 0,
             template_app (template_var 1, template_hole 6)))))),
    ("Global_Invariants_Lemmas.no_black_refs_mo_co_mark",
     "[| ghost_honorary_grey (?s ?p) = {}; white ?r ?s |]
      ==> no_black_refs (?s(?p := ?s ?p(| ghost_honorary_grey := {?r} |))) =
          no_black_refs ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 7, template_app (template_var 2, template_var 1)),
          template_hole 6),
        template_predicate
         (
            template_app
             (template_app (template_hole 5, template_var 0),
              template_var 2)
            )],
       template_equation
        (template_app
          (template_hole 3,
           template_app
            (template_app
              (template_app (template_hole 2, template_var 2),
               template_var 1),
             template_app
              (template_app (template_hole 1, t_empty),
               template_app (template_var 2, template_var 1)))),
         template_app (template_hole 3, template_var 2)))),
    ("Global_Invariants_Lemmas.grey_protects_whiteE",
     "[| (?g grey_protects_white ?y) ?s; (?y points_to ?w) ?s;
         white ?w ?s |]
      ==> (?g grey_protects_white ?w) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 4, t_empty), template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 0, template_var 0),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 5, template_var 3),
               template_var 0),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.has_white_path_to_step",
     "[| (?x has_white_path_to ?y) ?s; (?y points_to ?z) ?s; white ?z ?s |]
      ==> (?x has_white_path_to ?z) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 4, t_empty), template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 0, template_var 0),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 5, template_var 3),
               template_var 0),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.has_white_path_to_step",
     "[| (?y has_white_path_to ?z) ?s; (?x points_to ?y) ?s; white ?y ?s |]
      ==> (?x has_white_path_to ?z) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 4, t_empty), template_var 0),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 0, template_var 3),
              template_var 1)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 5, template_var 0),
               template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : mut_m.tso_store_refs ?m ?s; (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> EX obj. sys_heap ?s ?y = Some obj",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 8, template_var 3),
              template_app
               (template_app (template_hole 7, template_var 2),
                template_var 1))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 3),
                template_var 0),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 5, template_var 1))],
       template_predicate (template_app (template_hole 4, t_empty)))),
    ("Global_Invariants_Lemmas.has_white_path_to_eq_imp",
     "eq_imp
       (%r' s.
           (sys_fM s,
            \<Union> (ran ` obj_fields ` set_option (sys_heap s r')),
            map_option obj_mark (sys_heap s r')))
       (?x has_white_path_to ?y)",
     template_predicate
      (
         template_app
          (template_app (template_hole 14, t_empty),
           template_app
            (template_app (template_hole 0, template_var 1),
             template_var 0))
         )),
    ("Global_Invariants_Lemmas.ghost_honorary_grey_mo_co_mark",
     "ghost_honorary_grey (?s ?p) = {} ==>
      grey ?g (?s(?p := ?s ?p(| ghost_honorary_grey := {?r} |))) =
      (grey ?g ?s | ?g = ?r)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 8, template_app (template_var 3, template_var 2)),
          template_hole 7)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 5, template_var 1),
                template_app
                 (template_app
                   (template_app (template_hole 4, template_var 3),
                    template_var 2),
                  template_app
                   (template_app (template_hole 3, t_empty),
                    template_app (template_var 3, template_var 2))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 1,
                 template_app
                  (template_app (template_hole 5, template_var 1),
                   template_var 3)),
               template_app
                (template_app (template_hole 0, template_var 1),
                 template_var 0))
             )))),
    ("Global_Invariants_Lemmas.gc_no_pending_fM_write",
     "filter is_mw_fM (sys_mem_store_buffers gc ?s) = [] ==>
      sys_load gc mr_fM (?s sys) = mv_Mark (Some (sys_fM ?s))",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 13, t_empty),
            template_app
             (template_app
               (template_hole 9,
                template_app (template_var 0, template_hole 8)),
              template_hole 7)),
          template_hole 6)],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 4, template_hole 7),
             template_hole 3),
           template_app (template_var 0, template_hole 8)),
         template_app
          (template_hole 2,
           template_app
            (template_hole 1,
             template_app
              (template_hole 0,
               template_app (template_var 0, template_hole 8))))))),
    ("Global_Invariants_Lemmas.no_grey_refs_no_pending_marks",
     "[| no_grey_refs ?s; valid_W_inv ?s |]
      ==> ALL x. filter is_mw_Mark (sys_mem_store_buffers x ?s) = []",
     template_implication
      ([template_predicate
         (template_app (template_hole 11, template_var 0)),
        template_predicate
         (template_app (template_hole 10, template_var 0))],
       template_predicate (template_app (template_hole 9, t_empty)))),
    ("Global_Invariants_Lemmas.black_heap_no_greys",
     "[| no_grey_refs ?s; ALL r. marked r ?s | ~ obj_at (%s. True) r ?s |]
      ==> black_heap ?s",
     template_implication
      ([template_predicate
         (template_app (template_hole 10, template_var 0)),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_predicate
        (template_app (template_hole 0, template_var 0)))),
    ("Global_Invariants_Lemmas.valid_W_inv_sys_load",
     "[| sys_mem_lock ?s ~= Some ?p; valid_W_inv ?s |]
      ==> sys_load ?p (mr_Mark ?r) (?s sys) =
          mv_Mark (map_option obj_mark (sys_heap ?s ?r))",
     template_implication
      ([template_negation
         (
            template_equation
             (template_app
               (template_hole 10,
                template_app (template_var 2, template_hole 9)),
              template_app (template_hole 8, template_var 1))
            ),
        template_predicate
         (template_app (template_hole 7, template_var 2))],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 1),
             template_app (template_hole 4, template_var 0)),
           template_app (template_var 2, template_hole 9)),
         template_app
          (template_hole 3,
           template_app
            (template_app (template_hole 2, template_hole 1),
             template_app
              (template_app
                (template_hole 0,
                 template_app (template_var 2, template_hole 9)),
               template_var 0)))))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : ghost_honorary_root (?s (mutator ?m)); (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> EX obj. sys_heap ?s ?y = Some obj",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 3),
              template_app
               (template_hole 8,
                template_app
                 (template_var 2,
                  template_app (template_hole 7, template_var 1))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 3),
                template_var 0),
              template_var 2)
            ),
        template_predicate
         (template_app (template_hole 5, template_var 2))],
       template_predicate (template_app (template_hole 4, t_empty)))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?x : roots (?s (mutator ?m)); (?x reaches ?y) ?s;
         valid_refs_inv ?s |]
      ==> EX obj. sys_heap ?s ?y = Some obj",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 3),
              template_app
               (template_hole 8,
                template_app
                 (template_var 2,
                  template_app (template_hole 7, template_var 1))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 3),
                template_var 0),
              template_var 2)
            ),
        template_predicate
         (template_app (template_hole 5, template_var 2))],
       template_predicate (template_app (template_hole 4, t_empty)))),
    ("Global_Invariants_Lemmas.ghost_honorary_grey_mo_co_mark",
     "ghost_honorary_grey (?s ?p) = {} ==>
      black ?b (?s(?p := ?s ?p(| ghost_honorary_grey := {?r} |))) =
      (black ?b ?s & ?b ~= ?r)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 9, template_app (template_var 3, template_var 2)),
          template_hole 8)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 6, template_var 1),
                template_app
                 (template_app
                   (template_app (template_hole 5, template_var 3),
                    template_var 2),
                  template_app
                   (template_app (template_hole 4, t_empty),
                    template_app (template_var 3, template_var 2))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app (template_hole 6, template_var 1),
                   template_var 3)),
               template_app
                (template_hole 1,
                 template_app
                  (template_app (template_hole 0, template_var 1),
                   template_var 0)))
             )))),
    ("Global_Invariants_Lemmas.no_grey_refs_fun_upd",
     "(UN p. WL p (?s(?fld := ?val))) = (UN p. WL p ?s) ==>
      no_grey_refs (?s(?fld := ?val)) = no_grey_refs ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 6,
            template_app
             (template_app (template_hole 5, t_empty), template_hole 2)),
          template_app
           (template_hole 6,
            template_app
             (template_app (template_hole 5, t_empty), template_hole 2)))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 3, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.valid_ref_valid_null_ref_simps",
     "valid_null_ref ?r'
       (?s(mutator ?m := ?mut_s',
           sys := ?s sys(| heap := sys_heap ?s(?r'' |-> ?obj) |))) =
      (valid_null_ref ?r' ?s | ?r' = Some ?r'')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 10, template_var 5),
              template_app
               (template_app
                 (template_app
                   (template_hole 9,
                    template_app
                     (template_app
                       (template_app (template_hole 9, template_var 4),
                        template_app (template_hole 8, template_var 3)),
                      template_var 2)),
                  template_hole 7),
                template_app
                 (template_app (template_hole 6, t_empty),
                  template_app (template_var 4, template_hole 7))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 10, template_var 5),
                 template_var 4)),
             template_app
              (template_app (template_hole 1, template_var 5),
               template_app (template_hole 0, template_var 1)))
           ))),
    ("Global_Invariants_Lemmas.colours_load_W",
     "gc_W ?s = {} ==>
      black ?r
       (?s(gc := ?s gc(| W := sys_W ?s |), sys := ?s sys(| W := {} |))) =
      black ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 7,
            template_app (template_var 1, template_hole 6)),
          template_hole 5)],
       template_equation
        (template_app
          (template_app (template_hole 3, template_var 0),
           template_app
            (template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app
                    (template_app (template_hole 2, template_var 1),
                     template_hole 6),
                   template_app
                    (template_app (template_hole 1, t_empty),
                     template_app (template_var 1, template_hole 6)))),
               template_hole 0),
             template_app
              (template_app (template_hole 1, t_empty),
               template_app (template_var 1, template_hole 0)))),
         template_app
          (template_app (template_hole 3, template_var 0),
           template_var 1)))),
    ("Global_Invariants_Lemmas.colours_load_W",
     "gc_W ?s = {} ==>
      grey ?r
       (?s(gc := ?s gc(| W := sys_W ?s |), sys := ?s sys(| W := {} |))) =
      grey ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 7,
            template_app (template_var 1, template_hole 6)),
          template_hole 5)],
       template_equation
        (template_app
          (template_app (template_hole 3, template_var 0),
           template_app
            (template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app
                    (template_app (template_hole 2, template_var 1),
                     template_hole 6),
                   template_app
                    (template_app (template_hole 1, t_empty),
                     template_app (template_var 1, template_hole 6)))),
               template_hole 0),
             template_app
              (template_app (template_hole 1, t_empty),
               template_app (template_var 1, template_hole 0)))),
         template_app
          (template_app (template_hole 3, template_var 0),
           template_var 1)))),
    ("Global_Invariants_Lemmas.ghost_honorary_grey_mo_co_W",
     "ghost_honorary_grey (?s ?p') = {?r} ==>
      WL ?p
       (?s(?p' := ?s ?p'
             (| W := insert ?r (W (?s ?p')),
                ghost_honorary_grey := {} |))) =
      WL ?p ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 7, template_app (template_var 3, template_var 2)),
          template_app
           (template_app (template_hole 6, template_var 1),
            template_hole 5))],
       template_equation
        (template_app
          (template_app (template_hole 4, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 3, template_var 3),
               template_var 2),
             template_app
              (template_app (template_hole 2, t_empty),
               template_app
                (template_app (template_hole 1, t_empty),
                 template_app (template_var 3, template_var 2))))),
         template_app
          (template_app (template_hole 4, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.ghost_honorary_grey_mo_co_W",
     "ghost_honorary_grey (?s ?p') = {?r} ==>
      grey ?g
       (?s(?p' := ?s ?p'
             (| W := insert ?r (W (?s ?p')),
                ghost_honorary_grey := {} |))) =
      grey ?g ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 8, template_app (template_var 3, template_var 2)),
          template_app
           (template_app (template_hole 7, template_var 1),
            template_hole 6))],
       template_equation
        (template_app
          (template_app (template_hole 4, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 3, template_var 3),
               template_var 2),
             template_app
              (template_app (template_hole 2, t_empty),
               template_app
                (template_app (template_hole 1, t_empty),
                 template_app (template_var 3, template_var 2))))),
         template_app
          (template_app (template_hole 4, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.mutator_reachable_tso",
     "sys_mem_store_buffers (mutator ?m) ?s =
      mw_Mutate ?r ?f ?opt_r' # ?ws ==>
      mut_m.reachable ?m ?r ?s &
      (ALL r'. ?opt_r' = Some r' --> mut_m.reachable ?m r' ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 10,
              template_app (template_var 5, template_hole 9)),
            template_app (template_hole 8, template_var 4)),
          template_app
           (template_app
             (template_hole 7,
              template_app
               (template_app
                 (template_app (template_hole 6, template_var 3),
                  template_var 2),
                template_var 1)),
            template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 5,
               template_app
                (template_app
                  (template_app (template_hole 4, template_var 4),
                   template_var 3),
                 template_var 5)),
             template_app (template_hole 3, t_empty))
           ))),
    ("Global_Invariants_Lemmas.valid_W_inv_no_mark_stores_invD",
     "[| sys_mem_lock ?s ~= Some ?p; valid_W_inv ?s |]
      ==> filter is_mw_Mark (sys_mem_store_buffers ?p ?s) = []",
     template_implication
      ([template_negation
         (
            template_equation
             (template_app
               (template_hole 11,
                template_app (template_var 1, template_hole 10)),
              template_app (template_hole 9, template_var 0))
            ),
        template_predicate
         (template_app (template_hole 8, template_var 1))],
       template_equation
        (template_app
          (template_app (template_hole 6, t_empty),
           template_app
            (template_app
              (template_hole 1,
               template_app (template_var 1, template_hole 10)),
             template_var 0)),
         template_hole 0))),
    ("Global_Invariants_Lemmas.marked_insertionD",
     "[| sys_mem_store_buffers (mutator ?m) ?s =
         mw_Mutate ?r ?f (Some ?r') # ?ws;
         mut_m.marked_insertions ?m ?s |]
      ==> marked ?r' ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 10,
              template_app (template_var 5, template_hole 9)),
            template_app (template_hole 8, template_var 4)),
          template_app
           (template_app
             (template_hole 7,
              template_app
               (template_app
                 (template_app (template_hole 6, template_var 3),
                  template_var 2),
                template_app (template_hole 5, template_var 1))),
            template_var 0)),
        template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 4),
              template_var 5)
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 3, t_empty), template_var 1),
             template_var 5)
           ))),
    ("Global_Invariants_Lemmas.valid_W_invE",
     "[| ?r : ghost_honorary_grey (?s ?p); sys_mem_lock ?s ~= Some ?p;
         valid_W_inv ?s |]
      ==> marked ?r ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 11, template_var 2),
              template_app
               (template_hole 10,
                template_app (template_var 1, template_var 0)))
            ),
        template_negation
         (
            template_equation
             (template_app
               (template_hole 7,
                template_app (template_var 1, template_hole 6)),
              template_app (template_hole 5, template_var 0))
            ),
        template_predicate
         (template_app (template_hole 4, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 3, t_empty), template_var 2),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.mutator_phase_inv_aux_case",
     "mut_m.mutator_phase_inv_aux ?xga ?xa =
      (case ?xa of hp_Idle => %s. True | hp_IdleInit => no_black_refs
       | hp_InitMark => mut_m.marked_insertions ?xga
       | hp_Mark =>
           %s. mut_m.marked_insertions ?xga s &
               mut_m.marked_deletions ?xga s
       | hp_IdleMarkSweep =>
           %s. mut_m.marked_insertions ?xga s &
               mut_m.marked_deletions ?xga s &
               mut_m.reachable_snapshot_inv ?xga s)",
     template_equation
      (template_app
        (template_app (template_hole 7, template_var 1), template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 6, t_empty), template_hole 4),
               template_app (template_hole 3, template_var 1)),
             t_empty),
           t_empty),
         template_var 0))),
    ("Global_Invariants_Lemmas.tso_no_pending_marksD",
     "filter is_mw_Mark (sys_mem_store_buffers ?p ?s) = [] ==>
      sys_load ?p (mr_Mark ?r) (?s sys) =
      mv_Mark (map_option obj_mark (sys_heap ?s ?r))",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 14, t_empty),
            template_app
             (template_app
               (template_hole 9,
                template_app (template_var 2, template_hole 8)),
              template_var 1)),
          template_hole 7)],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 1),
             template_app (template_hole 4, template_var 0)),
           template_app (template_var 2, template_hole 8)),
         template_app
          (template_hole 3,
           template_app
            (template_app (template_hole 2, template_hole 1),
             template_app
              (template_app
                (template_hole 0,
                 template_app (template_var 2, template_hole 8)),
               template_var 0)))))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(mutator ?m' := ?s (mutator ?m')
             (| roots := insert ?r (roots (?s (mutator ?m'))) |),
           sys := ?s sys(| heap := sys_heap ?s(?r |-> ?obj) |))) =
      mut_m.tso_store_refs ?m ?s",
     template_equation
      (template_app
        (template_app (template_hole 10, template_var 4),
         template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 3),
                   template_app (template_hole 8, template_var 2)),
                 template_app
                  (template_app (template_hole 7, t_empty),
                   template_app
                    (template_var 3,
                     template_app (template_hole 8, template_var 2))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app (template_var 3, template_hole 4)))),
       template_app
        (template_app (template_hole 10, template_var 4), template_var 3))),
    ("Global_Invariants_Lemmas.colours_blacken",
     "valid_W_inv ?s ==>
      black ?b (?s(gc := ?s gc(| W := gc_W ?s - {?r} |))) =
      (black ?b ?s | ?r : gc_W ?s & ?b = ?r)",
     template_implication
      ([template_predicate
         (template_app (template_hole 13, template_var 2))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 11, template_var 1),
                template_app
                 (template_app
                   (template_app (template_hole 10, template_var 2),
                    template_hole 9),
                  template_app
                   (template_app (template_hole 8, t_empty),
                    template_app (template_var 2, template_hole 9))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 3,
                 template_app
                  (template_app (template_hole 11, template_var 1),
                   template_var 2)),
               template_app
                (template_app
                  (template_hole 2,
                   template_app
                    (template_app (template_hole 1, template_var 0),
                     template_app
                      (template_hole 6,
                       template_app (template_var 2, template_hole 9)))),
                 template_app
                  (template_app (template_hole 0, template_var 1),
                   template_var 0)))
             )))),
    ("Global_Invariants_Lemmas.grey_protects_white_mark",
     "ghost_honorary_grey (?s ?p) = {} ==>
      (EX g. (g grey_protects_white ?w)
              (?s(?p := ?s ?p(| ghost_honorary_grey := {?r} |)))) =
      ((EX g'. (g' grey_protects_white ?w) ?s) |
       (?r has_white_path_to ?w) ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 9, template_app (template_var 3, template_var 2)),
          template_hole 8)],
       template_equation
        (template_app (template_hole 6, t_empty),
         template_app
          (template_app
            (template_hole 1, template_app (template_hole 6, t_empty)),
           template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 1),
             template_var 3))))),
    ("Global_Invariants_Lemmas.grey_fun_upd",
     "(?r : (UN p. WL p (?s(?fld := ?val)))) = (?r : (UN p. WL p ?s)) ==>
      grey ?r (?s(?fld := ?val)) = grey ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 6, template_var 3),
            template_app
             (template_hole 5,
              template_app
               (template_app (template_hole 4, t_empty), template_hole 1))),
          template_app
           (template_app (template_hole 6, template_var 3),
            template_app
             (template_hole 5,
              template_app
               (template_app (template_hole 4, t_empty),
                template_hole 1))))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 3),
           template_app
            (template_app
              (template_app (template_hole 2, template_var 2),
               template_var 1),
             template_var 0)),
         template_app
          (template_app (template_hole 0, template_var 3),
           template_var 2)))),
    ("Global_Invariants_Lemmas.WL_fun_upd",
     "[| ghost_honorary_grey ((?s(?fld := ?val)) ?p) =
         ghost_honorary_grey (?s ?p);
         W ((?s(?fld := ?val)) ?p) = W (?s ?p) |]
      ==> WL ?p (?s(?fld := ?val)) = WL ?p ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 3,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 2, template_var 3),
                  template_var 2),
                template_var 1),
              template_var 0)),
          template_app
           (template_hole 3,
            template_app (template_var 3, template_var 0))),
        template_equation
         (template_app
           (template_hole 1,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 2, template_var 3),
                  template_var 2),
                template_var 1),
              template_var 0)),
          template_app
           (template_hole 1,
            template_app (template_var 3, template_var 0)))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 2, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.colours_alloc",
     "grey ?r
       (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
           sys := ?s sys
             (| heap := sys_heap ?s(?r' |->
                  (| obj_mark = ?fl, obj_fields = Map.empty,
                     obj_payload = Map.empty |)) |))) =
      grey ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 12, template_var 5),
         template_app
          (template_app
            (template_app
              (template_hole 11,
               template_app
                (template_app
                  (template_app (template_hole 11, template_var 4),
                   template_app (template_hole 10, template_var 3)),
                 template_app
                  (template_app (template_hole 9, t_empty),
                   template_app
                    (template_var 4,
                     template_app (template_hole 10, template_var 3))))),
             template_hole 8),
           template_app
            (template_app (template_hole 7, t_empty),
             template_app (template_var 4, template_hole 8)))),
       template_app
        (template_app (template_hole 12, template_var 5), template_var 4))),
    ("Global_Invariants_Lemmas.colours_flip_fM",
     "?fl ~= sys_fM ?s ==>
      black ?b
       (?s(sys := ?s sys
             (| fM := ?fl,
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      (white ?b ?s & ~ grey ?b ?s)",
     template_implication
      ([template_negation
         (
            template_equation
             (template_var 4,
              template_app
               (template_hole 10,
                template_app (template_var 3, template_hole 9)))
            )],
       template_equation
        (template_app
          (template_app (template_hole 8, template_var 2),
           template_app
            (template_app
              (template_app (template_hole 7, template_var 3),
               template_hole 9),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 3, t_empty),
                 template_app (template_var 3, template_hole 9))))),
         template_app
          (template_app
            (template_hole 2,
             template_app
              (template_app (template_hole 1, template_var 2),
               template_var 3)),
           template_app
            (template_hole 12,
             template_app
              (template_app (template_hole 0, template_var 2),
               template_var 3)))))),
    ("Global_Invariants_Lemmas.colours_get_work_done",
     "black ?r
       (?s(mutator ?m := ?s (mutator ?m)(| W := {} |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      black ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 9, template_var 4),
         template_app
          (template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app
                  (template_app (template_hole 8, template_var 3),
                   template_app (template_hole 7, template_var 2)),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app
                    (template_var 3,
                     template_app (template_hole 7, template_var 2))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 3, template_hole 4)))))),
       template_app
        (template_app (template_hole 9, template_var 4), template_var 3))),
    ("Global_Invariants_Lemmas.colours_get_work_done",
     "grey ?r
       (?s(mutator ?m := ?s (mutator ?m)(| W := {} |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      grey ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 9, template_var 4),
         template_app
          (template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app
                  (template_app (template_hole 8, template_var 3),
                   template_app (template_hole 7, template_var 2)),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app
                    (template_var 3,
                     template_app (template_hole 7, template_var 2))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 3, template_hole 4)))))),
       template_app
        (template_app (template_hole 9, template_var 4), template_var 3))),
    ("Global_Invariants_Lemmas.colours_get_work_done",
     "white ?r
       (?s(mutator ?m := ?s (mutator ?m)(| W := {} |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      white ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 9, template_var 4),
         template_app
          (template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app
                  (template_app (template_hole 8, template_var 3),
                   template_app (template_hole 7, template_var 2)),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app
                    (template_var 3,
                     template_app (template_hole 7, template_var 2))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 3, template_hole 4)))))),
       template_app
        (template_app (template_hole 9, template_var 4), template_var 3))),
    ("Global_Invariants_Lemmas.colours_blacken",
     "[| ?r : gc_W ?s; valid_W_inv ?s |]
      ==> grey ?g (?s(gc := ?s gc(| W := gc_W ?s - {?r} |))) =
          (grey ?g ?s & ?g ~= ?r)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 13, template_var 2),
              template_app
               (template_hole 12,
                template_app (template_var 1, template_hole 11)))
            ),
        template_predicate
         (template_app (template_hole 10, template_var 1))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 8, template_var 0),
                template_app
                 (template_app
                   (template_app (template_hole 7, template_var 1),
                    template_hole 11),
                  template_app
                   (template_app (template_hole 6, t_empty),
                    template_app (template_var 1, template_hole 11))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app (template_hole 8, template_var 0),
                   template_var 1)),
               template_app
                (template_hole 1,
                 template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 2)))
             )))),
    ("Global_Invariants_Lemmas.phase_rel_invD",
     "phase_rel_inv ?s ==>
      (ALL m. sys_ghost_hs_in_sync m ?s, sys_ghost_hs_phase ?s, gc_phase ?s,
       sys_phase ?s, filter is_mw_Phase (sys_mem_store_buffers gc ?s))
      : phase_rel",
     template_implication
      ([template_predicate
         (template_app (template_hole 17, template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 16,
               template_app
                (template_app
                  (template_hole 15,
                   template_app (template_hole 14, t_empty)),
                 template_app
                  (template_app
                    (template_hole 11,
                     template_app
                      (template_hole 10,
                       template_app (template_var 0, template_hole 12))),
                   template_app
                    (template_app
                      (template_hole 9,
                       template_app
                        (template_hole 8,
                         template_app (template_var 0, template_hole 7))),
                     template_app
                      (template_app
                        (template_hole 6,
                         template_app
                          (template_hole 8,
                           template_app
                            (template_var 0, template_hole 12))),
                       template_app
                        (template_app (template_hole 5, t_empty),
                         template_app
                          (template_app
                            (template_hole 1,
                             template_app
                              (template_var 0, template_hole 12)),
                           template_hole 7))))))),
             template_hole 0)
           ))),
    ("Global_Invariants_Lemmas.WL_mo_co_mark",
     "ghost_honorary_grey (?s ?p) = {} ==>
      WL ?p' (?s(?p := ?s ?p(| ghost_honorary_grey := ?rs |))) =
      WL ?p' ?s Un {r |r. ?p' = ?p & r : ?rs}",
     template_implication
      ([template_equation
         (template_app
           (template_hole 11,
            template_app (template_var 3, template_var 2)),
          template_hole 10)],
       template_equation
        (template_app
          (template_app (template_hole 9, template_var 1),
           template_app
            (template_app
              (template_app (template_hole 8, template_var 3),
               template_var 2),
             template_app
              (template_app (template_hole 7, t_empty),
               template_app (template_var 3, template_var 2)))),
         template_app
          (template_app
            (template_hole 6,
             template_app
              (template_app (template_hole 9, template_var 1),
               template_var 3)),
           template_app (template_hole 5, t_empty))))),
    ("Global_Invariants_Lemmas.strong_tricolour_invD",
     "[| black ?x ?s; (?x points_to ?y) ?s; obj_at (%s. True) ?y ?s;
         strong_tricolour_inv ?s |]
      ==> marked ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 10, template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 9, t_empty), template_var 2),
              template_var 1)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 9, t_empty), template_var 0),
              template_var 1)
            ),
        template_predicate
         (template_app (template_hole 4, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 9, t_empty), template_var 0),
             template_var 1)
           ))),
    ("Global_Invariants_Lemmas.mut_m_not_idle_no_fM_write",
     "[| ghost_hs_phase (?s (mutator ?m)) ~= hp_Idle; fM_rel_inv ?s;
         handshake_phase_inv ?s; tso_store_inv ?s; ?p ~= sys |]
      ==> sys_mem_store_buffers ?p ?s ~= mw_fM ?fl # ?ws",
     template_implication
      ([template_negation
         (
            template_equation
             (template_app
               (template_hole 11,
                template_app
                 (template_var 4,
                  template_app (template_hole 10, template_var 3))),
              template_hole 9)
            ),
        template_predicate (template_app (template_hole 8, template_var 4)),
        template_predicate (template_app (template_hole 7, template_var 4)),
        template_predicate (template_app (template_hole 6, template_var 4)),
        template_negation
         (template_equation (template_var 2, template_hole 4))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_hole 2,
                 template_app (template_var 4, template_hole 4)),
               template_var 2),
             template_app
              (template_app
                (template_hole 1,
                 template_app (template_hole 0, template_var 1)),
               template_var 0))
           ))),
    ("Global_Invariants_Lemmas.colours_get_roots_done",
     "black ?r
       (?s(mutator ?m := ?s (mutator ?m)
             (| W := {}, ghost_hs_phase := ?hs' |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      black ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 10, template_var 5),
         template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 3)),
                 template_app
                  (template_app (template_hole 7, t_empty),
                   template_app
                    (template_app (template_hole 6, t_empty),
                     template_app
                      (template_var 4,
                       template_app (template_hole 8, template_var 3)))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 4, template_hole 4)))))),
       template_app
        (template_app (template_hole 10, template_var 5), template_var 4))),
    ("Global_Invariants_Lemmas.colours_get_roots_done",
     "grey ?r
       (?s(mutator ?m := ?s (mutator ?m)
             (| W := {}, ghost_hs_phase := ?hs' |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      grey ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 10, template_var 5),
         template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 3)),
                 template_app
                  (template_app (template_hole 7, t_empty),
                   template_app
                    (template_app (template_hole 6, t_empty),
                     template_app
                      (template_var 4,
                       template_app (template_hole 8, template_var 3)))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 4, template_hole 4)))))),
       template_app
        (template_app (template_hole 10, template_var 5), template_var 4))),
    ("Global_Invariants_Lemmas.colours_get_roots_done",
     "white ?r
       (?s(mutator ?m := ?s (mutator ?m)
             (| W := {}, ghost_hs_phase := ?hs' |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      white ?r ?s",
     template_equation
      (template_app
        (template_app (template_hole 10, template_var 5),
         template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 3)),
                 template_app
                  (template_app (template_hole 7, t_empty),
                   template_app
                    (template_app (template_hole 6, t_empty),
                     template_app
                      (template_var 4,
                       template_app (template_hole 8, template_var 3)))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 4, template_hole 4)))))),
       template_app
        (template_app (template_hole 10, template_var 5), template_var 4))),
    ("Global_Invariants_Lemmas.marked_deletions_store_buffer_empty",
     "filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
       (sys_mem_store_buffers (mutator ?m) ?s) =
      [] ==>
      mut_m.marked_deletions ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 13, t_empty),
            template_app
             (template_app
               (template_hole 4,
                template_app (template_var 1, template_hole 3)),
              template_app (template_hole 2, template_var 0))),
          template_hole 1)],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 0), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.marked_insertions_store_buffer_empty",
     "filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
       (sys_mem_store_buffers (mutator ?m) ?s) =
      [] ==>
      mut_m.marked_insertions ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 13, t_empty),
            template_app
             (template_app
               (template_hole 4,
                template_app (template_var 1, template_hole 3)),
              template_app (template_hole 2, template_var 0))),
          template_hole 1)],
       template_predicate
        (
           template_app
            (template_app (template_hole 0, template_var 0), template_var 1)
           ))),
    ("Global_Invariants_Lemmas.mut_m_not_idle_no_fM_writeD",
     "[| sys_mem_store_buffers ?p ?s = mw_fM ?fl # ?ws;
         ghost_hs_phase (?s (mutator ?m)) ~= hp_Idle; fM_rel_inv ?s;
         handshake_phase_inv ?s; tso_store_inv ?s; ?p ~= sys |]
      ==> False",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 13,
              template_app (template_var 4, template_hole 12)),
            template_var 3),
          template_app
           (template_app
             (template_hole 11,
              template_app (template_hole 10, template_var 2)),
            template_var 1)),
        template_negation
         (
            template_equation
             (template_app
               (template_hole 7,
                template_app
                 (template_var 4,
                  template_app (template_hole 6, template_var 0))),
              template_hole 5)
            ),
        template_predicate (template_app (template_hole 4, template_var 4)),
        template_predicate (template_app (template_hole 3, template_var 4)),
        template_predicate (template_app (template_hole 2, template_var 4)),
        template_negation
         (template_equation (template_var 3, template_hole 12))],
       template_predicate (template_hole 0))),
    ("Global_Invariants_Lemmas.obj_at_alloc",
     "sys_heap ?s ?r' = None ==>
      obj_at ?P ?r
       (?s(?m := ?mut_m_s',
           sys := ?s sys(| heap := sys_heap ?s(?r' |-> ?obj) |))) =
      (obj_at ?P ?r ?s | ?r = ?r' & ?P ?obj)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 11,
              template_app (template_var 6, template_hole 10)),
            template_var 5),
          template_hole 9)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app
                 (template_app (template_hole 7, template_var 4),
                  template_var 3),
                template_app
                 (template_app
                   (template_app
                     (template_hole 6,
                      template_app
                       (template_app
                         (template_app (template_hole 6, template_var 6),
                          template_var 2),
                        template_var 1)),
                    template_hole 10),
                  template_app
                   (template_app (template_hole 5, t_empty),
                    template_app (template_var 6, template_hole 10))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 2,
                 template_app
                  (template_app
                    (template_app (template_hole 7, template_var 4),
                     template_var 3),
                   template_var 6)),
               template_app
                (template_app
                  (template_hole 1,
                   template_app
                    (template_app (template_hole 0, template_var 3),
                     template_var 5)),
                 template_app (template_var 4, template_var 0)))
             )))),
    ("Global_Invariants_Lemmas.white_fun_upd",
     "[| sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         map_option obj_mark (sys_heap (?s(?fld := ?val)) ?r) =
         map_option obj_mark (sys_heap ?s ?r) |]
      ==> white ?r (?s(?fld := ?val)) = white ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 7,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 6, template_var 3),
                  template_var 2),
                template_var 1),
              template_hole 5)),
          template_app
           (template_hole 7,
            template_app (template_var 3, template_hole 5))),
        template_equation
         (template_app
           (template_app (template_hole 3, template_hole 2),
            template_app
             (template_app
               (template_hole 1,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 6, template_var 3),
                      template_var 2),
                    template_var 1),
                  template_hole 5)),
              template_var 0)),
          template_app
           (template_app (template_hole 3, template_hole 2),
            template_app
             (template_app
               (template_hole 1,
                template_app (template_var 3, template_hole 5)),
              template_var 0)))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 6, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.white_heap_fun_upd",
     "[| sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x) |]
      ==> white_heap (?s(?fld := ?val)) = white_heap ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 8,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 7, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 6)),
          template_app
           (template_hole 8,
            template_app (template_var 2, template_hole 6))),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 7, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.grey_protects_white_hs_done",
     "(?g grey_protects_white ?w)
       (?s(mutator ?m := ?s (mutator ?m)
             (| W := {}, ghost_hs_phase := ?hs' |),
           sys := ?s sys
             (| hs_pending := ?hp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?his' |))) =
      (?g grey_protects_white ?w) ?s",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 10, template_var 6), template_var 5),
         template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 3)),
                 template_app
                  (template_app (template_hole 7, t_empty),
                   template_app
                    (template_app (template_hole 6, t_empty),
                     template_app
                      (template_var 4,
                       template_app (template_hole 8, template_var 3)))))),
             template_hole 4),
           template_app
            (template_app (template_hole 3, t_empty),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 0, t_empty),
                 template_app (template_var 4, template_hole 4)))))),
       template_app
        (template_app
          (template_app (template_hole 10, template_var 6), template_var 5),
         template_var 4))),
    ("Global_Invariants_Lemmas.WL_blacken",
     "gc_ghost_honorary_grey ?s = {} ==>
      WL ?p (?s(gc := ?s gc(| W := gc_W ?s - ?rs |))) =
      WL ?p ?s - {r |r. ?p = gc & r : ?rs}",
     template_implication
      ([template_equation
         (template_app
           (template_hole 13,
            template_app (template_var 2, template_hole 12)),
          template_hole 11)],
       template_equation
        (template_app
          (template_app (template_hole 10, template_var 1),
           template_app
            (template_app
              (template_app (template_hole 9, template_var 2),
               template_hole 12),
             template_app
              (template_app (template_hole 8, t_empty),
               template_app (template_var 2, template_hole 12)))),
         template_app
          (template_app
            (template_hole 7,
             template_app
              (template_app (template_hole 10, template_var 1),
               template_var 2)),
           template_app (template_hole 5, t_empty))))),
    ("Global_Invariants_Lemmas.valid_refs_invI",
     "(!!m x y.
          [| (x reaches y) ?s;
             x : roots (?s (mutator m)) Un
                 ghost_honorary_root (?s (mutator m)) Un
                 mut_m.tso_store_refs m ?s |
             grey x ?s |]
          ==> obj_at (%s. True) y ?s) ==>
      valid_refs_inv ?s",
     template_implication
      ([template_predicate (template_app (template_hole 14, t_empty))],
       template_predicate
        (template_app (template_hole 0, template_var 0)))),
    ("Global_Invariants_Lemmas.tso_store_inv_sys_load_Mut",
     "[| tso_store_inv ?s;
         (?ract, ?v)
         : {(mr_fM, mv_Mark (Some (sys_fM ?s))),
            (mr_fA, mv_Mark (Some (sys_fA ?s))),
            (mr_Phase, mv_Phase (sys_phase ?s))} |]
      ==> sys_load (mutator ?m) ?ract (?s sys) = ?v",
     template_implication
      ([template_predicate
         (template_app (template_hole 17, template_var 3)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 2),
                  template_var 1)),
              template_app
               (template_app
                 (template_hole 14,
                  template_app
                   (template_app (template_hole 15, template_hole 13),
                    template_app
                     (template_hole 12,
                      template_app
                       (template_hole 11,
                        template_app
                         (template_hole 10,
                          template_app
                           (template_var 3, template_hole 9)))))),
                template_app
                 (template_app
                   (template_hole 14,
                    template_app
                     (template_app (template_hole 15, template_hole 8),
                      template_app
                       (template_hole 12,
                        template_app
                         (template_hole 11,
                          template_app
                           (template_hole 7,
                            template_app
                             (template_var 3, template_hole 9)))))),
                  template_app
                   (template_app
                     (template_hole 14,
                      template_app
                       (template_app (template_hole 15, template_hole 6),
                        template_app
                         (template_hole 5,
                          template_app
                           (template_hole 4,
                            template_app
                             (template_var 3, template_hole 9))))),
                    template_hole 3))))
            )],
       template_equation
        (template_app
          (template_app
            (template_app
              (template_hole 1,
               template_app (template_hole 0, template_var 0)),
             template_var 2),
           template_app (template_var 3, template_hole 9)),
         template_var 1))),
    ("Global_Invariants_Lemmas.fM_rel_invD",
     "fM_rel_inv ?x ==>
      (ALL x. sys_ghost_hs_in_sync x ?x, sys_ghost_hs_phase ?x, gc_fM ?x,
       sys_fM ?x, filter is_mw_fM (sys_mem_store_buffers gc ?x),
       sys_mem_lock ?x = Some gc)
      : fM_rel",
     template_implication
      ([template_predicate
         (template_app (template_hole 21, template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 20,
               template_app
                (template_app
                  (template_hole 19,
                   template_app (template_hole 18, t_empty)),
                 template_app
                  (template_app
                    (template_hole 15,
                     template_app
                      (template_hole 14,
                       template_app (template_var 0, template_hole 16))),
                   template_app
                    (template_app
                      (template_hole 13,
                       template_app
                        (template_hole 12,
                         template_app (template_var 0, template_hole 11))),
                     template_app
                      (template_app
                        (template_hole 10,
                         template_app
                          (template_hole 12,
                           template_app
                            (template_var 0, template_hole 16))),
                       template_app
                        (template_app
                          (template_hole 9,
                           template_app
                            (template_app (template_hole 8, t_empty),
                             template_app
                              (template_app
                                (template_hole 4,
                                 template_app
                                  (template_var 0, template_hole 16)),
                               template_hole 11))),
                         template_app
                          (template_app
                            (template_hole 3,
                             template_app
                              (template_hole 2,
                               template_app
                                (template_var 0, template_hole 16))),
                           template_app
                            (template_hole 1, template_hole 11)))))))),
             template_hole 0)
           ))),
    ("Global_Invariants_Lemmas.WL_load_W",
     "gc_W ?s = {} ==>
      WL ?p
       (?s(gc := ?s gc(| W := sys_W ?s |), sys := ?s sys(| W := {} |))) =
      (case ?p of mutator m => WL (mutator m) ?s
       | gc => WL gc ?s Un sys_W ?s | sys => sys_ghost_honorary_grey ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 10,
            template_app (template_var 1, template_hole 9)),
          template_hole 8)],
       template_equation
        (template_app
          (template_app (template_hole 7, template_var 0),
           template_app
            (template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app
                    (template_app (template_hole 6, template_var 1),
                     template_hole 9),
                   template_app
                    (template_app (template_hole 5, t_empty),
                     template_app (template_var 1, template_hole 9)))),
               template_hole 4),
             template_app
              (template_app (template_hole 5, t_empty),
               template_app (template_var 1, template_hole 4)))),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, t_empty),
               template_app
                (template_app
                  (template_hole 1,
                   template_app
                    (template_app (template_hole 7, template_hole 9),
                     template_var 1)),
                 template_app
                  (template_hole 10,
                   template_app (template_var 1, template_hole 4)))),
             template_app
              (template_hole 0,
               template_app (template_var 1, template_hole 4))),
           template_var 0)))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "sys_mem_store_buffers ?p ?s = mw_Mark ?r ?fl # ?ws ==>
      mut_m.tso_store_refs ?m
       (?s(sys := ?s sys
             (| heap := (sys_heap ?s)
                  (?r :=
                     map_option (obj_mark_update (%_. ?fl))
                      (sys_heap ?s ?r)),
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      mut_m.tso_store_refs ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 13,
              template_app (template_var 5, template_hole 12)),
            template_var 4),
          template_app
           (template_app
             (template_hole 11,
              template_app
               (template_app (template_hole 10, template_var 3),
                template_var 2)),
            template_var 1))],
       template_equation
        (template_app
          (template_app (template_hole 8, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 7, template_var 5),
               template_hole 12),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app
                (template_app (template_hole 4, t_empty),
                 template_app (template_var 5, template_hole 12))))),
         template_app
          (template_app (template_hole 8, template_var 0),
           template_var 5)))),
    ("Global_Invariants_Lemmas.heap_colours_alloc",
     "sys_heap ?s ?r' = None ==>
      white_heap
       (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
           sys := ?s sys
             (| heap := sys_heap ?s(?r' |->
                  (| obj_mark = ?fl, obj_fields = Map.empty,
                     obj_payload = Map.empty |)) |))) =
      (white_heap ?s & ?fl ~= sys_fM ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 17,
              template_app (template_var 4, template_hole 16)),
            template_var 3),
          template_hole 15)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_hole 13,
                template_app
                 (template_app
                   (template_app
                     (template_hole 12,
                      template_app
                       (template_app
                         (template_app (template_hole 12, template_var 4),
                          template_app (template_hole 11, template_var 2)),
                        template_app
                         (template_app (template_hole 10, t_empty),
                          template_app
                           (template_var 4,
                            template_app
                             (template_hole 11, template_var 2))))),
                    template_hole 16),
                  template_app
                   (template_app (template_hole 9, t_empty),
                    template_app (template_var 4, template_hole 16))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 2,
                 template_app (template_hole 13, template_var 4)),
               template_app
                (template_hole 1,
                 template_app
                  (template_app (template_hole 14, template_var 0),
                   template_app
                    (template_hole 0,
                     template_app (template_var 4, template_hole 16)))))
             )))),
    ("Global_Invariants_Lemmas.no_black_refs_dequeue",
     "[| sys_mem_store_buffers ?p ?s = mw_Mark ?r ?fl # ?ws;
         no_black_refs ?s; valid_W_inv ?s |]
      ==> no_black_refs
           (?s(sys := ?s sys
                 (| heap := (sys_heap ?s)
                      (?r :=
                         map_option (obj_mark_update (%_. ?fl))
                          (sys_heap ?s ?r)),
                    mem_store_buffers := (mem_store_buffers (?s sys))
                      (?p := ?ws) |)))",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 13,
              template_app (template_var 4, template_hole 12)),
            template_var 3),
          template_app
           (template_app
             (template_hole 11,
              template_app
               (template_app (template_hole 10, template_var 2),
                template_var 1)),
            template_var 0)),
        template_predicate (template_app (template_hole 9, template_var 4)),
        template_predicate
         (template_app (template_hole 8, template_var 4))],
       template_predicate
        (
           template_app
            (template_hole 9,
             template_app
              (template_app
                (template_app (template_hole 7, template_var 4),
                 template_hole 12),
               template_app
                (template_app (template_hole 6, t_empty),
                 template_app
                  (template_app (template_hole 4, t_empty),
                   template_app (template_var 4, template_hole 12)))))
           ))),
    ("Global_Invariants_Lemmas.heap_colours_alloc",
     "[| sys_heap ?s ?r' = None; valid_refs_inv ?s |]
      ==> black_heap
           (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
               sys := ?s sys
                 (| heap := sys_heap ?s(?r' |->
                      (| obj_mark = ?fl, obj_fields = Map.empty,
                         obj_payload = Map.empty |)) |))) =
          (black_heap ?s & ?fl = sys_fM ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 17,
              template_app (template_var 4, template_hole 16)),
            template_var 3),
          template_hole 15),
        template_predicate
         (template_app (template_hole 14, template_var 4))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_hole 12,
                template_app
                 (template_app
                   (template_app
                     (template_hole 11,
                      template_app
                       (template_app
                         (template_app (template_hole 11, template_var 4),
                          template_app (template_hole 10, template_var 2)),
                        template_app
                         (template_app (template_hole 9, t_empty),
                          template_app
                           (template_var 4,
                            template_app
                             (template_hole 10, template_var 2))))),
                    template_hole 16),
                  template_app
                   (template_app (template_hole 8, t_empty),
                    template_app (template_var 4, template_hole 16))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 1,
                 template_app (template_hole 12, template_var 4)),
               template_app
                (template_app (template_hole 13, template_var 0),
                 template_app
                  (template_hole 0,
                   template_app (template_var 4, template_hole 16))))
             )))),
    ("Global_Invariants_Lemmas.reachable_deref_del",
     "[| sys_load (mutator ?m) (mr_Ref ?r ?f) (?s sys) = mv_Ref ?opt_r';
         ?r : roots (?s (mutator ?m));
         ghost_honorary_root (?s (mutator ?m)) = {} |]
      ==> mut_m.reachable ?m' ?y
           (?s(mutator ?m := ?s (mutator ?m)
                 (| ghost_honorary_root := set_option ?opt_r',
                    ref := ?opt_r' |))) =
          mut_m.reachable ?m' ?y ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_app
               (template_hole 15,
                template_app (template_hole 14, template_var 6)),
              template_app
               (template_app (template_hole 13, template_var 5),
                template_var 4)),
            template_app (template_var 3, template_hole 12)),
          template_app (template_hole 11, template_var 2)),
        template_predicate
         (
            template_app
             (template_app (template_hole 10, template_var 5),
              template_app
               (template_hole 9,
                template_app
                 (template_var 3,
                  template_app (template_hole 14, template_var 6))))
            ),
        template_equation
         (template_app
           (template_hole 7,
            template_app
             (template_var 3,
              template_app (template_hole 14, template_var 6))),
          template_hole 6)],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 1),
             template_var 0),
           template_app
            (template_app
              (template_app (template_hole 3, template_var 3),
               template_app (template_hole 14, template_var 6)),
             template_app
              (template_app (template_hole 2, t_empty),
               template_app
                (template_app (template_hole 1, t_empty),
                 template_app
                  (template_var 3,
                   template_app (template_hole 14, template_var 6)))))),
         template_app
          (template_app
            (template_app (template_hole 4, template_var 1),
             template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.grey_protects_white_alloc",
     "[| ?fl = sys_fM ?s; sys_heap ?s ?r = None |]
      ==> (?g grey_protects_white ?w)
           (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
               sys := ?s sys
                 (| heap := sys_heap ?s(?r |->
                      (| obj_mark = ?fl, obj_fields = Map.empty,
                         obj_payload = Map.empty |)) |))) =
          (?g grey_protects_white ?w) ?s",
     template_implication
      ([template_equation
         (template_var 6,
          template_app
           (template_hole 15,
            template_app (template_var 5, template_hole 14))),
        template_equation
         (template_app
           (template_app
             (template_hole 12,
              template_app (template_var 5, template_hole 14)),
            template_var 4),
          template_hole 11)],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 10, template_var 3),
             template_var 2),
           template_app
            (template_app
              (template_app
                (template_hole 9,
                 template_app
                  (template_app
                    (template_app (template_hole 9, template_var 5),
                     template_app (template_hole 8, template_var 1)),
                   template_app
                    (template_app (template_hole 7, t_empty),
                     template_app
                      (template_var 5,
                       template_app (template_hole 8, template_var 1))))),
               template_hole 14),
             template_app
              (template_app (template_hole 6, t_empty),
               template_app (template_var 5, template_hole 14)))),
         template_app
          (template_app
            (template_app (template_hole 10, template_var 3),
             template_var 2),
           template_var 5)))),
    ("Global_Invariants_Lemmas.no_black_refs_dequeue",
     "[| sys_mem_store_buffers ?p ?s = mw_Mutate ?r ?f ?r' # ?ws;
         no_black_refs ?s |]
      ==> no_black_refs
           (?s(sys := ?s sys
                 (| heap := (sys_heap ?s)
                      (?r :=
                         map_option
                          (%obj. obj
                              (| obj_fields := (obj_fields obj)
                                   (?f := ?r') |))
                          (sys_heap ?s ?r)),
                    mem_store_buffers := (mem_store_buffers (?s sys))
                      (?p := ?ws) |)))",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 14,
              template_app (template_var 5, template_hole 13)),
            template_var 4),
          template_app
           (template_app
             (template_hole 12,
              template_app
               (template_app
                 (template_app (template_hole 11, template_var 3),
                  template_var 2),
                template_var 1)),
            template_var 0)),
        template_predicate
         (template_app (template_hole 10, template_var 5))],
       template_predicate
        (
           template_app
            (template_hole 10,
             template_app
              (template_app
                (template_app (template_hole 9, template_var 5),
                 template_hole 13),
               template_app
                (template_app (template_hole 8, t_empty),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app (template_var 5, template_hole 13)))))
           ))),
    ("Global_Invariants_Lemmas.no_black_refs_alloc",
     "[| sys_heap ?s ?r' = None; no_black_refs ?s |]
      ==> no_black_refs
           (?s(mutator ?m' := ?s (mutator ?m')(| roots := ?roots' |),
               sys := ?s sys
                 (| heap := sys_heap ?s(?r' |->
                      (| obj_mark = ?fl, obj_fields = Map.empty,
                         obj_payload = Map.empty |)) |))) =
          (?fl ~= sys_fM ?s | grey ?r' ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 18,
              template_app (template_var 4, template_hole 17)),
            template_var 3),
          template_hole 16),
        template_predicate
         (template_app (template_hole 15, template_var 4))],
       template_implication
        ([template_predicate
           (
              template_app
               (template_hole 15,
                template_app
                 (template_app
                   (template_app
                     (template_hole 13,
                      template_app
                       (template_app
                         (template_app (template_hole 13, template_var 4),
                          template_app (template_hole 12, template_var 2)),
                        template_app
                         (template_app (template_hole 11, t_empty),
                          template_app
                           (template_var 4,
                            template_app
                             (template_hole 12, template_var 2))))),
                    template_hole 17),
                  template_app
                   (template_app (template_hole 10, t_empty),
                    template_app (template_var 4, template_hole 17))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 3,
                 template_app
                  (template_hole 2,
                   template_app
                    (template_app (template_hole 14, template_var 0),
                     template_app
                      (template_hole 1,
                       template_app (template_var 4, template_hole 17))))),
               template_app
                (template_app (template_hole 0, template_var 3),
                 template_var 4))
             )))),
    ("Global_Invariants_Lemmas.valid_W_invD",
     "[| sys_mem_store_buffers ?p ?s = mw_Mark ?r ?fl # ?ws;
         valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s & filter is_mw_Mark ?ws = []",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 18,
              template_app (template_var 4, template_hole 17)),
            template_var 3),
          template_app
           (template_app
             (template_hole 16,
              template_app
               (template_app (template_hole 15, template_var 2),
                template_var 1)),
            template_var 0)),
        template_predicate
         (template_app (template_hole 14, template_var 4))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 13,
               template_app
                (template_app (template_hole 12, template_var 1),
                 template_app
                  (template_hole 11,
                   template_app (template_var 4, template_hole 17)))),
             template_app
              (template_app
                (template_hole 13,
                 template_app
                  (template_app (template_hole 10, template_var 2),
                   template_app
                    (template_hole 9,
                     template_app (template_var 4, template_var 3)))),
               template_app
                (template_app
                  (template_hole 13,
                   template_app
                    (template_app
                      (template_hole 8,
                       template_app
                        (template_hole 7,
                         template_app (template_var 4, template_hole 17))),
                     template_app (template_hole 6, template_var 3))),
                 template_app
                  (template_app
                    (template_hole 13,
                     template_app
                      (template_app (template_hole 5, template_var 2),
                       template_var 4)),
                   template_app
                    (template_app
                      (template_hole 19,
                       template_app
                        (template_app (template_hole 4, t_empty),
                         template_var 0)),
                     template_hole 0)))))
           ))),
    ("Global_Invariants_Lemmas.sys_phase_inv_aux_case",
     "sys_phase_inv_aux ?xa =
      (case ?xa of
       hp_Idle =>
         %s. (if sys_fA s = sys_fM s then black_heap s else white_heap s) &
             no_grey_refs s
       | hp_IdleInit => no_black_refs
       | hp_InitMark => %s. sys_fA s ~= sys_fM s --> no_black_refs s
       | hp_Mark => %s. True
       | hp_IdleMarkSweep =>
           %s. sys_phase s = ph_Idle |
               mw_Phase ph_Idle : set (sys_mem_store_buffers gc s) -->
               no_grey_refs s)",
     template_equation
      (template_app (template_hole 23, template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 22, t_empty),
                 template_hole 12),
               t_empty),
             t_empty),
           t_empty),
         template_var 0))),
    ("Global_Invariants_Lemmas.colours_alloc",
     "sys_heap ?s ?r' = None ==>
      white ?r
       (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
           sys := ?s sys
             (| heap := sys_heap ?s(?r' |->
                  (| obj_mark = ?fl, obj_fields = Map.empty,
                     obj_payload = Map.empty |)) |))) =
      (white ?r ?s | ?r' = ?r & ?fl ~= sys_fM ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 19,
              template_app (template_var 5, template_hole 18)),
            template_var 4),
          template_hole 17)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 15, template_var 3),
                template_app
                 (template_app
                   (template_app
                     (template_hole 14,
                      template_app
                       (template_app
                         (template_app (template_hole 14, template_var 5),
                          template_app (template_hole 13, template_var 2)),
                        template_app
                         (template_app (template_hole 12, t_empty),
                          template_app
                           (template_var 5,
                            template_app
                             (template_hole 13, template_var 2))))),
                    template_hole 18),
                  template_app
                   (template_app (template_hole 11, t_empty),
                    template_app (template_var 5, template_hole 18))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 4,
                 template_app
                  (template_app (template_hole 15, template_var 3),
                   template_var 5)),
               template_app
                (template_app
                  (template_hole 3,
                   template_app
                    (template_app (template_hole 2, template_var 4),
                     template_var 3)),
                 template_app
                  (template_hole 1,
                   template_app
                    (template_app (template_hole 16, template_var 0),
                     template_app
                      (template_hole 0,
                       template_app (template_var 5, template_hole 18))))))
             )))),
    ("Global_Invariants_Lemmas.valid_refs_inv_dequeue_Mutate",
     "[| valid_refs_inv ?s;
         sys_mem_store_buffers (mutator ?m') ?s =
         mw_Mutate ?r ?f ?opt_r' # ?ws |]
      ==> valid_refs_inv
           (?s(sys := ?s sys
                 (| heap := (sys_heap ?s)
                      (?r :=
                         map_option
                          (%obj. obj
                              (| obj_fields := (obj_fields obj)
                                   (?f := ?opt_r') |))
                          (sys_heap ?s ?r)),
                    mem_store_buffers := (mem_store_buffers (?s sys))
                      (mutator ?m' := ?ws) |)))",
     template_implication
      ([template_predicate
         (template_app (template_hole 16, template_var 5)),
        template_equation
         (template_app
           (template_app
             (template_hole 14,
              template_app (template_var 5, template_hole 13)),
            template_app (template_hole 12, template_var 4)),
          template_app
           (template_app
             (template_hole 11,
              template_app
               (template_app
                 (template_app (template_hole 10, template_var 3),
                  template_var 2),
                template_var 1)),
            template_var 0))],
       template_predicate
        (
           template_app
            (template_hole 16,
             template_app
              (template_app
                (template_app (template_hole 9, template_var 5),
                 template_hole 13),
               template_app
                (template_app (template_hole 8, t_empty),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app (template_var 5, template_hole 13)))))
           ))),
    ("Global_Invariants_Lemmas.valid_refs_inv_dequeue_Mutate_Payload",
     "[| valid_refs_inv ?s;
         sys_mem_store_buffers (mutator ?m') ?s =
         mw_Mutate_Payload ?r ?f ?pl # ?ws |]
      ==> valid_refs_inv
           (?s(sys := ?s sys
                 (| heap := (sys_heap ?s)
                      (?r :=
                         map_option
                          (%obj. obj
                              (| obj_payload := (obj_payload obj)
                                   (?f := ?pl) |))
                          (sys_heap ?s ?r)),
                    mem_store_buffers := (mem_store_buffers (?s sys))
                      (mutator ?m := ?ws) |)))",
     template_implication
      ([template_predicate
         (template_app (template_hole 16, template_var 6)),
        template_equation
         (template_app
           (template_app
             (template_hole 14,
              template_app (template_var 6, template_hole 13)),
            template_app (template_hole 12, template_var 5)),
          template_app
           (template_app
             (template_hole 11,
              template_app
               (template_app
                 (template_app (template_hole 10, template_var 4),
                  template_var 3),
                template_var 2)),
            template_var 1))],
       template_predicate
        (
           template_app
            (template_hole 16,
             template_app
              (template_app
                (template_app (template_hole 9, template_var 6),
                 template_hole 13),
               template_app
                (template_app (template_hole 8, t_empty),
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app (template_var 6, template_hole 13)))))
           ))),
    ("Global_Invariants_Lemmas.has_white_path_to_induct",
     "[| (?x has_white_path_to ?y) ?s; !!x. ?P x x;
         !!x y z.
            [| (x has_white_path_to y) ?s; ?P x y; (y points_to z) ?s;
               white z ?s |]
            ==> ?P x z |]
      ==> ?P ?x ?y",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 6, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 5, t_empty)),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_predicate
        (
           template_app
            (template_app (template_var 0, template_var 3), template_var 2)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?w : set (sys_mem_store_buffers (mutator ?m) ?s);
         ?x : store_refs ?w; (?x reaches ?y) ?s; valid_refs_inv ?s |]
      ==> obj_at (%s. True) ?y ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 14, template_var 4),
              template_app
               (template_hole 13,
                template_app
                 (template_app
                   (template_hole 12,
                    template_app (template_var 3, template_hole 11)),
                  template_app (template_hole 10, template_var 2))))
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 9, template_var 1),
              template_app
               (template_app
                 (template_app
                   (template_app
                     (template_app
                       (template_app
                         (template_app (template_hole 8, t_empty), t_empty),
                        t_empty),
                      t_empty),
                    t_empty),
                  t_empty),
                template_var 4))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 3, template_var 1),
                template_var 0),
              template_var 3)
            ),
        template_predicate
         (template_app (template_hole 2, template_var 3))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 1, t_empty), template_var 0),
             template_var 3)
           ))),
    ("Global_Invariants_Lemmas.grey_reachable_fun_upd",
     "[| (UN p. WL p (?s(?fld := ?val))) = (UN p. WL p ?s);
         !!x. Set.bind (set_option (sys_heap (?s(?fld := ?val)) x))
               (ran o obj_fields) =
              Set.bind (set_option (sys_heap ?s x)) (ran o obj_fields) |]
      ==> grey_reachable ?r (?s(?fld := ?val)) = grey_reachable ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 14,
            template_app
             (template_app (template_hole 13, t_empty), template_hole 10)),
          template_app
           (template_hole 14,
            template_app
             (template_app (template_hole 13, t_empty), template_hole 10))),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 11, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.reachable_alloc",
     "sys_heap ?s ?r = None ==>
      mut_m.reachable ?m ?r'
       (?s(mutator ?m' := ?s (mutator ?m')
             (| roots := insert ?r (roots (?s (mutator ?m'))) |),
           sys := ?s sys
             (| heap := sys_heap ?s(?r |->
                  (| obj_mark = ?fl, obj_fields = Map.empty,
                     obj_payload = Map.empty |)) |))) =
      (mut_m.reachable ?m ?r' ?s | ?m' = ?m & ?r' = ?r)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 20,
              template_app (template_var 5, template_hole 19)),
            template_var 4),
          template_hole 18)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app
                 (template_app (template_hole 16, template_var 3),
                  template_var 2),
                template_app
                 (template_app
                   (template_app
                     (template_hole 15,
                      template_app
                       (template_app
                         (template_app (template_hole 15, template_var 5),
                          template_app (template_hole 14, template_var 1)),
                        template_app
                         (template_app (template_hole 13, t_empty),
                          template_app
                           (template_var 5,
                            template_app
                             (template_hole 14, template_var 1))))),
                    template_hole 19),
                  template_app
                   (template_app (template_hole 10, t_empty),
                    template_app (template_var 5, template_hole 19))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 3,
                 template_app
                  (template_app
                    (template_app (template_hole 16, template_var 3),
                     template_var 2),
                   template_var 5)),
               template_app
                (template_app
                  (template_hole 2,
                   template_app
                    (template_app (template_hole 1, template_var 1),
                     template_var 3)),
                 template_app
                  (template_app (template_hole 0, template_var 2),
                   template_var 4)))
             )))),
    ("Global_Invariants_Lemmas.colours_alloc",
     "sys_heap ?s ?r' = None ==>
      black ?r
       (?s(mutator ?m := ?s (mutator ?m)(| roots := ?roots' |),
           sys := ?s sys
             (| heap := sys_heap ?s(?r' |->
                  (| obj_mark = ?fl, obj_fields = Map.empty,
                     obj_payload = Map.empty |)) |))) =
      (black ?r ?s | ?r' = ?r & ?fl = sys_fM ?s & ~ grey ?r' ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 20,
              template_app (template_var 5, template_hole 19)),
            template_var 4),
          template_hole 18)],
       template_implication
        ([template_predicate
           (
              template_app
               (template_app (template_hole 16, template_var 3),
                template_app
                 (template_app
                   (template_app
                     (template_hole 15,
                      template_app
                       (template_app
                         (template_app (template_hole 15, template_var 5),
                          template_app (template_hole 14, template_var 2)),
                        template_app
                         (template_app (template_hole 13, t_empty),
                          template_app
                           (template_var 5,
                            template_app
                             (template_hole 14, template_var 2))))),
                    template_hole 19),
                  template_app
                   (template_app (template_hole 12, t_empty),
                    template_app (template_var 5, template_hole 19))))
              )],
         template_predicate
          (
             template_app
              (template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 16, template_var 3),
                   template_var 5)),
               template_app
                (template_app
                  (template_hole 4,
                   template_app
                    (template_app (template_hole 3, template_var 4),
                     template_var 3)),
                 template_app
                  (template_app
                    (template_hole 4,
                     template_app
                      (template_app (template_hole 17, template_var 0),
                       template_app
                        (template_hole 2,
                         template_app (template_var 5, template_hole 19)))),
                   template_app
                    (template_hole 1,
                     template_app
                      (template_app (template_hole 0, template_var 4),
                       template_var 5)))))
             )))),
    ("Global_Invariants_Lemmas.valid_W_invD",
     "[| mw_Mark ?r ?fl : set (sys_mem_store_buffers ?p ?s);
         valid_W_inv ?s |]
      ==> ?fl = sys_fM ?s &
          ?r : ghost_honorary_grey (?s ?p) &
          sys_mem_lock ?s = Some ?p &
          white ?r ?s &
          filter is_mw_Mark (sys_mem_store_buffers ?p ?s) =
          [mw_Mark ?r ?fl]",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 21,
                template_app
                 (template_app (template_hole 20, template_var 3),
                  template_var 2)),
              template_app
               (template_hole 19,
                template_app
                 (template_app
                   (template_hole 18,
                    template_app (template_var 1, template_hole 17)),
                  template_var 0)))
            ),
        template_predicate
         (template_app (template_hole 16, template_var 1))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 15,
               template_app
                (template_app (template_hole 14, template_var 2),
                 template_app
                  (template_hole 13,
                   template_app (template_var 1, template_hole 17)))),
             template_app
              (template_app
                (template_hole 15,
                 template_app
                  (template_app (template_hole 12, template_var 3),
                   template_app
                    (template_hole 11,
                     template_app (template_var 1, template_var 0)))),
               template_app
                (template_app
                  (template_hole 15,
                   template_app
                    (template_app
                      (template_hole 10,
                       template_app
                        (template_hole 9,
                         template_app (template_var 1, template_hole 17))),
                     template_app (template_hole 8, template_var 0))),
                 template_app
                  (template_app
                    (template_hole 15,
                     template_app
                      (template_app (template_hole 7, template_var 3),
                       template_var 1)),
                   template_app
                    (template_app
                      (template_hole 6,
                       template_app
                        (template_app (template_hole 5, t_empty),
                         template_app
                          (template_app
                            (template_hole 18,
                             template_app
                              (template_var 1, template_hole 17)),
                           template_var 0))),
                     template_app
                      (template_app
                        (template_hole 1,
                         template_app
                          (template_app (template_hole 20, template_var 3),
                           template_var 2)),
                       template_hole 0))))))
           ))),
    ("Global_Invariants_Lemmas.grey_protects_white_induct",
     "[| (?g grey_protects_white ?w) ?s; !!x. grey x ?s ==> ?P x x;
         !!x y z.
            [| (x has_white_path_to y) ?s; ?P x y; (y points_to z) ?s;
               white z ?s |]
            ==> ?P x z |]
      ==> ?P ?g ?w",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 8, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 7, t_empty)),
        template_predicate (template_app (template_hole 7, t_empty))],
       template_predicate
        (
           template_app
            (template_app (template_var 0, template_var 3), template_var 2)
           ))),
    ("Global_Invariants_Lemmas.valid_refs_invD",
     "[| ?w : set (sys_mem_store_buffers (mutator ?m) ?s);
         ?x : store_refs ?w; (?x reaches ?y) ?s; valid_refs_inv ?s |]
      ==> EX obj. sys_heap ?s ?y = Some obj",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 16, template_var 4),
              template_app
               (template_hole 15,
                template_app
                 (template_app
                   (template_hole 14,
                    template_app (template_var 3, template_hole 13)),
                  template_app (template_hole 12, template_var 2))))
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 11, template_var 1),
              template_app
               (template_app
                 (template_app
                   (template_app
                     (template_app
                       (template_app
                         (template_app (template_hole 10, t_empty),
                          t_empty),
                        t_empty),
                      t_empty),
                    t_empty),
                  t_empty),
                template_var 4))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 5, template_var 1),
                template_var 0),
              template_var 3)
            ),
        template_predicate
         (template_app (template_hole 4, template_var 3))],
       template_predicate (template_app (template_hole 3, t_empty)))),
    ("Global_Invariants_Lemmas.black_dequeue_Mark",
     "black ?b
       (?s(sys := ?s sys
             (| heap := (sys_heap ?s)
                  (?r :=
                     map_option (obj_mark_update (%_. ?fl))
                      (sys_heap ?s ?r)),
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      (black ?b ?s & ?b ~= ?r |
       ?b = ?r & ?fl = sys_fM ?s & obj_at (%s. True) ?r ?s & ~ grey ?r ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 18, template_var 5),
              template_app
               (template_app
                 (template_app (template_hole 17, template_var 4),
                  template_hole 16),
                template_app
                 (template_app (template_hole 15, t_empty),
                  template_app
                   (template_app (template_hole 12, t_empty),
                    template_app (template_var 4, template_hole 16)))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 7,
               template_app
                (template_app
                  (template_hole 6,
                   template_app
                    (template_app (template_hole 18, template_var 5),
                     template_var 4)),
                 template_app
                  (template_hole 5,
                   template_app
                    (template_app (template_hole 4, template_var 5),
                     template_var 1)))),
             template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app (template_hole 4, template_var 5),
                   template_var 1)),
               template_app
                (template_app
                  (template_hole 6,
                   template_app
                    (template_app (template_hole 19, template_var 0),
                     template_app
                      (template_hole 3,
                       template_app (template_var 4, template_hole 16)))),
                 template_app
                  (template_app
                    (template_hole 6,
                     template_app
                      (template_app
                        (template_app (template_hole 2, t_empty),
                         template_var 1),
                       template_var 4)),
                   template_app
                    (template_hole 5,
                     template_app
                      (template_app (template_hole 0, template_var 1),
                       template_var 4))))))
           ))),
    ("Global_Invariants_Lemmas.black_heap_fun_upd",
     "[| (UN p. WL p (?s(?fld := ?val))) = (UN p. WL p ?s);
         sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x) |]
      ==> black_heap (?s(?fld := ?val)) = black_heap ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 13,
            template_app
             (template_app (template_hole 12, t_empty), template_hole 9)),
          template_app
           (template_hole 13,
            template_app
             (template_app (template_hole 12, t_empty), template_hole 9))),
        template_equation
         (template_app
           (template_hole 7,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 10, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 6)),
          template_app
           (template_hole 7,
            template_app (template_var 2, template_hole 6))),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 10, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.no_black_refs_fun_upd",
     "[| (UN p. WL p (?s(?fld := ?val))) = (UN p. WL p ?s);
         sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x) |]
      ==> no_black_refs (?s(?fld := ?val)) = no_black_refs ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 13,
            template_app
             (template_app (template_hole 12, t_empty), template_hole 9)),
          template_app
           (template_hole 13,
            template_app
             (template_app (template_hole 12, t_empty), template_hole 9))),
        template_equation
         (template_app
           (template_hole 7,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 10, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 6)),
          template_app
           (template_hole 7,
            template_app (template_var 2, template_hole 6))),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 10, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.fold_stores_points_to",
     "[| local_state.heap (fold_stores ?ws (?s sys)) ?r = Some ?obj;
         obj_fields ?obj ?f = Some ?r' |]
      ==> (?r points_to ?r') ?s | (EX w:set ?ws. ?r' : store_refs w)",
     template_implication
      ([template_equation
         (template_app
           (template_app
             (template_hole 17,
              template_app
               (template_app (template_hole 16, template_var 5),
                template_app (template_var 4, template_hole 15))),
            template_var 3),
          template_app (template_hole 14, template_var 2)),
        template_equation
         (template_app
           (template_app (template_hole 12, template_var 2),
            template_var 1),
          template_app (template_hole 11, template_var 0))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 10,
               template_app
                (template_app
                  (template_app (template_hole 9, t_empty), template_var 3),
                 template_var 4)),
             template_app
              (template_app
                (template_hole 6,
                 template_app (template_hole 5, template_var 5)),
               t_empty))
           ))),
    ("Global_Invariants_Lemmas.has_white_path_to_eq_imp'",
     "[| (?x has_white_path_to ?y) ?s';
         ALL r'.
            \<Union> (ran ` obj_fields ` set_option (sys_heap ?s' r')) =
            \<Union> (ran ` obj_fields ` set_option (sys_heap ?s r'));
         ALL r'.
            map_option obj_mark (sys_heap ?s' r') =
            map_option obj_mark (sys_heap ?s r');
         sys_fM ?s' = sys_fM ?s |]
      ==> (?x has_white_path_to ?y) ?s",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 26, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 25, t_empty)),
        template_predicate (template_app (template_hole 25, t_empty)),
        template_equation
         (template_app
           (template_hole 2,
            template_app (template_var 1, template_hole 16)),
          template_app
           (template_hole 1,
            template_app (template_var 0, template_hole 9)))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 0, template_var 3),
               template_var 2),
             template_var 0)
           ))),
    ("Global_Invariants_Lemmas.WL_hs_done",
     "ghost_honorary_grey (?s (mutator ?m)) = {} ==>
      WL ?p
       (?s(mutator ?m := ?s (mutator ?m)(| W := {} |),
           sys := ?s sys
             (| hs_pending := ?hsp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?in' |))) =
      (case ?p of mutator m' => if m' = ?m then {} else WL (mutator m') ?s
       | gc => WL gc ?s | sys => WL sys ?s Un WL (mutator ?m) ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 14,
            template_app
             (template_var 4,
              template_app (template_hole 13, template_var 3))),
          template_hole 12)],
       template_equation
        (template_app
          (template_app (template_hole 11, template_var 2),
           template_app
            (template_app
              (template_app
                (template_hole 10,
                 template_app
                  (template_app
                    (template_app (template_hole 10, template_var 4),
                     template_app (template_hole 13, template_var 3)),
                   template_app
                    (template_app (template_hole 9, t_empty),
                     template_app
                      (template_var 4,
                       template_app (template_hole 13, template_var 3))))),
               template_hole 8),
             template_app
              (template_app (template_hole 7, t_empty),
               template_app
                (template_app (template_hole 9, t_empty),
                 template_app
                  (template_app (template_hole 4, t_empty),
                   template_app (template_var 4, template_hole 8)))))),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, t_empty),
               template_app
                (template_app (template_hole 11, template_hole 0),
                 template_var 4)),
             template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app (template_hole 11, template_hole 8),
                   template_var 4)),
               template_app
                (template_app
                  (template_hole 11,
                   template_app (template_hole 13, template_var 3)),
                 template_var 4))),
           template_var 2)))),
    ("Global_Invariants_Lemmas.black_fun_upd",
     "[| (?r : (UN p. WL p (?s(?fld := ?val)))) = (?r : (UN p. WL p ?s));
         sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         map_option obj_mark (sys_heap (?s(?fld := ?val)) ?r) =
         map_option obj_mark (sys_heap ?s ?r) |]
      ==> black ?r (?s(?fld := ?val)) = black ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 12, template_var 3),
            template_app
             (template_hole 11,
              template_app
               (template_app (template_hole 10, t_empty),
                template_hole 7))),
          template_app
           (template_app (template_hole 12, template_var 3),
            template_app
             (template_hole 11,
              template_app
               (template_app (template_hole 10, t_empty),
                template_hole 7)))),
        template_equation
         (template_app
           (template_hole 6,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 8, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 5)),
          template_app
           (template_hole 6,
            template_app (template_var 2, template_hole 5))),
        template_equation
         (template_app
           (template_app (template_hole 3, template_hole 2),
            template_app
             (template_app
               (template_hole 1,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 8, template_var 2),
                      template_var 1),
                    template_var 0),
                  template_hole 5)),
              template_var 3)),
          template_app
           (template_app (template_hole 3, template_hole 2),
            template_app
             (template_app
               (template_hole 1,
                template_app (template_var 2, template_hole 5)),
              template_var 3)))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 3),
           template_app
            (template_app
              (template_app (template_hole 8, template_var 2),
               template_var 1),
             template_var 0)),
         template_app
          (template_app (template_hole 0, template_var 3),
           template_var 2)))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(sys := ?s sys
             (| mem_store_buffers := (mem_store_buffers (?s sys))
                  (mutator ?m' :=
                     sys_mem_store_buffers (mutator ?m') ?s @
                     [mw_Mutate_Payload ?r ?f ?pl]) |))) =
      mut_m.tso_store_refs ?m ?s Un
      (if ?m' = ?m then store_refs (mw_Mutate_Payload ?r ?f ?pl) else {})",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 17, template_var 5),
              template_app
               (template_app
                 (template_app (template_hole 16, template_var 4),
                  template_hole 15),
                template_app
                 (template_app (template_hole 14, t_empty),
                  template_app (template_var 4, template_hole 15))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 6,
               template_app
                (template_app (template_hole 17, template_var 5),
                 template_var 4)),
             template_app
              (template_app
                (template_app
                  (template_hole 5,
                   template_app
                    (template_app (template_hole 4, template_var 3),
                     template_var 5)),
                 template_app
                  (template_app
                    (template_app
                      (template_app
                        (template_app
                          (template_app
                            (template_app (template_hole 3, t_empty),
                             t_empty),
                           t_empty),
                         t_empty),
                       t_empty),
                     t_empty),
                   template_app
                    (template_app
                      (template_app (template_hole 8, template_var 2),
                       template_var 1),
                     template_var 0))),
               template_hole 2))
           ))),
    ("Global_Invariants_Lemmas.WL_hs_done",
     "ghost_honorary_grey (?s (mutator ?m)) = {} ==>
      WL ?p
       (?s(mutator ?m := ?s (mutator ?m)
             (| W := {}, ghost_hs_phase := ?hp' |),
           sys := ?s sys
             (| hs_pending := ?hsp', W := sys_W ?s Un W (?s (mutator ?m)),
                ghost_hs_in_sync := ?in' |))) =
      (case ?p of mutator m' => if m' = ?m then {} else WL (mutator m') ?s
       | gc => WL gc ?s | sys => WL sys ?s Un WL (mutator ?m) ?s)",
     template_implication
      ([template_equation
         (template_app
           (template_hole 15,
            template_app
             (template_var 5,
              template_app (template_hole 14, template_var 4))),
          template_hole 13)],
       template_equation
        (template_app
          (template_app (template_hole 12, template_var 3),
           template_app
            (template_app
              (template_app
                (template_hole 11,
                 template_app
                  (template_app
                    (template_app (template_hole 11, template_var 5),
                     template_app (template_hole 14, template_var 4)),
                   template_app
                    (template_app (template_hole 10, t_empty),
                     template_app
                      (template_app (template_hole 9, t_empty),
                       template_app
                        (template_var 5,
                         template_app
                          (template_hole 14, template_var 4)))))),
               template_hole 8),
             template_app
              (template_app (template_hole 7, t_empty),
               template_app
                (template_app (template_hole 9, t_empty),
                 template_app
                  (template_app (template_hole 4, t_empty),
                   template_app (template_var 5, template_hole 8)))))),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, t_empty),
               template_app
                (template_app (template_hole 12, template_hole 0),
                 template_var 5)),
             template_app
              (template_app
                (template_hole 6,
                 template_app
                  (template_app (template_hole 12, template_hole 8),
                   template_var 5)),
               template_app
                (template_app
                  (template_hole 12,
                   template_app (template_hole 14, template_var 4)),
                 template_var 5))),
           template_var 3)))),
    ("Global_Invariants_Lemmas.has_white_path_to_fun_upd",
     "[| sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. \<Union>
               (ran `
                obj_fields ` set_option (sys_heap (?s(?fld := ?val)) x)) =
              \<Union> (ran ` obj_fields ` set_option (sys_heap ?s x));
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x) |]
      ==> (?x has_white_path_to ?y) (?s(?fld := ?val)) =
          (?x has_white_path_to ?y) ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 15,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 14, template_var 4),
                  template_var 3),
                template_var 2),
              template_hole 13)),
          template_app
           (template_hole 15,
            template_app (template_var 4, template_hole 13))),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 12, t_empty))],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 0),
           template_app
            (template_app
              (template_app (template_hole 14, template_var 4),
               template_var 3),
             template_var 2)),
         template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 0),
           template_var 4)))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(mutator ?m' := ?s (mutator ?m')(| ghost_honorary_root := {} |),
           sys := ?s sys
             (| mem_store_buffers := (mem_store_buffers (?s sys))
                  (mutator ?m' :=
                     sys_mem_store_buffers (mutator ?m') ?s @
                     [mw_Mutate ?r ?f ?opt_r']) |))) =
      mut_m.tso_store_refs ?m ?s Un
      (if ?m' = ?m then store_refs (mw_Mutate ?r ?f ?opt_r') else {})",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 19, template_var 5),
              template_app
               (template_app
                 (template_app
                   (template_hole 18,
                    template_app
                     (template_app
                       (template_app (template_hole 18, template_var 4),
                        template_app (template_hole 17, template_var 3)),
                      template_app
                       (template_app (template_hole 16, t_empty),
                        template_app
                         (template_var 4,
                          template_app
                           (template_hole 17, template_var 3))))),
                  template_hole 14),
                template_app
                 (template_app (template_hole 13, t_empty),
                  template_app (template_var 4, template_hole 14))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 6,
               template_app
                (template_app (template_hole 19, template_var 5),
                 template_var 4)),
             template_app
              (template_app
                (template_app
                  (template_hole 5,
                   template_app
                    (template_app (template_hole 4, template_var 3),
                     template_var 5)),
                 template_app
                  (template_app
                    (template_app
                      (template_app
                        (template_app
                          (template_app
                            (template_app (template_hole 3, t_empty),
                             t_empty),
                           t_empty),
                         t_empty),
                       t_empty),
                     t_empty),
                   template_app
                    (template_app
                      (template_app (template_hole 0, template_var 2),
                       template_var 1),
                     template_var 0))),
               template_hole 15))
           ))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(sys := ?s sys
             (| heap := (sys_heap ?s)
                  (?r :=
                     map_option
                      (%obj. obj
                          (| obj_fields := (obj_fields obj)
                               (?f := ?opt_r') |))
                      (sys_heap ?s ?r)),
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      (if ?p = mutator ?m then \<Union> (store_refs ` set ?ws)
       else mut_m.tso_store_refs ?m ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 23, template_var 6),
              template_app
               (template_app
                 (template_app (template_hole 22, template_var 5),
                  template_hole 21),
                template_app
                 (template_app (template_hole 20, t_empty),
                  template_app
                   (template_app (template_hole 17, t_empty),
                    template_app (template_var 5, template_hole 21)))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 10,
                 template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 6))),
               template_app
                (template_hole 7,
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app (template_hole 0, template_var 3)))),
             template_app
              (template_app (template_hole 23, template_var 6),
               template_var 5))
           ))),
    ("Global_Invariants_Lemmas.tso_store_refs_simps",
     "mut_m.tso_store_refs ?m
       (?s(sys := ?s sys
             (| heap := (sys_heap ?s)
                  (?r :=
                     map_option
                      (%obj. obj
                          (| obj_payload := (obj_payload obj)(?f := ?pl) |))
                      (sys_heap ?s ?r)),
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      (if ?p = mutator ?m then \<Union> (store_refs ` set ?ws)
       else mut_m.tso_store_refs ?m ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 23, template_var 6),
              template_app
               (template_app
                 (template_app (template_hole 22, template_var 5),
                  template_hole 21),
                template_app
                 (template_app (template_hole 20, t_empty),
                  template_app
                   (template_app (template_hole 17, t_empty),
                    template_app (template_var 5, template_hole 21)))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 10,
                 template_app
                  (template_app (template_hole 9, template_var 4),
                   template_app (template_hole 8, template_var 6))),
               template_app
                (template_hole 7,
                 template_app
                  (template_app (template_hole 6, t_empty),
                   template_app (template_hole 0, template_var 3)))),
             template_app
              (template_app (template_hole 23, template_var 6),
               template_var 5))
           ))),
    ("Global_Invariants_Lemmas.reachable_induct",
     "[| mut_m.reachable ?m ?y ?s;
         !!x. x : roots (?s (mutator ?m)) ==> ?P x;
         !!x. x : ghost_honorary_root (?s (mutator ?m)) ==> ?P x;
         !!x. x : mut_m.tso_store_refs ?m ?s ==> ?P x;
         !!x y.
            [| mut_m.reachable ?m x ?s; (x points_to y) ?s; ?P x |]
            ==> ?P y |]
      ==> ?P ?y",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 9, template_var 3),
                template_var 2),
              template_var 1)
            ),
        template_predicate (template_app (template_hole 8, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_predicate (template_app (template_var 0, template_var 2)))),
    ("Global_Invariants_Lemmas.marked_insertions_fun_upd",
     "[| sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x);
         filter is_mw_Mutate
          (sys_mem_store_buffers (mutator ?m) (?s(?fld := ?val))) =
         filter is_mw_Mutate (sys_mem_store_buffers (mutator ?m) ?s) |]
      ==> mut_m.marked_insertions ?m (?s(?fld := ?val)) =
          mut_m.marked_insertions ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 17,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 16, template_var 3),
                  template_var 2),
                template_var 1),
              template_hole 15)),
          template_app
           (template_hole 17,
            template_app (template_var 3, template_hole 15))),
        template_predicate (template_app (template_hole 14, t_empty)),
        template_equation
         (template_app
           (template_app (template_hole 8, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 16, template_var 3),
                      template_var 2),
                    template_var 1),
                  template_hole 15)),
              template_app (template_hole 1, template_var 0))),
          template_app
           (template_app (template_hole 8, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app (template_var 3, template_hole 15)),
              template_app (template_hole 1, template_var 0))))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 16, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.tso_pending_mw_mutate_cong",
     "[| filter is_mw_Mutate (sys_mem_store_buffers ?p ?s) =
         filter is_mw_Mutate (sys_mem_store_buffers ?p ?s');
         !!r f r'. ?P r f r' = ?Q r f r' |]
      ==> (ALL r f r'.
              mw_Mutate r f r' : set (sys_mem_store_buffers ?p ?s) -->
              ?P r f r') =
          (ALL r f r'.
              mw_Mutate r f r' : set (sys_mem_store_buffers ?p ?s') -->
              ?Q r f r')",
     template_implication
      ([template_equation
         (template_app
           (template_app (template_hole 19, t_empty),
            template_app
             (template_app
               (template_hole 13,
                template_app (template_var 4, template_hole 12)),
              template_var 3)),
          template_app
           (template_app (template_hole 19, t_empty),
            template_app
             (template_app
               (template_hole 11,
                template_app (template_var 2, template_hole 10)),
              template_var 3))),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_equation
        (template_app (template_hole 5, t_empty),
         template_app (template_hole 5, t_empty)))),
    ("Global_Invariants_Lemmas.points_to_Mutate",
     "(?x points_to ?y)
       (?s(sys := ?s sys
             (| heap := (sys_heap ?s)
                  (?r :=
                     map_option
                      (%obj. obj
                          (| obj_fields := (obj_fields obj)
                               (?f := ?opt_r') |))
                      (sys_heap ?s ?r)),
                mem_store_buffers := (mem_store_buffers (?s sys))
                  (?p := ?ws) |))) =
      (?r ~= ?x & (?x points_to ?y) ?s |
       ?r = ?x &
       obj_at (%s. True) ?r ?s &
       (?opt_r' = Some ?y |
        (?x points_to ?y) ?s &
        obj_at (%obj. EX f'. obj_fields obj f' = Some ?y & ?f ~= f') ?r
         ?s))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_hole 23, t_empty), template_var 6),
              template_app
               (template_app
                 (template_app (template_hole 19, template_var 5),
                  template_hole 18),
                template_app
                 (template_app (template_hole 17, t_empty),
                  template_app
                   (template_app (template_hole 14, t_empty),
                    template_app (template_var 5, template_hole 18)))))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app
                  (template_hole 7,
                   template_app
                    (template_hole 6,
                     template_app
                      (template_app (template_hole 5, template_var 2),
                       template_var 6))),
                 template_app
                  (template_app
                    (template_app (template_hole 23, t_empty),
                     template_var 6),
                   template_var 5))),
             template_app
              (template_app
                (template_hole 7,
                 template_app
                  (template_app (template_hole 5, template_var 2),
                   template_var 6)),
               template_app
                (template_app
                  (template_hole 7,
                   template_app
                    (template_app
                      (template_app (template_hole 23, t_empty),
                       template_var 2),
                     template_var 5)),
                 template_app
                  (template_app
                    (template_hole 8,
                     template_app
                      (template_app (template_hole 3, template_var 0),
                       template_app (template_hole 2, template_var 7))),
                   template_app
                    (template_app
                      (template_hole 7,
                       template_app
                        (template_app
                          (template_app (template_hole 23, t_empty),
                           template_var 6),
                         template_var 5)),
                     template_app
                      (template_app
                        (template_app (template_hole 23, t_empty),
                         template_var 2),
                       template_var 5))))))
           ))),
    ("Global_Invariants_Lemmas.marked_deletions_fun_upd",
     "[| sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. map_option obj_fields (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_fields (sys_heap ?s x);
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x);
         filter is_mw_Mutate
          (sys_mem_store_buffers (mutator ?m) (?s(?fld := ?val))) =
         filter is_mw_Mutate (sys_mem_store_buffers (mutator ?m) ?s) |]
      ==> mut_m.marked_deletions ?m (?s(?fld := ?val)) =
          mut_m.marked_deletions ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 20,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 19, template_var 3),
                  template_var 2),
                template_var 1),
              template_hole 18)),
          template_app
           (template_hole 20,
            template_app (template_var 3, template_hole 18))),
        template_predicate (template_app (template_hole 17, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty)),
        template_equation
         (template_app
           (template_app (template_hole 8, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 19, template_var 3),
                      template_var 2),
                    template_var 1),
                  template_hole 18)),
              template_app (template_hole 1, template_var 0))),
          template_app
           (template_app (template_hole 8, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app (template_var 3, template_hole 18)),
              template_app (template_hole 1, template_var 0))))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 19, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3)))),
    ("Global_Invariants_Lemmas.valid_W_inv_fun_upd",
     "[| !!a. W ((?s(?fld := ?val)) a) = W (?s a);
         !!a. ghost_honorary_grey ((?s(?fld := ?val)) a) =
              ghost_honorary_grey (?s a);
         sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!b. map_option obj_mark (sys_heap (?s(?fld := ?val)) b) =
              map_option obj_mark (sys_heap ?s b);
         sys_mem_lock (?s(?fld := ?val)) = sys_mem_lock ?s;
         !!a. filter is_mw_Mark
               (sys_mem_store_buffers a (?s(?fld := ?val))) =
              filter is_mw_Mark (sys_mem_store_buffers a ?s) |]
      ==> valid_W_inv (?s(?fld := ?val)) = valid_W_inv ?s",
     template_implication
      ([template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_equation
         (template_app
           (template_hole 16,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 19, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 15)),
          template_app
           (template_hole 16,
            template_app (template_var 2, template_hole 15))),
        template_predicate (template_app (template_hole 14, t_empty)),
        template_equation
         (template_app
           (template_hole 8,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 19, template_var 2),
                  template_var 1),
                template_var 0),
              template_hole 15)),
          template_app
           (template_hole 8,
            template_app (template_var 2, template_hole 15))),
        template_predicate (template_app (template_hole 23, t_empty))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 19, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.reachable_fun_upd",
     "[| roots ((?s(?fld := ?val)) (mutator ?m)) = roots (?s (mutator ?m));
         ghost_honorary_root ((?s(?fld := ?val)) (mutator ?m)) =
         ghost_honorary_root (?s (mutator ?m));
         !!x. \<Union>
               (ran `
                obj_fields ` set_option (sys_heap (?s(?fld := ?val)) x)) =
              \<Union> (ran ` obj_fields ` set_option (sys_heap ?s x));
         filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
          (sys_mem_store_buffers (mutator ?m) (?s(?fld := ?val))) =
         filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
          (sys_mem_store_buffers (mutator ?m) ?s) |]
      ==> mut_m.reachable ?m ?r (?s(?fld := ?val)) =
          mut_m.reachable ?m ?r ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 25,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 24, template_var 4),
                  template_var 3),
                template_var 2),
              template_app (template_hole 23, template_var 1))),
          template_app
           (template_hole 25,
            template_app
             (template_var 4,
              template_app (template_hole 23, template_var 1)))),
        template_equation
         (template_app
           (template_hole 22,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 24, template_var 4),
                  template_var 3),
                template_var 2),
              template_app (template_hole 23, template_var 1))),
          template_app
           (template_hole 22,
            template_app
             (template_var 4,
              template_app (template_hole 23, template_var 1)))),
        template_predicate (template_app (template_hole 21, t_empty)),
        template_equation
         (template_app
           (template_app (template_hole 11, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 24, template_var 4),
                      template_var 3),
                    template_var 2),
                  template_hole 13)),
              template_app (template_hole 23, template_var 1))),
          template_app
           (template_app (template_hole 11, t_empty),
            template_app
             (template_app
               (template_hole 2,
                template_app (template_var 4, template_hole 13)),
              template_app (template_hole 23, template_var 1))))],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 0),
           template_app
            (template_app
              (template_app (template_hole 24, template_var 4),
               template_var 3),
             template_var 2)),
         template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 0),
           template_var 4)))),
    ("Global_Invariants_Lemmas.valid_refs_inv_fun_upd",
     "[| !!a. roots ((?s(?fld := ?val)) (mutator a)) =
              roots (?s (mutator a));
         !!a. ghost_honorary_root ((?s(?fld := ?val)) (mutator a)) =
              ghost_honorary_root (?s (mutator a));
         !!b. map_option obj_fields (sys_heap (?s(?fld := ?val)) b) =
              map_option obj_fields (sys_heap ?s b);
         !!a. filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
               (sys_mem_store_buffers (mutator a) (?s(?fld := ?val))) =
              filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
               (sys_mem_store_buffers (mutator a) ?s);
         (UN p. WL p (?s(?fld := ?val))) = (UN p. WL p ?s) |]
      ==> valid_refs_inv (?s(?fld := ?val)) = valid_refs_inv ?s",
     template_implication
      ([template_predicate (template_app (template_hole 29, t_empty)),
        template_predicate (template_app (template_hole 29, t_empty)),
        template_predicate (template_app (template_hole 22, t_empty)),
        template_predicate (template_app (template_hole 29, t_empty)),
        template_equation
         (template_app
           (template_hole 5,
            template_app
             (template_app (template_hole 4, t_empty), template_hole 2)),
          template_app
           (template_hole 5,
            template_app
             (template_app (template_hole 4, t_empty), template_hole 2)))],
       template_equation
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app (template_hole 25, template_var 2),
               template_var 1),
             template_var 0)),
         template_app (template_hole 0, template_var 2)))),
    ("Global_Invariants_Lemmas.reachable_snapshot_fun_upd",
     "[| roots ((?s(?fld := ?val)) (mutator ?m)) = roots (?s (mutator ?m));
         ghost_honorary_root ((?s(?fld := ?val)) (mutator ?m)) =
         ghost_honorary_root (?s (mutator ?m));
         !!x. (x : (UN p. WL p (?s(?fld := ?val)))) = (x : (UN p. WL p ?s));
         sys_fM (?s(?fld := ?val)) = sys_fM ?s;
         !!x. \<Union>
               (ran `
                obj_fields ` set_option (sys_heap (?s(?fld := ?val)) x)) =
              \<Union> (ran ` obj_fields ` set_option (sys_heap ?s x));
         !!x. map_option obj_mark (sys_heap (?s(?fld := ?val)) x) =
              map_option obj_mark (sys_heap ?s x);
         filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
          (sys_mem_store_buffers (mutator ?m) (?s(?fld := ?val))) =
         filter (%s. is_mw_Mutate s | is_mw_Mutate_Payload s)
          (sys_mem_store_buffers (mutator ?m) ?s) |]
      ==> mut_m.reachable_snapshot_inv ?m (?s(?fld := ?val)) =
          mut_m.reachable_snapshot_inv ?m ?s",
     template_implication
      ([template_equation
         (template_app
           (template_hole 33,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 32, template_var 3),
                  template_var 2),
                template_var 1),
              template_app (template_hole 31, template_var 0))),
          template_app
           (template_hole 33,
            template_app
             (template_var 3,
              template_app (template_hole 31, template_var 0)))),
        template_equation
         (template_app
           (template_hole 30,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 32, template_var 3),
                  template_var 2),
                template_var 1),
              template_app (template_hole 31, template_var 0))),
          template_app
           (template_hole 30,
            template_app
             (template_var 3,
              template_app (template_hole 31, template_var 0)))),
        template_predicate (template_app (template_hole 29, t_empty)),
        template_equation
         (template_app
           (template_hole 22,
            template_app
             (template_app
               (template_app
                 (template_app (template_hole 32, template_var 3),
                  template_var 2),
                template_var 1),
              template_hole 21)),
          template_app
           (template_hole 22,
            template_app (template_var 3, template_hole 21))),
        template_predicate (template_app (template_hole 29, t_empty)),
        template_predicate (template_app (template_hole 29, t_empty)),
        template_equation
         (template_app
           (template_app (template_hole 10, t_empty),
            template_app
             (template_app
               (template_hole 1,
                template_app
                 (template_app
                   (template_app
                     (template_app (template_hole 32, template_var 3),
                      template_var 2),
                    template_var 1),
                  template_hole 21)),
              template_app (template_hole 31, template_var 0))),
          template_app
           (template_app (template_hole 10, t_empty),
            template_app
             (template_app
               (template_hole 1,
                template_app (template_var 3, template_hole 21)),
              template_app (template_hole 31, template_var 0))))],
       template_equation
        (template_app
          (template_app (template_hole 0, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 32, template_var 3),
               template_var 2),
             template_var 1)),
         template_app
          (template_app (template_hole 0, template_var 0),
           template_var 3))))]:
   (string * thm * template) list
### theory "Draft.Global_Invariants_LemmasMoreTemplates"
### 0.731s elapsed time, 0.954s cpu time, 0.103s GC time
val it = (): unit
