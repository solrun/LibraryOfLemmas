   [("Sepref_Foreach.id_FOREACHoci",
     "PR_CONST FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?I\<^esup> ::\<^sub>i
      TYPE(?'c set
           => (?'d => bool)
              => (?'c => ?'d => ?'d nres) => ?'d => ?'d nres)",
     template_predicate
      (
         template_app
          (template_app
            (template_hole 3,
             template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 1),
                 template_var 0))),
           template_hole 0)
         )),
    ("Sepref_Foreach.imp_nfoldli_simps",
     "imp_nfoldli [] ?c ?f ?s = return ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Sepref_Foreach.monadic_nfoldli_simp",
     "monadic_nfoldli [] ?c ?f ?s = RETURN ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Sepref_Foreach.nfoldli_alt_simp",
     "nfoldli_alt [] ?c ?f ?s = RETURN ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Sepref_Foreach.imp_for_imp_for'",
     "imp_for ?i ?u (%_. return True) = imp_for' ?i ?u",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 3, template_var 1), template_var 0),
         t_empty),
       template_app
        (template_app (template_hole 0, template_var 1), template_var 0))),
    ("Sepref_Foreach.imp_for_down_no_cond",
     "imp_for_down ?l ?u (%_. return True) = imp_for_down' ?l ?u",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 3, template_var 1), template_var 0),
         t_empty),
       template_app
        (template_app (template_hole 0, template_var 1), template_var 0))),
    ("Sepref_Foreach.nfoldli_to_monadic",
     "nfoldli ?l ?c ?f = monadic_nfoldli ?l (%x. RETURN (?c x)) ?f",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 2, template_var 2), template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app (template_hole 1, template_var 2), t_empty),
         template_var 0))),
    ("Sepref_Foreach.fold_idx_conv",
     "fold ?f ?l ?s = fold (%i. ?f (?l ! i)) [0..<length ?l] ?s",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 5, template_var 2), template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app (template_hole 4, t_empty),
           template_app
            (template_app (template_hole 2, template_hole 1),
             template_app (template_hole 0, template_var 1))),
         template_var 0))),
    ("Sepref_Foreach.fold_eq_nfoldli",
     "RETURN (fold ?f ?l ?s) =
      nfoldli ?l (%_. True) (%x s. RETURN (?f x s)) ?s",
     template_equation
      (template_app
        (template_hole 3,
         template_app
          (template_app
            (template_app (template_hole 2, template_var 2),
             template_var 1),
           template_var 0)),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 1, template_var 1), t_empty),
           t_empty),
         template_var 0))),
    ("Sepref_Foreach.foldli_eq_nfoldli",
     "RETURN (foldli ?l ?c ?f ?s) =
      nfoldli ?l ?c (%x s. RETURN (?f x s)) ?s",
     template_equation
      (template_app
        (template_hole 2,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 3),
               template_var 2),
             template_var 1),
           template_var 0)),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 3),
             template_var 2),
           t_empty),
         template_var 0))),
    ("Sepref_Foreach.FOREACH_oci_to_monadic",
     "FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?\<Phi>\<^esup> ?S ?c ?f
       ?\<sigma>0.0 =
      monadic_FOREACH ?R ?\<Phi> ?S (%\<sigma>. RETURN (?c \<sigma>)) ?f
       ?\<sigma>0.0",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 2, template_var 5),
                 template_var 4),
               template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 5),
                 template_var 4),
               template_var 3),
             t_empty),
           template_var 1),
         template_var 0))),
    ("Sepref_Foreach.FOREACHoci_itsl",
     "it_to_sorted_list ?R ?s >>= (%l. nfoldli l ?c ?f ?\<sigma>)
      <= FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?I\<^esup> ?s ?c ?f ?\<sigma>",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_hole 3,
           template_app
            (template_app (template_hole 2, template_var 5),
             template_var 4)),
         t_empty),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 5),
                 template_var 0),
               template_var 4),
             template_var 3),
           template_var 2),
         template_var 1))),
    ("Sepref_Foreach.monadic_FOREACH_itsl",
     "it_to_sorted_list ?R ?s >>= (%l. monadic_nfoldli l ?c ?f ?\<sigma>)
      <= monadic_FOREACH ?R ?I ?s ?c ?f ?\<sigma>",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_hole 3,
           template_app
            (template_app (template_hole 2, template_var 5),
             template_var 4)),
         t_empty),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 5),
                 template_var 0),
               template_var 4),
             template_var 3),
           template_var 2),
         template_var 1))),
    ("Sepref_Foreach.IS_TO_SORTED_LISTI",
     "(?tsl, PR_CONST (it_to_sorted_list ?\<Omega>))
      : ?Rs\<^sup>k \<rightarrow>\<^sub>a list_assn ?Rk ==>
      IS_TO_SORTED_LIST ?\<Omega> ?Rs ?Rk ?tsl",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 8,
                template_app
                 (template_app (template_hole 7, template_var 3),
                  template_app
                   (template_hole 6,
                    template_app (template_hole 5, template_var 2)))),
              template_app
               (template_app
                 (template_app (template_hole 4, t_empty),
                  template_app
                   (template_app (template_hole 2, template_var 1),
                    template_hole 3)),
                template_app (template_hole 1, template_var 0)))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 1),
               template_var 0),
             template_var 3)
           ))),
    ("Sepref_Foreach.nfoldli_assert'",
     "nfoldli ?l ?c (%x s. ASSERT (x : set ?l) >>= (%_. ?f x s)) ?s =
      nfoldli ?l ?c ?f ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 3),
             template_var 2),
           t_empty),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0))),
    ("Sepref_Foreach.monadic_nfoldli_assert",
     "monadic_nfoldli ?l ?c (%x s. ASSERT (x : set ?l) >>= (%_. ?f x s))
       ?s =
      monadic_nfoldli ?l ?c ?f ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 3),
             template_var 2),
           t_empty),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0))),
    ("Sepref_Foreach.list_rel_congD",
     "(?li, ?l) : \<langle>?S\<rangle>list_rel ==>
      (?li, ?l) : \<langle>?S Int set ?li \<times> set ?l\<rangle>list_rel",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 7,
                template_app
                 (template_app (template_hole 6, template_var 2),
                  template_var 1)),
              template_app
               (template_app (template_hole 5, template_hole 4),
                template_var 0))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 7,
               template_app
                (template_app (template_hole 6, template_var 2),
                 template_var 1)),
             template_app
              (template_app (template_hole 5, template_hole 4),
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_app
                  (template_app
                    (template_hole 2,
                     template_app (template_hole 1, template_var 2)),
                   t_empty))))
           ))),
    ("Sepref_Foreach.fold_eq_nfoldli_assert",
     "RETURN (fold ?f ?l ?s) =
      nfoldli ?l (%_. True)
       (%x s. ASSERT (x : set ?l) >>= (%_. RETURN (?f x s))) ?s",
     template_equation
      (template_app
        (template_hole 7,
         template_app
          (template_app
            (template_app (template_hole 6, template_var 2),
             template_var 1),
           template_var 0)),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 1), t_empty),
           t_empty),
         template_var 0))),
    ("Sepref_Foreach.monadic_nfoldli_simp",
     "monadic_nfoldli (?x # ?ls) ?c ?f ?s =
      ?c ?s >>=
      (%b. if b then ?f ?x ?s >>= monadic_nfoldli ?ls ?c ?f
           else RETURN ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 5,
               template_app
                (template_app (template_hole 4, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 3, template_app (template_var 2, template_var 0)),
         t_empty))),
    ("Sepref_Foreach.nfoldli_alt_simp",
     "nfoldli_alt (?x # ?ls) ?c ?f ?s =
      (let b = ?c ?s
       in if b then ?f ?x ?s >>= nfoldli_alt ?ls ?c ?f else RETURN ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 5,
               template_app
                (template_app (template_hole 4, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 3, template_app (template_var 2, template_var 0)),
         t_empty))),
    ("Sepref_Foreach.imp_nfoldli_simps",
     "imp_nfoldli (?x # ?ls) ?c ?f ?s =
      ?c ?s >>=
      (%b. if b then ?f ?x ?s >>= imp_nfoldli ?ls ?c ?f else return ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 5,
               template_app
                (template_app (template_hole 4, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 3, template_app (template_var 2, template_var 0)),
         t_empty))),
    ("Sepref_Foreach.imp_nfoldli_mono",
     "(!!x \<sigma>. mono_Heap (%fa. ?f fa x \<sigma>)) ==>
      mono_Heap (%x. imp_nfoldli ?l ?c (?f x) ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 7, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_hole 3, template_hole 2)),
               template_hole 1),
             t_empty)
           ))),
    ("Sepref_Foreach.nfoldli_assert",
     "set ?l <= ?S ==>
      nfoldli ?l ?c (%x s. ASSERT (x : ?S) >>= (%_. ?f x s)) ?s =
      nfoldli ?l ?c ?f ?s",
     template_implication
      ([template_inequation
         (less_equals, template_app (template_hole 5, template_var 4),
          template_var 3)],
       template_equation
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 4),
               template_var 2),
             t_empty),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 4),
               template_var 2),
             template_var 1),
           template_var 0)))),
    ("Sepref_Foreach.monadic_nfoldli_assert_aux",
     "set ?l <= ?S ==>
      monadic_nfoldli ?l ?c (%x s. ASSERT (x : ?S) >>= (%_. ?f x s)) ?s =
      monadic_nfoldli ?l ?c ?f ?s",
     template_implication
      ([template_inequation
         (less_equals, template_app (template_hole 5, template_var 4),
          template_var 3)],
       template_equation
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 4),
               template_var 2),
             t_empty),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 4),
               template_var 2),
             template_var 1),
           template_var 0)))),
    ("Sepref_Foreach.imp_foreach_mono",
     "(!!x \<sigma>. mono_Heap (%fa. ?f fa x \<sigma>)) ==>
      mono_Heap (%x. imp_foreach ?tsl ?l ?c (?f x) ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 7, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 4,
                 template_app (template_hole 3, template_hole 2)),
               template_hole 1),
             t_empty)
           ))),
    ("Sepref_Foreach.monadic_nfoldli_eq",
     "monadic_nfoldli ?l ?c ?f ?s =
      (case ?l of [] => RETURN ?s
       | x # ls =>
           ?c ?s >>=
           (%b. if b then ?f x ?s >>= monadic_nfoldli ls ?c ?f
                else RETURN ?s))",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_hole 4,
             template_app (template_hole 3, template_var 0)),
           t_empty),
         template_var 3))),
    ("Sepref_Foreach.nfoldli_alt_eq",
     "nfoldli_alt ?l ?c ?f ?s =
      (case ?l of [] => RETURN ?s
       | x # ls =>
           let b = ?c ?s
           in if b then ?f x ?s >>= nfoldli_alt ls ?c ?f else RETURN ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_hole 4,
             template_app (template_hole 3, template_var 0)),
           t_empty),
         template_var 3))),
    ("Sepref_Foreach.extend_list_of_filtered_set",
     "[| finite ?S; distinct ?xs'; set ?xs' = {x: ?S. ?P x};
         !!xs. [| ?xs' = filter ?P xs; distinct xs; set xs = ?S |]
               ==> ?thesis |]
      ==> ?thesis",
     template_implication
      ([template_predicate (template_app (template_hole 9, template_var 3)),
        template_predicate (template_app (template_hole 8, template_var 2)),
        template_equation
         (template_app (template_hole 6, template_var 2),
          template_app (template_hole 5, t_empty)),
        template_predicate (template_app (template_hole 2, t_empty))],
       template_predicate (template_var 0))),
    ("Sepref_Foreach.heap_fixp_mono",
     "[| !!x d. mono_Heap (%xa. ?B x xa d);
         !!Z xa. mono_Heap (%a. ?B a Z xa) |]
      ==> mono_Heap (%x. heap.fixp_fun (?B x) ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 6, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_hole 5,
                 template_app (template_hole 4, template_hole 3)),
               template_hole 7),
             t_empty)
           ))),
    ("Sepref_Foreach.imp_for'_rule",
     "[| ?l <= ?u; ?P \<Longrightarrow>\<^sub>A ?I ?l ?s;
         !!i s. [| ?l <= i; i < ?u |] ==> <?I i s> ?f i s <?I (i + 1)> |]
      ==> <?P> imp_for' ?l ?u ?f ?s <?I ?u>",
     template_implication
      ([template_inequation (less_equals, template_var 5, template_var 4),
        template_predicate
         (
            template_app
             (template_app (template_hole 7, template_var 3),
              template_app
               (template_app (template_var 2, template_var 5),
                template_var 1))
            ),
        template_predicate (template_app (template_hole 6, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 3, template_var 3),
               template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 5),
                     template_var 4),
                   template_var 0),
                 template_var 1)),
             template_app (template_var 2, template_var 4))
           ))),
    ("Sepref_Foreach.monadic_nfoldli_rec",
     "monadic_nfoldli ?x' ?c ?f ?\<sigma>
      <= \<Down> Id
          (REC\<^sub>T
            (%W (xs, \<sigma>).
                ASSERT (FOREACH_inv ?xs0.0 ?I (xs, \<sigma>)) >>=
                (%_. if xs = [] then RETURN (xs, \<sigma>)
                     else ?c \<sigma> >>=
                          (%b. if b
                               then FOREACH_body ?f (xs, \<sigma>) >>= W
                               else RETURN (xs, \<sigma>))))
            (?x', ?\<sigma>) >>=
           (%(uu_, y). RETURN y))",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_app
            (template_app (template_hole 18, template_var 5),
             template_var 4),
           template_var 3),
         template_var 2),
       template_app
        (template_app (template_hole 17, template_hole 16),
         template_app
          (template_app
            (template_hole 15,
             template_app
              (template_app (template_hole 14, t_empty),
               template_app
                (template_app (template_hole 9, template_var 5),
                 template_var 2))),
           template_app (template_hole 1, t_empty))))),
    ("Sepref_Foreach.monadic_nfoldli_refine",
     "[| (?li, ?l) : \<langle>?S\<rangle>list_rel; (?si, ?s) : ?R;
         !!si s. (si, s) : ?R ==> ?ci si <= \<Down> bool_rel (?c s);
         !!xi x si s.
            [| (xi, x) : ?S; x : set ?l; (si, s) : ?R; inres (?c s) True |]
            ==> ?fi xi si <= \<Down> ?R (?f x s) |]
      ==> monadic_nfoldli ?li ?ci ?fi ?si
          <= \<Down> ?R (monadic_nfoldli ?l ?c ?f ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 22,
                template_app
                 (template_app (template_hole 21, template_var 9),
                  template_var 8)),
              template_app
               (template_app (template_hole 20, template_hole 19),
                template_var 7))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 18,
                template_app
                 (template_app (template_hole 17, template_var 6),
                  template_var 5)),
              template_var 4)
            ),
        template_predicate (template_app (template_hole 16, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 3),
             template_var 1),
           template_var 6),
         template_app
          (template_app (template_hole 2, template_var 4),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 8),
                 template_var 2),
               template_var 0),
             template_var 5))))),
    ("Sepref_Foreach.monadic_nfoldli_refine_aux",
     "[| !!s s'.
            hn_refine (?\<Gamma> * hn_ctxt ?Rs s' s) (?c s)
             (?\<Gamma> * hn_ctxt ?Rs s' s) bool_assn (?c' s');
         !!x x' s s'.
            hn_refine (?\<Gamma> * hn_ctxt ?Rl x' x * hn_ctxt ?Rs s' s)
             (?f x s)
             (?\<Gamma> * hn_invalid ?Rl x' x * hn_invalid ?Rs s' s) ?Rs
             (?f' x' s') |]
      ==> hn_refine
           (?\<Gamma> * hn_ctxt (list_assn ?Rl) ?l' ?l * hn_ctxt ?Rs ?s' ?s)
           (imp_nfoldli ?l ?c ?f ?s)
           (?\<Gamma> * hn_invalid (list_assn ?Rl) ?l' ?l *
            hn_invalid ?Rs ?s' ?s)
           ?Rs (monadic_nfoldli ?l' ?c' ?f' ?s')",
     template_implication
      ([template_predicate (template_app (template_hole 18, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app
                    (template_hole 8,
                     template_app
                      (template_app
                        (template_hole 14,
                         template_app
                          (template_app (template_hole 14, template_var 10),
                           template_app
                            (template_app
                              (template_app
                                (template_hole 4,
                                 template_app
                                  (template_hole 3, template_var 6)),
                               template_var 3),
                             template_var 2))),
                       template_app
                        (template_app
                          (template_app (template_hole 13, template_var 9),
                           template_var 1),
                         template_var 0))),
                   template_app
                    (template_app
                      (template_app
                        (template_app (template_hole 2, template_var 2),
                         template_var 8),
                       template_var 5),
                     template_var 0)),
                 template_app
                  (template_app
                    (template_hole 14,
                     template_app
                      (template_app (template_hole 14, template_var 10),
                       template_app
                        (template_app
                          (template_app
                            (template_hole 4,
                             template_app
                              (template_hole 1,
                               template_app
                                (template_hole 3, template_var 6))),
                           template_var 3),
                         template_var 2))),
                   template_app
                    (template_app
                      (template_app
                        (template_hole 13,
                         template_app (template_hole 5, template_var 9)),
                       template_var 1),
                     template_var 0))),
               template_var 9),
             template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 3),
                   template_var 7),
                 template_var 4),
               template_var 1))
           ))),
    ("Sepref_Foreach.hn_monadic_nfoldli",
     "[| ?P \<Longrightarrow>\<^sub>t
         ?\<Gamma> * hn_ctxt (list_assn ?Rl) ?l' ?l * hn_ctxt ?Rs ?s' ?s;
         !!s s'.
            hn_refine (?\<Gamma> * hn_ctxt ?Rs s' s) (?c s)
             (?\<Gamma> * hn_ctxt ?Rs s' s) bool_assn (?c' $ s');
         !!x x' s s'.
            hn_refine (?\<Gamma> * hn_ctxt ?Rl x' x * hn_ctxt ?Rs s' s)
             (?f x s)
             (?\<Gamma> * hn_invalid ?Rl x' x * hn_invalid ?Rs s' s) ?Rs
             (?f' $ x' $ s') |]
      ==> hn_refine ?P (imp_nfoldli ?l ?c ?f ?s)
           (?\<Gamma> * hn_invalid (list_assn ?Rl) ?l' ?l *
            hn_invalid ?Rs ?s' ?s)
           ?Rs (monadic_nfoldli $ ?l' $ ?c' $ ?f' $ ?s')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 24, template_var 11),
              template_app
               (template_app
                 (template_hole 23,
                  template_app
                   (template_app (template_hole 23, template_var 10),
                    template_app
                     (template_app
                       (template_app
                         (template_hole 22,
                          template_app (template_hole 21, template_var 9)),
                        template_var 8),
                      template_var 7))),
                template_app
                 (template_app
                   (template_app (template_hole 20, template_var 6),
                    template_var 5),
                  template_var 4)))
            ),
        template_predicate (template_app (template_hole 19, t_empty)),
        template_predicate (template_app (template_hole 13, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 11, template_var 11),
                   template_app
                    (template_app
                      (template_app
                        (template_app (template_hole 5, template_var 7),
                         template_var 3),
                       template_var 1),
                     template_var 4)),
                 template_app
                  (template_app
                    (template_hole 23,
                     template_app
                      (template_app (template_hole 23, template_var 10),
                       template_app
                        (template_app
                          (template_app
                            (template_hole 22,
                             template_app
                              (template_hole 4,
                               template_app
                                (template_hole 21, template_var 9))),
                           template_var 8),
                         template_var 7))),
                   template_app
                    (template_app
                      (template_app
                        (template_hole 20,
                         template_app (template_hole 8, template_var 6)),
                       template_var 5),
                     template_var 4))),
               template_var 6),
             template_app
              (template_app
                (template_hole 7,
                 template_app
                  (template_app
                    (template_hole 3,
                     template_app
                      (template_app
                        (template_hole 2,
                         template_app
                          (template_app (template_hole 1, template_hole 0),
                           template_var 8)),
                       template_var 2)),
                   template_var 0)),
               template_var 5))
           ))),
    ("Sepref_Foreach.monadic_nfoldli_refine_aux'",
     "[| set ?l' <= ?S;
         !!s s'.
            hn_refine (?\<Gamma> * hn_ctxt ?Rs s' s) (?c s)
             (?\<Gamma> * hn_ctxt ?Rs s' s) bool_assn (?c' s');
         !!x x' s s'.
            x' : ?S ==>
            hn_refine (?\<Gamma> * hn_ctxt ?Rl x' x * hn_ctxt ?Rs s' s)
             (?f x s) (?\<Gamma> * hn_ctxt ?Rl' x' x * hn_invalid ?Rs s' s)
             ?Rs (?f' x' s');
         !!x x'.
            hn_ctxt ?Rl' x' x \<or>\<^sub>A
            hn_ctxt ?Rl x' x \<Longrightarrow>\<^sub>t
            hn_ctxt ?Rl'' x' x |]
      ==> hn_refine
           (?\<Gamma> * hn_ctxt (list_assn ?Rl) ?l' ?l * hn_ctxt ?Rs ?s' ?s)
           (imp_nfoldli ?l ?c ?f ?s)
           (?\<Gamma> * hn_ctxt (list_assn ?Rl'') ?l' ?l *
            hn_invalid ?Rs ?s' ?s)
           ?Rs (monadic_nfoldli ?l' ?c' ?f' ?s')",
     template_implication
      ([template_inequation
         (less_equals, template_app (template_hole 19, template_var 13),
          template_var 12),
        template_predicate (template_app (template_hole 18, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app
                    (template_hole 8,
                     template_app
                      (template_app
                        (template_hole 15,
                         template_app
                          (template_app (template_hole 15, template_var 11),
                           template_app
                            (template_app
                              (template_app
                                (template_hole 3,
                                 template_app
                                  (template_hole 2, template_var 7)),
                               template_var 13),
                             template_var 2))),
                       template_app
                        (template_app
                          (template_app (template_hole 14, template_var 10),
                           template_var 1),
                         template_var 0))),
                   template_app
                    (template_app
                      (template_app
                        (template_app (template_hole 1, template_var 2),
                         template_var 9),
                       template_var 6),
                     template_var 0)),
                 template_app
                  (template_app
                    (template_hole 15,
                     template_app
                      (template_app (template_hole 15, template_var 11),
                       template_app
                        (template_app
                          (template_app
                            (template_hole 3,
                             template_app
                              (template_hole 2, template_var 3)),
                           template_var 13),
                         template_var 2))),
                   template_app
                    (template_app
                      (template_app
                        (template_hole 14,
                         template_app (template_hole 6, template_var 10)),
                       template_var 1),
                     template_var 0))),
               template_var 10),
             template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 13),
                   template_var 8),
                 template_var 4),
               template_var 1))
           ))),
    ("Sepref_Foreach.hn_monadic_nfoldli_rl'",
     "[| INDEP ?Rk; INDEP ?R\<sigma>;
         ?P \<Longrightarrow>\<^sub>t
         ?\<Gamma> * hn_ctxt (list_assn ?Rk) ?s' ?s *
         hn_ctxt ?R\<sigma> ?\<sigma>' ?\<sigma>;
         !!\<sigma> \<sigma>'.
            hn_refine (?\<Gamma> * hn_ctxt ?R\<sigma> \<sigma>' \<sigma>)
             (?c \<sigma>) (?\<Gamma>c \<sigma>' \<sigma>) bool_assn
             (?c' \<sigma>');
         !!\<sigma>' \<sigma>.
            TERM monadic_nfoldli ==>
            ?\<Gamma>c \<sigma>' \<sigma> \<Longrightarrow>\<^sub>t
            ?\<Gamma> * hn_ctxt ?R\<sigma> \<sigma>' \<sigma>;
         !!x' x \<sigma>' \<sigma>.
            x' : set ?s' ==>
            hn_refine
             (?\<Gamma> * hn_ctxt ?Rk x' x *
              hn_ctxt ?R\<sigma> \<sigma>' \<sigma>)
             (?f x \<sigma>) (?\<Gamma>f x' x \<sigma>' \<sigma>) ?R\<sigma>
             (?f' x' \<sigma>');
         !!x' x \<sigma>' \<sigma>.
            TERM monadic_nfoldli ==>
            ?\<Gamma>f x' x \<sigma>' \<sigma> \<Longrightarrow>\<^sub>t
            ?\<Gamma> * hn_ctxt ?Rk' x' x *
            hn_ctxt ?Pf\<sigma> \<sigma>' \<sigma>;
         !!x x'.
            hn_ctxt ?Rk' x' x \<or>\<^sub>A
            hn_ctxt ?Rk x' x \<Longrightarrow>\<^sub>t
            hn_ctxt ?Rk'' x' x |]
      ==> hn_refine ?P (imp_nfoldli ?s ?c ?f ?\<sigma>)
           (?\<Gamma> * hn_ctxt (list_assn ?Rk'') ?s' ?s *
            hn_invalid ?R\<sigma> ?\<sigma>' ?\<sigma>)
           ?R\<sigma>
           (monadic_nfoldli $ ?s' $ (%x. (#?c' x#)) $
            (%x. (#%xa. (#?f' x xa#)#)) $
            ?\<sigma>')",
     template_implication
      ([template_predicate
         (template_app (template_hole 33, template_var 16)),
        template_predicate
         (template_app (template_hole 32, template_var 15)),
        template_predicate
         (
            template_app
             (template_app (template_hole 31, template_var 14),
              template_app
               (template_app
                 (template_hole 30,
                  template_app
                   (template_app (template_hole 30, template_var 13),
                    template_app
                     (template_app
                       (template_app
                         (template_hole 29,
                          template_app (template_hole 28, template_var 16)),
                        template_var 12),
                      template_var 11))),
                template_app
                 (template_app
                   (template_app (template_hole 27, template_var 15),
                    template_var 10),
                  template_var 9)))
            ),
        template_predicate (template_app (template_hole 26, t_empty)),
        template_predicate (template_app (template_hole 25, t_empty)),
        template_predicate (template_app (template_hole 19, t_empty)),
        template_predicate (template_app (template_hole 19, t_empty)),
        template_predicate (template_app (template_hole 18, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 15, template_var 14),
                   template_app
                    (template_app
                      (template_app
                        (template_app (template_hole 10, template_var 11),
                         template_var 8),
                       template_var 5),
                     template_var 9)),
                 template_app
                  (template_app
                    (template_hole 30,
                     template_app
                      (template_app (template_hole 30, template_var 13),
                       template_app
                        (template_app
                          (template_app
                            (template_hole 29,
                             template_app
                              (template_hole 28, template_var 0)),
                           template_var 12),
                         template_var 11))),
                   template_app
                    (template_app
                      (template_app
                        (template_hole 27,
                         template_app (template_hole 9, template_var 15)),
                       template_var 10),
                     template_var 9))),
               template_var 15),
             template_app
              (template_app
                (template_hole 8,
                 template_app
                  (template_app
                    (template_hole 7,
                     template_app
                      (template_app
                        (template_hole 6,
                         template_app
                          (template_app (template_hole 5, template_hole 4),
                           template_var 12)),
                       t_empty)),
                   t_empty)),
               template_var 10))
           ))),
    ("Sepref_Foreach.hn_monadic_FOREACH",
     "[| INDEP ?Rk; INDEP ?Rs; INDEP ?R\<sigma>;
         ?P \<Longrightarrow>\<^sub>t
         ?\<Gamma> * hn_ctxt ?Rs ?s' ?s *
         hn_ctxt ?R\<sigma> ?\<sigma>' ?\<sigma>;
         GEN_ALGO ?tsl (IS_TO_SORTED_LIST ?ordR ?Rs ?Rk);
         !!\<sigma> \<sigma>'.
            hn_refine
             (?\<Gamma> * hn_ctxt ?Rs ?s' ?s *
              hn_ctxt ?R\<sigma> \<sigma>' \<sigma>)
             (?c \<sigma>) (?\<Gamma>c \<sigma>' \<sigma>) bool_assn
             (?c' \<sigma>');
         !!\<sigma>' \<sigma>.
            TERM monadic_FOREACH ==>
            ?\<Gamma>c \<sigma>' \<sigma> \<Longrightarrow>\<^sub>t
            ?\<Gamma> * hn_ctxt ?Rs ?s' ?s *
            hn_ctxt ?R\<sigma> \<sigma>' \<sigma>;
         !!x' x \<sigma>' \<sigma>.
            hn_refine
             (?\<Gamma> * hn_ctxt ?Rs ?s' ?s * hn_ctxt ?Rk x' x *
              hn_ctxt ?R\<sigma> \<sigma>' \<sigma>)
             (?f x \<sigma>) (?\<Gamma>f x' x \<sigma>' \<sigma>) ?R\<sigma>
             (?f' x' \<sigma>');
         !!x' x \<sigma>' \<sigma>.
            TERM monadic_FOREACH ==>
            ?\<Gamma>f x' x \<sigma>' \<sigma> \<Longrightarrow>\<^sub>t
            ?\<Gamma> * hn_ctxt ?Rs ?s' ?s * hn_ctxt ?Pfx x' x *
            hn_ctxt ?Pf\<sigma> \<sigma>' \<sigma> |]
      ==> hn_refine ?P (imp_foreach ?tsl ?s ?c ?f ?\<sigma>)
           (?\<Gamma> * hn_ctxt ?Rs ?s' ?s *
            hn_invalid ?R\<sigma> ?\<sigma>' ?\<sigma>)
           ?R\<sigma>
           (PR_CONST (monadic_FOREACH ?ordR ?I) $ ?s' $ (%x. (#?c' x#)) $
            (%x. (#%xa. (#?f' x xa#)#)) $
            ?\<sigma>')",
     template_implication
      ([template_predicate
         (template_app (template_hole 33, template_var 19)),
        template_predicate
         (template_app (template_hole 32, template_var 18)),
        template_predicate
         (template_app (template_hole 31, template_var 17)),
        template_predicate
         (
            template_app
             (template_app (template_hole 30, template_var 16),
              template_app
               (template_app
                 (template_hole 29,
                  template_app
                   (template_app (template_hole 29, template_var 15),
                    template_app
                     (template_app
                       (template_app (template_hole 28, template_var 18),
                        template_var 14),
                      template_var 13))),
                template_app
                 (template_app
                   (template_app (template_hole 27, template_var 17),
                    template_var 12),
                  template_var 11)))
            ),
        template_predicate
         (
            template_app
             (template_app (template_hole 26, template_var 10),
              template_app
               (template_app
                 (template_app (template_hole 25, template_var 9),
                  template_var 18),
                template_var 19))
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 15, template_var 16),
                   template_app
                    (template_app
                      (template_app
                        (template_app
                          (template_app (template_hole 11, template_var 10),
                           template_var 13),
                         template_var 8),
                       template_var 5),
                     template_var 11)),
                 template_app
                  (template_app
                    (template_hole 29,
                     template_app
                      (template_app (template_hole 29, template_var 15),
                       template_app
                        (template_app
                          (template_app (template_hole 28, template_var 18),
                           template_var 14),
                         template_var 13))),
                   template_app
                    (template_app
                      (template_app
                        (template_hole 27,
                         template_app (template_hole 10, template_var 17)),
                       template_var 12),
                     template_var 11))),
               template_var 17),
             template_app
              (template_app
                (template_hole 9,
                 template_app
                  (template_app
                    (template_hole 8,
                     template_app
                      (template_app
                        (template_hole 7,
                         template_app
                          (template_app
                            (template_hole 6,
                             template_app
                              (template_hole 5,
                               template_app
                                (template_app
                                  (template_hole 4, template_var 9),
                                 template_var 0))),
                           template_var 14)),
                       t_empty)),
                   t_empty)),
               template_var 12))
           )))]
