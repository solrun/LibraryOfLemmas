   [("Refine_Foreach.FOREACH_emp",
     "FOREACH {} ?f ?\<sigma> = RETURN ?\<sigma>",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 2, template_hole 1), template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Refine_Foreach.dfoldli_simps", "dfoldli [] ?c ?f ?s = dRETURN ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Refine_Foreach.FOREACHc_emp",
     "FOREACH\<^sub>C {} ?c ?f ?\<sigma> = RETURN ?\<sigma>",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Refine_Foreach.nfoldli_simps", "nfoldli [] ?c ?f ?s = RETURN ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 2, template_hole 1),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app (template_hole 0, template_var 0))),
    ("Refine_Foreach.FOREACHc_refines_FOREACHcd_aux",
     "FOREACH\<^sub>C ?s ?c ?f ?\<sigma> <= FOREACHcd ?s ?c ?f ?\<sigma>",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_app
            (template_app (template_hole 1, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0))),
    ("Refine_Foreach.LIST_FOREACH'_refine",
     "LIST_FOREACH' ?tsl' ?c' ?f' ?\<sigma>'
      <= LIST_FOREACH ?\<Phi> ?tsl' ?c' ?f' ?\<sigma>'",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_app
            (template_app (template_hole 1, template_var 4),
             template_var 3),
           template_var 2),
         template_var 1),
       template_app
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 4),
             template_var 3),
           template_var 2),
         template_var 1))),
    ("Refine_Foreach.nfoldli_no_ctd",
     "~ ?ctd ?s ==> nfoldli ?l ?ctd ?f ?s = RETURN ?s",
     template_implication
      ([template_negation
         (
            template_predicate
             (template_app (template_var 3, template_var 2))
            )],
       template_equation
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 1),
               template_var 3),
             template_var 0),
           template_var 2),
         template_app (template_hole 0, template_var 2)))),
    ("Refine_Foreach.FOREACHi_emp",
     "FOREACH\<^bsup>?\<Phi>\<^esup> {} ?f ?\<sigma> =
      ASSERT (?\<Phi> {} ?\<sigma>) >>= (%_. RETURN ?\<sigma>)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 2),
             template_hole 3),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 2,
           template_app
            (template_hole 1,
             template_app
              (template_app (template_var 2, template_hole 3),
               template_var 0))),
         t_empty))),
    ("Refine_Foreach.LIST_FOREACH'_eq",
     "LIST_FOREACH (%_ _. True) ?tsl' ?c' ?f' ?\<sigma>' =
      LIST_FOREACH' ?tsl' ?c' ?f' ?\<sigma>'",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 2, t_empty), template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0))),
    ("Refine_Foreach.foldli_dres_pres_SUCCEED",
     "foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x) dSUCCEED =
      dSUCCEED",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 2),
             template_app
              (template_app
                (template_app (template_hole 3, template_hole 2),
                 template_hole 2),
               template_var 1)),
           t_empty),
         template_hole 0),
       template_hole 0)),
    ("Refine_Foreach.foldli_dres_pres_FAIL",
     "foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x) dFAIL =
      dFAIL",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 2),
             template_app
              (template_app
                (template_app (template_hole 3, template_hole 2),
                 template_hole 2),
               template_var 1)),
           t_empty),
         template_hole 0),
       template_hole 0)),
    ("Refine_Foreach.FOREACHci_emp",
     "FOREACH\<^sub>C\<^bsup>?\<Phi>\<^esup> {} ?c ?f ?\<sigma> =
      ASSERT (?\<Phi> {} ?\<sigma>) >>= (%_. RETURN ?\<sigma>)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 4, template_var 3),
               template_hole 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 2,
           template_app
            (template_hole 1,
             template_app
              (template_app (template_var 3, template_hole 3),
               template_var 0))),
         t_empty))),
    ("Refine_Foreach.FOREACHoi_emp",
     "FOREACH\<^sub>O\<^bsup>?R,?\<Phi>\<^esup> {} ?f ?\<sigma> =
      ASSERT (?\<Phi> {} ?\<sigma>) >>= (%_. RETURN ?\<sigma>)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app (template_hole 4, template_var 3),
               template_var 2),
             template_hole 3),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 2,
           template_app
            (template_hole 1,
             template_app
              (template_app (template_var 2, template_hole 3),
               template_var 0))),
         t_empty))),
    ("Refine_Foreach.nfoldli_map",
     "nfoldli (map ?f ?l) ?ctd ?g ?s = nfoldli ?l ?ctd (?g o ?f) ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 3,
               template_app
                (template_app (template_hole 2, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 1, template_var 3),
             template_var 2),
           template_app
            (template_app (template_hole 0, template_var 1),
             template_var 4)),
         template_var 0))),
    ("Refine_Foreach.FOREACHoci_emp",
     "FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?\<Phi>\<^esup> {} ?c ?f ?\<sigma> =
      ASSERT (?\<Phi> {} ?\<sigma>) >>= (%_. RETURN ?\<sigma>)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 4, template_var 4),
                 template_var 3),
               template_hole 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 2,
           template_app
            (template_hole 1,
             template_app
              (template_app (template_var 3, template_hole 3),
               template_var 0))),
         t_empty))),
    ("Refine_Foreach.bij_set_rel_for_inj",
     "[| bijective ?R; (?s, ?s') : \<langle>?R\<rangle>set_rel |]
      ==> inj_on (fun_of_rel ?R) ?s",
     template_implication
      ([template_predicate (template_app (template_hole 6, template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 5,
                template_app
                 (template_app (template_hole 4, template_var 1),
                  template_var 0)),
              template_app
               (template_app (template_hole 3, template_hole 2),
                template_var 2))
            )],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 1,
               template_app (template_hole 0, template_var 2)),
             template_var 1)
           ))),
    ("Refine_Foreach.nfoldli_append",
     "nfoldli (?l1.0 @ ?l2.0) ?ctd ?f ?s =
      nfoldli ?l1.0 ?ctd ?f ?s >>= nfoldli ?l2.0 ?ctd ?f",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 0,
           template_app
            (template_app
              (template_app
                (template_app (template_hole 2, template_var 4),
                 template_var 2),
               template_var 1),
             template_var 0)),
         template_app
          (template_app
            (template_app (template_hole 2, template_var 3),
             template_var 2),
           template_var 1)))),
    ("Refine_Foreach.bij_set_rel_for_inj",
     "[| bijective ?R; (?s, ?s') : \<langle>?R\<rangle>set_rel |]
      ==> ?s' = fun_of_rel ?R ` ?s",
     template_implication
      ([template_predicate (template_app (template_hole 7, template_var 2)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 6,
                template_app
                 (template_app (template_hole 5, template_var 1),
                  template_var 0)),
              template_app
               (template_app (template_hole 4, template_hole 3),
                template_var 2))
            )],
       template_equation
        (template_var 0,
         template_app
          (template_app
            (template_hole 1,
             template_app (template_hole 0, template_var 2)),
           template_var 1)))),
    ("Refine_Foreach.dfoldli_by_foldli",
     "dfoldli ?l ?c ?f ?\<sigma> =
      foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x)
       (dRETURN ?\<sigma>)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 5, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 3),
             template_app
              (template_app
                (template_app (template_hole 3, template_hole 2),
                 template_hole 2),
               template_var 2)),
           t_empty),
         template_app (template_hole 0, template_var 0)))),
    ("Refine_Foreach.while_eq_nfoldli",
     "WHILE\<^sub>T (FOREACH_cond ?c) (FOREACH_body ?f) (?l, ?\<sigma>) >>=
      (%(uu_, \<sigma>). RETURN \<sigma>) =
      nfoldli ?l ?c ?f ?\<sigma>",
     template_equation
      (template_app
        (template_app
          (template_hole 7,
           template_app
            (template_app
              (template_app
                (template_hole 6,
                 template_app (template_hole 5, template_var 3)),
               template_app (template_hole 4, template_var 2)),
             template_app
              (template_app (template_hole 3, template_var 1),
               template_var 0))),
         template_app (template_hole 2, t_empty)),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 3),
           template_var 2),
         template_var 0))),
    ("Refine_Foreach.while_nfoldli",
     "WHILE\<^sub>T (FOREACH_cond ?c) (FOREACH_body ?f) (?l, ?\<sigma>) >>=
      (%(uu_, \<sigma>). RETURN \<sigma>)
      <= nfoldli ?l ?c ?f ?\<sigma>",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_hole 7,
           template_app
            (template_app
              (template_app
                (template_hole 6,
                 template_app (template_hole 5, template_var 3)),
               template_app (template_hole 4, template_var 2)),
             template_app
              (template_app (template_hole 3, template_var 1),
               template_var 0))),
         template_app (template_hole 2, t_empty)),
       template_app
        (template_app
          (template_app
            (template_app (template_hole 0, template_var 1),
             template_var 3),
           template_var 2),
         template_var 0))),
    ("Refine_Foreach.FOREACHoci_by_LIST_FOREACH",
     "FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?\<Phi>\<^esup> ?S ?c ?f
       ?\<sigma>0.0 =
      ASSERT (finite ?S) >>=
      (%_. LIST_FOREACH ?\<Phi> (it_to_sorted_list ?R ?S) ?c ?f
            ?\<sigma>0.0)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 5, template_var 5),
                 template_var 4),
               template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_hole 4,
           template_app
            (template_hole 3,
             template_app (template_hole 2, template_var 3))),
         t_empty))),
    ("Refine_Foreach.nfoldli_while",
     "nfoldli ?l ?c ?f ?\<sigma>
      <= WHILE\<^sub>T\<^bsup>?I\<^esup> (FOREACH_cond ?c) (FOREACH_body ?f)
          (?l, ?\<sigma>) >>=
         (%(uu_, \<sigma>). RETURN \<sigma>)",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_app
            (template_app (template_hole 7, template_var 4),
             template_var 3),
           template_var 2),
         template_var 1),
       template_app
        (template_app
          (template_hole 6,
           template_app
            (template_app
              (template_app
                (template_app (template_hole 5, template_var 0),
                 template_app (template_hole 4, template_var 3)),
               template_app (template_hole 3, template_var 2)),
             template_app
              (template_app (template_hole 2, template_var 4),
               template_var 1))),
         template_app (template_hole 1, t_empty)))),
    ("Refine_Foreach.member_by_nfoldli",
     "nfoldli ?l Not (%y _. RETURN (y = ?x)) False
      <= SPEC (%r. r = (?x : set ?l))",
     template_inequation
      (less_equals,
       template_app
        (template_app
          (template_app
            (template_app (template_hole 9, template_var 1), t_empty),
           t_empty),
         template_hole 5),
       template_app
        (template_hole 4, template_app (template_hole 3, t_empty)))),
    ("Refine_Foreach.dfoldli_simps",
     "dfoldli (?x # ?ls) ?c ?f ?s =
      (if ?c ?s then ?f ?x ?s >>= dfoldli ?ls ?c ?f else dRETURN ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_hole 2,
             template_app (template_var 2, template_var 0)),
           template_app
            (template_app
              (template_hole 1,
               template_app
                (template_app (template_var 1, template_var 4),
                 template_var 0)),
             t_empty)),
         template_app (template_hole 0, template_var 0)))),
    ("Refine_Foreach.nfoldli_simps",
     "nfoldli (?x # ?ls) ?c ?f ?s =
      (if ?c ?s then ?f ?x ?s >>= nfoldli ?ls ?c ?f else RETURN ?s)",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_hole 2,
             template_app (template_var 2, template_var 0)),
           template_app
            (template_app
              (template_hole 1,
               template_app
                (template_app (template_var 1, template_var 4),
                 template_var 0)),
             t_empty)),
         template_app (template_hole 0, template_var 0)))),
    ("Refine_Foreach.nfoldli_nfoldli_prod_conv",
     "nfoldli ?l2.0 ?ctd (%i. nfoldli ?l1.0 ?ctd (?f i)) ?s =
      nfoldli (List.product ?l2.0 ?l1.0) ?ctd (%(i, j). ?f i j) ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 4, template_var 4),
             template_var 3),
           t_empty),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 4),
                 template_var 2)),
             template_var 3),
           template_app (template_hole 0, t_empty)),
         template_var 0))),
    ("Refine_Foreach.map_foreach",
     "finite ?S ==>
      FOREACH ?S (%x \<sigma>. RETURN (insert (?f x) \<sigma>)) ?R0.0
      <= SPEC ((=) (?R0.0 Un ?f ` ?S))",
     template_implication
      ([template_predicate
         (template_app (template_hole 9, template_var 2))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 7, template_var 2), t_empty),
           template_var 0),
         template_app
          (template_hole 4,
           template_app
            (template_hole 3,
             template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 0),
                 template_app
                  (template_app (template_hole 0, template_var 1),
                   template_var 2)))))))),
    ("Refine_Foreach.nfoldli_map_inv",
     "inj ?g ==>
      nfoldli ?l ?c ?f = nfoldli (map ?g ?l) ?c (%x. ?f (the_inv ?g x))",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 6, template_var 3),
              template_hole 5)
            )],
       template_equation
        (template_app
          (template_app
            (template_app (template_hole 3, template_var 2),
             template_var 1),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_hole 2,
               template_app
                (template_app (template_hole 1, template_var 3),
                 template_var 2)),
             template_var 1),
           t_empty)))),
    ("Refine_Foreach.it_step_insert_iff",
     "[| ?it <= ?S; ?x : ?it |]
      ==> ?S - (?it - {?x}) = insert ?x (?S - ?it)",
     template_implication
      ([template_inequation (less_equals, template_var 2, template_var 1),
        template_predicate
         (
            template_app
             (template_app (template_hole 4, template_var 0),
              template_var 2)
            )],
       template_equation
        (template_app
          (template_app (template_hole 2, template_var 1),
           template_app
            (template_app (template_hole 2, template_var 2),
             template_app
              (template_app (template_hole 1, template_var 0),
               template_hole 0))),
         template_app
          (template_app (template_hole 1, template_var 0),
           template_app
            (template_app (template_hole 2, template_var 1),
             template_var 2))))),
    ("Refine_Foreach.dfoldli_mono",
     "(!!x s. ?f x s <= ?f' x s) ==>
      dfoldli ?l ?c ?f ?\<sigma> <= dfoldli ?l ?c ?f' ?\<sigma>",
     template_implication
      ([template_predicate (template_app (template_hole 4, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 4),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 3),
           template_var 0)))),
    ("Refine_Foreach.nfoldli_mono",
     "(!!x s. ?f x s <= ?f' x s) ==>
      nfoldli ?l ?c ?f ?\<sigma> <= nfoldli ?l ?c ?f' ?\<sigma>",
     template_implication
      ([template_predicate (template_app (template_hole 4, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 4),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 3),
           template_var 0)))),
    ("Refine_Foreach.nfoldli_shift",
     "nfoldli ?l ?c ?f =
      nfoldli (map (%i. i + ?ofs) ?l) ?c
       (%x s. ASSERT (?ofs <= x) >>= (%_. ?f (x - ?ofs) s))",
     template_equation
      (template_app
        (template_app
          (template_app (template_hole 6, template_var 3), template_var 2),
         template_var 1),
       template_app
        (template_app
          (template_app
            (template_hole 6,
             template_app
              (template_app (template_hole 5, t_empty), template_var 3)),
           template_var 2),
         t_empty))),
    ("Refine_Foreach.nfoldli_transfer_plain",
     "(!!x s. RETURN (?f x s) <= ?f' x s) ==>
      RETURN (foldli ?l ?c ?f ?s) <= nfoldli ?l ?c ?f' ?s",
     template_implication
      ([template_predicate (template_app (template_hole 6, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_hole 2,
           template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 2),
                 template_var 1),
               template_var 4),
             template_var 0)),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 3),
           template_var 0)))),
    ("Refine_Foreach.dfoldli_mono",
     "(!!x s. flat_ge (?f x s) (?f' x s)) ==>
      flat_ge (dfoldli ?l ?c ?f ?\<sigma>) (dfoldli ?l ?c ?f' ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 5, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 2, template_hole 1),
               template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 2),
                     template_var 1),
                   template_var 4),
                 template_var 0)),
             template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 2),
                   template_var 1),
                 template_var 3),
               template_var 0))
           ))),
    ("Refine_Foreach.nfoldli_mono",
     "(!!x s. flat_ge (?f x s) (?f' x s)) ==>
      flat_ge (nfoldli ?l ?c ?f ?\<sigma>) (nfoldli ?l ?c ?f' ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 5, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 2, template_hole 1),
               template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 2),
                     template_var 1),
                   template_var 4),
                 template_var 0)),
             template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 2),
                   template_var 1),
                 template_var 3),
               template_var 0))
           ))),
    ("Refine_Foreach.nfoldli_foreach_shift",
     "nfoldli [?a..<?b] ?c ?f =
      nfoldli [?a + ?ofs..<?b + ?ofs] ?c
       (%x s. ASSERT (?ofs <= x) >>= (%_. ?f (x - ?ofs) s))",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_hole 6,
             template_app
              (template_app (template_hole 5, template_var 4),
               template_var 3)),
           template_var 2),
         template_var 1),
       template_app
        (template_app
          (template_app
            (template_hole 6,
             template_app
              (template_app
                (template_hole 5,
                 template_app
                  (template_app (template_hole 4, template_var 4),
                   template_var 0)),
               template_app
                (template_app (template_hole 4, template_var 3),
                 template_var 0))),
           template_var 2),
         t_empty))),
    ("Refine_Foreach.nfoldli_by_idx",
     "nfoldli ?l ?c ?f ?s =
      nfoldli [0..<length ?l] ?c
       (%i s. ASSERT (i < length ?l) >>= (%_. let x = ?l ! i in ?f x s))
       ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app (template_hole 9, template_var 3),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_hole 8,
               template_app
                (template_app (template_hole 7, template_hole 6),
                 template_app (template_hole 5, template_var 3))),
             template_var 2),
           t_empty),
         template_var 0))),
    ("Refine_Foreach.dres_foldli_ne_bot",
     "[| ?\<sigma> ~= dSUCCEED; !!x \<sigma>. ?f x \<sigma> ~= dSUCCEED |]
      ==> foldli ?l ?c (%x s. s >>= ?f x) ?\<sigma> ~= dSUCCEED",
     template_implication
      ([template_negation
         (template_equation (template_var 3, template_hole 4)),
        template_predicate (template_app (template_hole 3, t_empty))],
       template_negation
        (
           template_equation
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 1, template_var 1),
                   template_var 0),
                 t_empty),
               template_var 3),
             template_hole 4)
           ))),
    ("Refine_Foreach.nfoldli_by_idx_gen",
     "nfoldli (drop ?k ?l) ?c ?f ?s =
      nfoldli [?k..<length ?l] ?c
       (%i s. ASSERT (i < length ?l) >>= (%_. let x = ?l ! i in ?f x s))
       ?s",
     template_equation
      (template_app
        (template_app
          (template_app
            (template_app
              (template_hole 9,
               template_app
                (template_app (template_hole 8, template_var 4),
                 template_var 3)),
             template_var 2),
           template_var 1),
         template_var 0),
       template_app
        (template_app
          (template_app
            (template_app
              (template_hole 7,
               template_app
                (template_app (template_hole 6, template_var 4),
                 template_app (template_hole 5, template_var 3))),
             template_var 2),
           t_empty),
         template_var 0))),
    ("Refine_Foreach.FOREACHci_weaken",
     "(!!it \<sigma>.
          [| it <= ?S; ?I it \<sigma> |] ==> ?I' it \<sigma>) ==>
      FOREACH\<^sub>C\<^bsup>?I'\<^esup> ?S ?c ?f ?\<sigma>0.0
      <= FOREACH\<^sub>C\<^bsup>?I\<^esup> ?S ?c ?f ?\<sigma>0.0",
     template_implication
      ([template_predicate (template_app (template_hole 5, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 3),
                 template_var 5),
               template_var 2),
             template_var 1),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 4),
                 template_var 5),
               template_var 2),
             template_var 1),
           template_var 0)))),
    ("Refine_Foreach.LIST_FOREACH'_transfer_plain",
     "[| RETURN ?tsl <= ?tsl';
         !!x \<sigma>. RETURN (?f x \<sigma>) <= ?f' x \<sigma> |]
      ==> RETURN (foldli ?tsl ?c ?f ?\<sigma>)
          <= LIST_FOREACH' ?tsl' ?c ?f' ?\<sigma>",
     template_implication
      ([template_inequation
         (less_equals, template_app (template_hole 6, template_var 5),
          template_var 4),
        template_predicate (template_app (template_hole 5, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_hole 2,
           template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 5),
                 template_var 1),
               template_var 3),
             template_var 0)),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 4),
               template_var 1),
             template_var 2),
           template_var 0)))),
    ("Refine_Foreach.FOREACHoci_weaken",
     "(!!it \<sigma>.
          [| it <= ?S; ?I it \<sigma> |] ==> ?I' it \<sigma>) ==>
      FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?I'\<^esup> ?S ?c ?f ?\<sigma>0.0
      <= FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?I\<^esup> ?S ?c ?f
          ?\<sigma>0.0",
     template_implication
      ([template_predicate (template_app (template_hole 5, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 3),
                   template_var 4),
                 template_var 6),
               template_var 2),
             template_var 1),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 3),
                   template_var 5),
                 template_var 6),
               template_var 2),
             template_var 1),
           template_var 0)))),
    ("Refine_Foreach.nfoldli_transfer_dres",
     "(!!x s. nres_of (?f x s) <= ?f' x s) ==>
      nres_of
       (foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x)
         (dRETURN ?s))
      <= nfoldli ?l ?c ?f' ?s",
     template_implication
      ([template_predicate (template_app (template_hole 10, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_hole 6,
           template_app
            (template_app
              (template_app
                (template_app (template_hole 5, template_var 2),
                 template_app
                  (template_app
                    (template_app (template_hole 4, template_hole 3),
                     template_hole 3),
                   template_var 1)),
               t_empty),
             template_app (template_hole 1, template_var 0))),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 2),
               template_var 1),
             template_var 3),
           template_var 0)))),
    ("Refine_Foreach.sum_impl_correct",
     "[| finite ?S; !!x. x : ?S ==> ?gi x <= SPEC (%r. r = ?g x) |]
      ==> sum_impl ?gi ?S <= SPEC (%r. r = sum ?g ?S)",
     template_implication
      ([template_predicate (template_app (template_hole 8, template_var 2)),
        template_predicate (template_app (template_hole 7, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app (template_hole 1, template_var 1), template_var 2),
         template_app
          (template_hole 4, template_app (template_hole 3, t_empty))))),
    ("Refine_Foreach.param_nfoldli",
     "(nfoldli, nfoldli)
      : \<langle>?Ra\<rangle>list_rel \<rightarrow>
        (?Rb \<rightarrow> bool_rel) \<rightarrow>
        (?Ra \<rightarrow>
         ?Rb \<rightarrow> \<langle>?Rb\<rangle>nres_rel) \<rightarrow>
        ?Rb \<rightarrow> \<langle>?Rb\<rangle>nres_rel",
     template_predicate
      (
         template_app
          (template_app
            (template_hole 26,
             template_app
              (template_app (template_hole 25, template_hole 24),
               template_hole 23)),
           template_app
            (template_app
              (template_hole 22,
               template_app
                (template_app (template_hole 21, template_hole 20),
                 template_app
                  (template_app (template_hole 19, template_hole 18),
                   template_var 1))),
             template_app
              (template_app
                (template_hole 17,
                 template_app
                  (template_app (template_hole 16, template_hole 15),
                   template_app
                    (template_app
                      (template_hole 14,
                       template_app
                        (template_app (template_hole 13, template_hole 12),
                         template_var 0)),
                     template_hole 11))),
               template_app
                (template_app
                  (template_hole 10,
                   template_app
                    (template_app (template_hole 9, template_hole 8),
                     template_app
                      (template_app
                        (template_hole 7,
                         template_app
                          (template_app (template_hole 6, template_hole 5),
                           template_var 1)),
                       template_app
                        (template_app
                          (template_hole 4,
                           template_app
                            (template_app
                              (template_hole 3, template_hole 2),
                             template_var 0)),
                         template_app
                          (template_app (template_hole 1, template_hole 0),
                           template_var 0))))),
                 template_app
                  (template_app
                    (template_hole 4,
                     template_app
                      (template_app (template_hole 3, template_hole 2),
                       template_var 0)),
                   template_app
                    (template_app (template_hole 1, template_hole 0),
                     template_var 0))))))
         )),
    ("Refine_Foreach.FOREACHoci_weaken_order",
     "(!!x y. [| x : ?S; y : ?S; ?RR x y |] ==> ?RR' x y) ==>
      FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?I\<^esup> ?S ?c ?f ?\<sigma>0.0
      <= FOREACH\<^sub>O\<^sub>C\<^bsup>?RR',?I\<^esup> ?S ?c ?f
          ?\<sigma>0.0",
     template_implication
      ([template_predicate (template_app (template_hole 4, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 5),
                   template_var 3),
                 template_var 6),
               template_var 2),
             template_var 1),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 4),
                   template_var 3),
                 template_var 6),
               template_var 2),
             template_var 1),
           template_var 0)))),
    ("Refine_Foreach.foldli_mono_dres",
     "(!!a x. ?f a x <= ?f' a x) ==>
      foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x) ?\<sigma>
      <= foldli ?l (case_dres False False ?c) (%x s. s >>= ?f' x)
          ?\<sigma>",
     template_implication
      ([template_predicate (template_app (template_hole 7, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 2),
               template_app
                (template_app
                  (template_app (template_hole 2, template_hole 1),
                   template_hole 1),
                 template_var 1)),
             t_empty),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 3, template_var 2),
               template_app
                (template_app
                  (template_app (template_hole 2, template_hole 1),
                   template_hole 1),
                 template_var 1)),
             t_empty),
           template_var 0)))),
    ("Refine_Foreach.LIST_FOREACH'_param",
     "(LIST_FOREACH', LIST_FOREACH')
      : \<langle>\<langle>?Rv\<rangle>list_rel\<rangle>nres_rel \<rightarrow>
        (?R\<sigma> \<rightarrow> bool_rel) \<rightarrow>
        (?Rv \<rightarrow>
         ?R\<sigma> \<rightarrow>
         \<langle>?R\<sigma>\<rangle>nres_rel) \<rightarrow>
        ?R\<sigma> \<rightarrow> \<langle>?R\<sigma>\<rangle>nres_rel",
     template_predicate
      (
         template_app
          (template_app
            (template_hole 28,
             template_app
              (template_app (template_hole 27, template_hole 26),
               template_hole 25)),
           template_app
            (template_app
              (template_hole 24,
               template_app
                (template_app (template_hole 23, template_hole 22),
                 template_app
                  (template_app (template_hole 21, template_hole 20),
                   template_app
                    (template_app (template_hole 19, template_hole 18),
                     template_var 1)))),
             template_app
              (template_app
                (template_hole 17,
                 template_app
                  (template_app (template_hole 16, template_hole 15),
                   template_app
                    (template_app
                      (template_hole 14,
                       template_app
                        (template_app (template_hole 13, template_hole 12),
                         template_var 0)),
                     template_hole 11))),
               template_app
                (template_app
                  (template_hole 10,
                   template_app
                    (template_app (template_hole 9, template_hole 8),
                     template_app
                      (template_app
                        (template_hole 7,
                         template_app
                          (template_app (template_hole 6, template_hole 5),
                           template_var 1)),
                       template_app
                        (template_app
                          (template_hole 4,
                           template_app
                            (template_app
                              (template_hole 3, template_hole 2),
                             template_var 0)),
                         template_app
                          (template_app (template_hole 1, template_hole 0),
                           template_var 0))))),
                 template_app
                  (template_app
                    (template_hole 4,
                     template_app
                      (template_app (template_hole 3, template_hole 2),
                       template_var 0)),
                   template_app
                    (template_app (template_hole 1, template_hole 0),
                     template_var 0))))))
         )),
    ("Refine_Foreach.LIST_FOREACH_autoref",
     "(LIST_FOREACH', LIST_FOREACH ?\<Phi>)
      : \<langle>\<langle>?Rv\<rangle>list_rel\<rangle>nres_rel \<rightarrow>
        (?R\<sigma> \<rightarrow> bool_rel) \<rightarrow>
        (?Rv \<rightarrow>
         ?R\<sigma> \<rightarrow>
         \<langle>?R\<sigma>\<rangle>nres_rel) \<rightarrow>
        ?R\<sigma> \<rightarrow> \<langle>?R\<sigma>\<rangle>nres_rel",
     template_predicate
      (
         template_app
          (template_app
            (template_hole 28,
             template_app
              (template_app (template_hole 27, template_hole 26),
               template_app (template_hole 25, template_var 2))),
           template_app
            (template_app
              (template_hole 24,
               template_app
                (template_app (template_hole 23, template_hole 22),
                 template_app
                  (template_app (template_hole 21, template_hole 20),
                   template_app
                    (template_app (template_hole 19, template_hole 18),
                     template_var 1)))),
             template_app
              (template_app
                (template_hole 17,
                 template_app
                  (template_app (template_hole 16, template_hole 15),
                   template_app
                    (template_app
                      (template_hole 14,
                       template_app
                        (template_app (template_hole 13, template_hole 12),
                         template_var 0)),
                     template_hole 11))),
               template_app
                (template_app
                  (template_hole 10,
                   template_app
                    (template_app (template_hole 9, template_hole 8),
                     template_app
                      (template_app
                        (template_hole 7,
                         template_app
                          (template_app (template_hole 6, template_hole 5),
                           template_var 1)),
                       template_app
                        (template_app
                          (template_hole 4,
                           template_app
                            (template_app
                              (template_hole 3, template_hole 2),
                             template_var 0)),
                         template_app
                          (template_app (template_hole 1, template_hole 0),
                           template_var 0))))),
                 template_app
                  (template_app
                    (template_hole 4,
                     template_app
                      (template_app (template_hole 3, template_hole 2),
                       template_var 0)),
                   template_app
                    (template_app (template_hole 1, template_hole 0),
                     template_var 0))))))
         )),
    ("Refine_Foreach.foldli_mono_dres_flat",
     "(!!a x. flat_ge (?f a x) (?f' a x)) ==>
      flat_ge
       (foldli ?l (case_dres False False ?c) (%x s. s >>= ?f x) ?\<sigma>)
       (foldli ?l (case_dres False False ?c) (%x s. s >>= ?f' x)
         ?\<sigma>)",
     template_implication
      ([template_predicate (template_app (template_hole 8, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_app (template_hole 5, template_hole 4),
               template_app
                (template_app
                  (template_app
                    (template_app (template_hole 3, template_var 2),
                     template_app
                      (template_app
                        (template_app (template_hole 2, template_hole 1),
                         template_hole 1),
                       template_var 1)),
                   t_empty),
                 template_var 0)),
             template_app
              (template_app
                (template_app
                  (template_app (template_hole 3, template_var 2),
                   template_app
                    (template_app
                      (template_app (template_hole 2, template_hole 1),
                       template_hole 1),
                     template_var 1)),
                 t_empty),
               template_var 0))
           ))),
    ("Refine_Foreach.LIST_FOREACH'_transfer_nres",
     "[| nres_of ?tsl <= ?tsl';
         !!x \<sigma>. nres_of (?f x \<sigma>) <= ?f' x \<sigma> |]
      ==> nres_of
           (?tsl >>=
            (%xs. foldli xs (case_dres False False ?c) (%x s. s >>= ?f x)
                   (dRETURN ?\<sigma>)))
          <= LIST_FOREACH' ?tsl' ?c ?f' ?\<sigma>",
     template_implication
      ([template_inequation
         (less_equals, template_app (template_hole 11, template_var 5),
          template_var 4),
        template_predicate (template_app (template_hole 10, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_hole 7,
           template_app
            (template_app (template_hole 6, template_var 5), t_empty)),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 4),
               template_var 1),
             template_var 2),
           template_var 0)))),
    ("Refine_Foreach.map_sigma_foreach",
     "[| finite ?A; !!x. x : ?A ==> finite (?B x) |]
      ==> FOREACH ?A
           (%a. FOREACH (?B a)
                 (%b \<sigma>. RETURN (insert (?f (a, b)) \<sigma>)))
           ?R0.0
          <= SPEC ((=) (?R0.0 Un ?f ` Sigma ?A ?B))",
     template_implication
      ([template_predicate
         (template_app (template_hole 15, template_var 3)),
        template_predicate (template_app (template_hole 14, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 10, template_var 3), t_empty),
           template_var 0),
         template_app
          (template_hole 5,
           template_app
            (template_hole 4,
             template_app
              (template_hole 3,
               template_app
                (template_app (template_hole 2, template_var 0),
                 template_app
                  (template_app (template_hole 1, template_var 1),
                   template_app
                    (template_app (template_hole 0, template_var 3),
                     template_var 2))))))))),
    ("Refine_Foreach.foldli_mono_dres_aux2",
     "[| !!x. ?f x dSUCCEED = dSUCCEED; !!x. ?f' x dFAIL = dFAIL;
         !!a x x'. x <= x' ==> ?f a x <= ?f' a x' |]
      ==> foldli ?l (case_dres False False ?c) ?f ?\<sigma>
          <= foldli ?l (case_dres False False ?c) ?f' ?\<sigma>",
     template_implication
      ([template_predicate (template_app (template_hole 9, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 2, template_var 2),
               template_app
                (template_app
                  (template_app (template_hole 1, template_hole 0),
                   template_hole 0),
                 template_var 1)),
             template_var 4),
           template_var 0),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 2, template_var 2),
               template_app
                (template_app
                  (template_app (template_hole 1, template_hole 0),
                   template_hole 0),
                 template_var 1)),
             template_var 3),
           template_var 0)))),
    ("Refine_Foreach.LFO_pre_refine",
     "[| (?li, ?l) : \<langle>?A\<rangle>list_set_rel;
         (?ci, ?c) : ?R \<rightarrow> bool_rel;
         (?fi, ?f)
         : ?A \<rightarrow> ?R \<rightarrow> \<langle>?R\<rangle>nres_rel;
         (?s0i, ?s0.0) : ?R |]
      ==> LIST_FOREACH' (RETURN ?li) ?ci ?fi ?s0i
          <= \<Down> ?R (FOREACH\<^sub>C\<^bsup>?I\<^esup> ?l ?c ?f ?s0.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 26,
                template_app
                 (template_app (template_hole 25, template_var 10),
                  template_var 9)),
              template_app
               (template_app (template_hole 24, template_hole 23),
                template_var 8))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 22,
                template_app
                 (template_app (template_hole 21, template_var 7),
                  template_var 6)),
              template_app
               (template_app
                 (template_hole 20,
                  template_app
                   (template_app (template_hole 19, template_hole 18),
                    template_var 5)),
                template_hole 17))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 4),
                  template_var 3)),
              template_app
               (template_app
                 (template_hole 14,
                  template_app
                   (template_app (template_hole 13, template_hole 12),
                    template_var 8)),
                template_app
                 (template_app
                   (template_hole 11,
                    template_app
                     (template_app (template_hole 10, template_hole 9),
                      template_var 5)),
                  template_app
                   (template_app (template_hole 8, template_hole 7),
                    template_var 5))))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 6,
                template_app
                 (template_app (template_hole 5, template_var 2),
                  template_var 1)),
              template_var 5)
            )],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_hole 3,
                 template_app (template_hole 2, template_var 10)),
               template_var 7),
             template_var 4),
           template_var 2),
         template_app
          (template_app (template_hole 1, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 9),
                 template_var 6),
               template_var 3),
             template_var 1))))),
    ("Refine_Foreach.LFO_refine",
     "[| (?li, ?l) : \<langle>?A\<rangle>list_set_rel;
         !!x xi s si.
            [| (xi, x) : ?A; (si, s) : ?R |]
            ==> ?fi xi si <= \<Down> ?R (?f x s);
         (?s0i, ?s0.0) : ?R |]
      ==> nfoldli ?li (%_. True) ?fi ?s0i
          <= \<Down> ?R (FOREACH ?l ?f ?s0.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 7),
                  template_var 6)),
              template_app
               (template_app (template_hole 14, template_hole 13),
                template_var 5))
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 6,
                template_app
                 (template_app (template_hole 5, template_var 1),
                  template_var 0)),
              template_var 4)
            )],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 2, template_var 7), t_empty),
             template_var 3),
           template_var 1),
         template_app
          (template_app (template_hole 3, template_var 4),
           template_app
            (template_app
              (template_app (template_hole 0, template_var 6),
               template_var 2),
             template_var 0))))),
    ("Refine_Foreach.LFOi_refine",
     "[| (?li, ?l) : \<langle>?A\<rangle>list_set_rel;
         !!x xi s si.
            [| (xi, x) : ?A; (si, s) : ?R |]
            ==> ?fi xi si <= \<Down> ?R (?f x s);
         (?s0i, ?s0.0) : ?R |]
      ==> nfoldli ?li (%_. True) ?fi ?s0i
          <= \<Down> ?R (FOREACH\<^bsup>?I\<^esup> ?l ?f ?s0.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 8),
                  template_var 7)),
              template_app
               (template_app (template_hole 14, template_hole 13),
                template_var 6))
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 6,
                template_app
                 (template_app (template_hole 5, template_var 2),
                  template_var 1)),
              template_var 5)
            )],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 2, template_var 8), t_empty),
             template_var 4),
           template_var 2),
         template_app
          (template_app (template_hole 3, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 0),
                 template_var 7),
               template_var 3),
             template_var 1))))),
    ("Refine_Foreach.FOREACH_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma> |]
      ==> FOREACH ?S ?f ?\<sigma>0.0 <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 12, template_var 4)),
        template_predicate
         (
            template_app
             (template_app (template_var 3, template_var 4), template_var 2)
            ),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 0, template_var 4),
             template_var 1),
           template_var 2),
         template_app
          (template_hole 5,
           template_app (template_hole 4, template_var 0))))),
    ("Refine_Foreach.FOREACHi_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma> |]
      ==> FOREACH\<^bsup>?I\<^esup> ?S ?f ?\<sigma>0.0 <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 12, template_var 4)),
        template_predicate
         (
            template_app
             (template_app (template_var 3, template_var 4), template_var 2)
            ),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 3),
               template_var 4),
             template_var 1),
           template_var 2),
         template_app
          (template_hole 5,
           template_app (template_hole 4, template_var 0))))),
    ("Refine_Foreach.nfoldli_refine",
     "[| (?li, ?l) : \<langle>?S\<rangle>list_rel; (?si, ?s) : ?R;
         (?ci, ?c) : ?R \<rightarrow> bool_rel;
         !!xi x si s.
            [| (xi, x) : ?S; (si, s) : ?R; ?c s |]
            ==> ?fi xi si <= \<Down> ?R (?f x s) |]
      ==> nfoldli ?li ?ci ?fi ?si <= \<Down> ?R (nfoldli ?l ?c ?f ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 21,
                template_app
                 (template_app (template_hole 20, template_var 9),
                  template_var 8)),
              template_app
               (template_app (template_hole 19, template_hole 18),
                template_var 7))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 6),
                  template_var 5)),
              template_var 4)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 15,
                template_app
                 (template_app (template_hole 14, template_var 3),
                  template_var 2)),
              template_app
               (template_app
                 (template_hole 13,
                  template_app
                   (template_app (template_hole 12, template_hole 11),
                    template_var 4)),
                template_hole 10))
            ),
        template_predicate (template_app (template_hole 9, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 3),
             template_var 1),
           template_var 6),
         template_app
          (template_app (template_hole 2, template_var 4),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 8),
                 template_var 2),
               template_var 0),
             template_var 5))))),
    ("Refine_Foreach.map_sigma_sigma_foreach",
     "[| finite ?A; !!a. a : ?A ==> finite (?B a);
         !!a b. [| a : ?A; b : ?B a |] ==> finite (?C a b) |]
      ==> FOREACH ?A
           (%a. FOREACH (?B a)
                 (%b. FOREACH (?C a b)
                       (%c \<sigma>.
                           RETURN (insert (?f (a, b, c)) \<sigma>))))
           ?R0.0
          <= SPEC ((=) (?R0.0 Un ?f ` (SIGMA a:?A. Sigma (?B a) (?C a))))",
     template_implication
      ([template_predicate
         (template_app (template_hole 21, template_var 4)),
        template_predicate (template_app (template_hole 20, t_empty)),
        template_predicate (template_app (template_hole 20, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 13, template_var 4), t_empty),
           template_var 0),
         template_app
          (template_hole 6,
           template_app
            (template_hole 5,
             template_app
              (template_hole 4,
               template_app
                (template_app (template_hole 3, template_var 0),
                 template_app
                  (template_app (template_hole 2, template_var 1),
                   template_app
                    (template_app (template_hole 1, template_var 4),
                     t_empty))))))))),
    ("Refine_Foreach.LFOc_refine",
     "[| (?li, ?l) : \<langle>?A\<rangle>list_set_rel;
         !!s si. (si, s) : ?R ==> ?ci si = ?c s;
         !!x xi s si.
            [| (xi, x) : ?A; (si, s) : ?R |]
            ==> ?fi xi si <= \<Down> ?R (?f x s);
         (?s0i, ?s0.0) : ?R |]
      ==> nfoldli ?li ?ci ?fi ?s0i
          <= \<Down> ?R (FOREACH\<^sub>C ?l ?c ?f ?s0.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 9),
                  template_var 8)),
              template_app
               (template_app (template_hole 14, template_hole 13),
                template_var 7))
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 7, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 10,
                template_app
                 (template_app (template_hole 9, template_var 1),
                  template_var 0)),
              template_var 6)
            )],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 5),
             template_var 3),
           template_var 1),
         template_app
          (template_app (template_hole 2, template_var 6),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 8),
                 template_var 4),
               template_var 2),
             template_var 0))))),
    ("Refine_Foreach.foldli_mono_dres_aux1",
     "[| !!\<sigma> \<sigma>'.
            [| \<sigma> <= \<sigma>'; ?c \<sigma> ~= ?c \<sigma>' |]
            ==> \<sigma> = bot | \<sigma>' = top;
         !!x. ?f x bot = bot; !!x. ?f' x top = top; ?\<sigma> <= ?\<sigma>';
         !!a x x'. x <= x' ==> ?f a x <= ?f' a x' |]
      ==> foldli ?l ?c ?f ?\<sigma> <= foldli ?l ?c ?f' ?\<sigma>'",
     template_implication
      ([template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 1, t_empty)),
        template_predicate (template_app (template_hole 1, t_empty)),
        template_inequation (less_equals, template_var 2, template_var 1),
        template_predicate (template_app (template_hole 1, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 5),
             template_var 4),
           template_var 2),
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 0),
               template_var 5),
             template_var 3),
           template_var 1)))),
    ("Refine_Foreach.LFOci_refine",
     "[| (?li, ?l) : \<langle>?A\<rangle>list_set_rel;
         !!s si. (si, s) : ?R ==> ?ci si = ?c s;
         !!x xi s si.
            [| (xi, x) : ?A; (si, s) : ?R |]
            ==> ?fi xi si <= \<Down> ?R (?f x s);
         (?s0i, ?s0.0) : ?R |]
      ==> nfoldli ?li ?ci ?fi ?s0i
          <= \<Down> ?R (FOREACH\<^sub>C\<^bsup>?I\<^esup> ?l ?c ?f ?s0.0)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 10),
                  template_var 9)),
              template_app
               (template_app (template_hole 14, template_hole 13),
                template_var 8))
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 7, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 10,
                template_app
                 (template_app (template_hole 9, template_var 2),
                  template_var 1)),
              template_var 7)
            )],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 10),
               template_var 6),
             template_var 4),
           template_var 2),
         template_app
          (template_app (template_hole 2, template_var 7),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 9),
                 template_var 5),
               template_var 3),
             template_var 1))))),
    ("Refine_Foreach.FOREACHoi_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma>; ALL y:it - {x}. ?R x y;
               ALL y:?S - it. ?R y x |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>O\<^bsup>?R,?I\<^esup> ?S ?f ?\<sigma>0.0
          <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 13, template_var 5)),
        template_predicate
         (
            template_app
             (template_app (template_var 4, template_var 5), template_var 3)
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 4),
               template_var 5),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 2,
           template_app (template_hole 1, template_var 0))))),
    ("Refine_Foreach.FOREACHc_refines_FOREACHcd",
     "[| finite ?s'; (?s', ?s) : \<langle>?S\<rangle>set_rel;
         single_valued ?S; (?\<sigma>', ?\<sigma>) : ?R;
         !!\<sigma>' \<sigma>.
            (\<sigma>', \<sigma>) : ?R ==>
            (?c' \<sigma>', ?c \<sigma>) : bool_rel;
         !!x' x \<sigma>' \<sigma>.
            [| (x', x) : ?S; (\<sigma>', \<sigma>) : ?R |]
            ==> ?f' x' \<sigma>' <= \<Down> ?R (?f x \<sigma>) |]
      ==> FOREACH\<^sub>C ?s' ?c' ?f' ?\<sigma>'
          <= \<Down> ?R (FOREACHcdi ?I ?s ?c ?f ?\<sigma>)",
     template_implication
      ([template_predicate
         (template_app (template_hole 20, template_var 10)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 19,
                template_app
                 (template_app (template_hole 18, template_var 10),
                  template_var 9)),
              template_app
               (template_app (template_hole 17, template_hole 16),
                template_var 8))
            ),
        template_predicate
         (template_app (template_hole 15, template_var 8)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 14,
                template_app
                 (template_app (template_hole 13, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 7, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 10),
               template_var 4),
             template_var 2),
           template_var 7),
         template_app
          (template_app (template_hole 2, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 9),
                 template_var 3),
               template_var 1),
             template_var 6))))),
    ("Refine_Foreach.FOREACHcd_refine",
     "[| finite ?s'; (?s', ?s) : \<langle>?S\<rangle>set_rel;
         single_valued ?S; (?\<sigma>', ?\<sigma>) : ?R;
         !!\<sigma>' \<sigma>.
            (\<sigma>', \<sigma>) : ?R ==>
            (?c' \<sigma>', ?c \<sigma>) : bool_rel;
         !!x' x \<sigma>' \<sigma>.
            [| (x', x) : ?S; (\<sigma>', \<sigma>) : ?R |]
            ==> ?f' x' \<sigma>' <= \<Down> ?R (?f x \<sigma>) |]
      ==> FOREACHcd ?s' ?c' ?f' ?\<sigma>'
          <= \<Down> ?R (FOREACHcdi ?I ?s ?c ?f ?\<sigma>)",
     template_implication
      ([template_predicate
         (template_app (template_hole 20, template_var 10)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 19,
                template_app
                 (template_app (template_hole 18, template_var 10),
                  template_var 9)),
              template_app
               (template_app (template_hole 17, template_hole 16),
                template_var 8))
            ),
        template_predicate
         (template_app (template_hole 15, template_var 8)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 14,
                template_app
                 (template_app (template_hole 13, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 7, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 10),
               template_var 4),
             template_var 2),
           template_var 7),
         template_app
          (template_app (template_hole 2, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 0),
                   template_var 9),
                 template_var 3),
               template_var 1),
             template_var 6))))),
    ("Refine_Foreach.FOREACH_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH ?S ?f ?\<sigma>0.0
          <= \<Down> ?R (FOREACH ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 19, template_var 7),
              template_var 6)
            ),
        template_equation
         (template_var 5,
          template_app
           (template_app (template_hole 17, template_var 7),
            template_var 6)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 4),
                  template_var 3)),
              template_var 2)
            ),
        template_predicate (template_app (template_hole 14, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 1, template_var 6),
             template_var 1),
           template_var 4),
         template_app
          (template_app (template_hole 2, template_var 2),
           template_app
            (template_app
              (template_app (template_hole 0, template_var 5),
               template_var 0),
             template_var 3))))),
    ("Refine_Foreach.FOREACHc_rule'",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. [| ?I {} \<sigma>; ?c \<sigma> |] ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it <= ?S; ?I it \<sigma>; ~ ?c \<sigma> |] ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0 <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 13, template_var 5)),
        template_predicate
         (
            template_app
             (template_app (template_var 4, template_var 5), template_var 3)
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 6,
           template_app (template_hole 5, template_var 0))))),
    ("Refine_Foreach.FOREACHci_rule'",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. [| ?I {} \<sigma>; ?c \<sigma> |] ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it <= ?S; ?I it \<sigma>; ~ ?c \<sigma> |] ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>C\<^bsup>?I\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 13, template_var 5)),
        template_predicate
         (
            template_app
             (template_app (template_var 4, template_var 5), template_var 3)
            ),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 4),
                 template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 6,
           template_app (template_hole 5, template_var 0))))),
    ("Refine_Foreach.FOREACHc_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it ~= {}; it <= ?S; ?I it \<sigma>; ~ ?c \<sigma> |]
            ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0 <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 14, template_var 5)),
        template_predicate
         (
            template_app
             (template_app (template_var 4, template_var 5), template_var 3)
            ),
        template_predicate (template_app (template_hole 13, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 12, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 7,
           template_app (template_hole 6, template_var 0))))),
    ("Refine_Foreach.FOREACHci_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| x : it; it <= ?S; ?I it \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it ~= {}; it <= ?S; ?I it \<sigma>; ~ ?c \<sigma> |]
            ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>C\<^bsup>?I\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 14, template_var 5)),
        template_predicate
         (
            template_app
             (template_app (template_var 4, template_var 5), template_var 3)
            ),
        template_predicate (template_app (template_hole 13, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 12, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 4),
                 template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 7,
           template_app (template_hole 6, template_var 0))))),
    ("Refine_Foreach.FOREACHi_refine_rcg'",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH ?S ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^bsup>?\<Phi>'\<^esup> ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 19, template_var 8),
              template_var 7)
            ),
        template_equation
         (template_var 6,
          template_app
           (template_app (template_hole 17, template_var 8),
            template_var 7)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 5),
                  template_var 4)),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 14, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 1, template_var 7),
             template_var 1),
           template_var 5),
         template_app
          (template_app (template_hole 2, template_var 3),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 2),
                 template_var 6),
               template_var 0),
             template_var 4))))),
    ("Refine_Foreach.nfoldli_rule",
     "[| ?I [] ?l0.0 ?\<sigma>0.0;
         !!x l1 l2 \<sigma>.
            [| ?l0.0 = l1 @ x # l2; ?I l1 (x # l2) \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (l1 @ [x]) l2);
         !!l1 l2 \<sigma>.
            [| ?l0.0 = l1 @ l2; ?I l1 l2 \<sigma>; ~ ?c \<sigma> |]
            ==> ?P \<sigma>;
         !!\<sigma>.
            [| ?I ?l0.0 [] \<sigma>; ?c \<sigma> |] ==> ?P \<sigma> |]
      ==> nfoldli ?l0.0 ?c ?f ?\<sigma>0.0 <= SPEC ?P",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_var 5, template_hole 11),
                template_var 4),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 4),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 3,
           template_app (template_hole 2, template_var 0))))),
    ("Refine_Foreach.nfoldli_leof_rule",
     "[| ?I [] ?l0.0 ?\<sigma>0.0;
         !!x l1 l2 \<sigma>.
            [| ?l0.0 = l1 @ x # l2; ?I l1 (x # l2) \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> \<le>\<^sub>n SPEC (?I (l1 @ [x]) l2);
         !!l1 l2 \<sigma>.
            [| ?l0.0 = l1 @ l2; ?I l1 l2 \<sigma>; ~ ?c \<sigma> |]
            ==> ?P \<sigma>;
         !!\<sigma>.
            [| ?I ?l0.0 [] \<sigma>; ?c \<sigma> |] ==> ?P \<sigma> |]
      ==> nfoldli ?l0.0 ?c ?f ?\<sigma>0.0 \<le>\<^sub>n SPEC ?P",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_app (template_var 5, template_hole 11),
                template_var 4),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 9, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_predicate
        (
           template_app
            (template_app
              (template_hole 4,
               template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 4),
                     template_var 2),
                   template_var 1),
                 template_var 3)),
             template_app
              (template_hole 3,
               template_app (template_hole 2, template_var 0)))
           ))),
    ("Refine_Foreach.FOREACHcd_rule",
     "[| finite ?S\<^sub>0; ?I {} ?S\<^sub>0 ?\<sigma>\<^sub>0;
         !!S1 S2 x \<sigma>.
            [| ?S\<^sub>0 = insert x (S1 Un S2);
               ?I S1 (insert x S2) \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (insert x S1) S2);
         !!S1 S2 \<sigma>.
            [| ?S\<^sub>0 = S1 Un S2; ?I S1 S2 \<sigma>; ~ ?c \<sigma> |]
            ==> ?\<Phi> \<sigma>;
         !!\<sigma>.
            [| ?I ?S\<^sub>0 {} \<sigma>; ?c \<sigma> |]
            ==> ?\<Phi> \<sigma> |]
      ==> FOREACHcd ?S\<^sub>0 ?c ?f ?\<sigma>\<^sub>0 <= SPEC ?\<Phi>",
     template_implication
      ([template_predicate
         (template_app (template_hole 12, template_var 5)),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_var 4, template_hole 11),
                template_var 5),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 0, template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 3,
           template_app (template_hole 2, template_var 0))))),
    ("Refine_Foreach.FOREACHcdi_rule",
     "[| finite ?S\<^sub>0; ?I {} ?S\<^sub>0 ?\<sigma>\<^sub>0;
         !!S1 S2 x \<sigma>.
            [| ?S\<^sub>0 = insert x (S1 Un S2);
               ?I S1 (insert x S2) \<sigma>; ?c \<sigma> |]
            ==> ?f x \<sigma> <= SPEC (?I (insert x S1) S2);
         !!S1 S2 \<sigma>.
            [| ?S\<^sub>0 = S1 Un S2; ?I S1 S2 \<sigma>; ~ ?c \<sigma> |]
            ==> ?\<Phi> \<sigma>;
         !!\<sigma>.
            [| ?I ?S\<^sub>0 {} \<sigma>; ?c \<sigma> |]
            ==> ?\<Phi> \<sigma> |]
      ==> FOREACHcdi ?I ?S\<^sub>0 ?c ?f ?\<sigma>\<^sub>0 <= SPEC ?\<Phi>",
     template_implication
      ([template_predicate
         (template_app (template_hole 12, template_var 5)),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_var 4, template_hole 11),
                template_var 5),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 10, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 4),
                 template_var 5),
               template_var 2),
             template_var 1),
           template_var 3),
         template_app
          (template_hole 3,
           template_app (template_hole 2, template_var 0))))),
    ("Refine_Foreach.FOREACH_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH ?S ?f ?\<sigma>0.0
          <= \<Down> ?R (FOREACH ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 28, template_var 8),
              template_var 7)
            ),
        template_equation
         (template_var 6,
          template_app
           (template_app (template_hole 26, template_var 8),
            template_var 7)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 25,
                template_app
                 (template_app (template_hole 24, template_var 5),
                  template_var 4)),
              template_var 3)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 2, template_var 7),
                  template_var 5),
                template_app
                 (template_app (template_hole 26, template_var 8),
                  template_var 7)),
              template_var 4)
            ),
        template_predicate (template_app (template_hole 23, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 1, template_var 7),
             template_var 1),
           template_var 5),
         template_app
          (template_app (template_hole 11, template_var 3),
           template_app
            (template_app
              (template_app (template_hole 0, template_var 6),
               template_var 0),
             template_var 4))))),
    ("Refine_Foreach.FOREACHoci_rule'",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| ?c \<sigma>; x : it; it <= ?S; ?I it \<sigma>;
               ALL y:it - {x}. ?R x y; ALL y:?S - it. ?R y x |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. [| ?I {} \<sigma>; ?c \<sigma> |] ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it <= ?S; ?I it \<sigma>; ~ ?c \<sigma>;
               ALL x:it. ALL y:?S - it. ?R y x |]
            ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?I\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 14, template_var 6)),
        template_predicate
         (
            template_app
             (template_app (template_var 5, template_var 6), template_var 4)
            ),
        template_predicate (template_app (template_hole 13, t_empty)),
        template_predicate (template_app (template_hole 11, t_empty)),
        template_predicate (template_app (template_hole 12, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 2),
                   template_var 5),
                 template_var 6),
               template_var 3),
             template_var 1),
           template_var 4),
         template_app
          (template_hole 3,
           template_app (template_hole 2, template_var 0))))),
    ("Refine_Foreach.FOREACHoci_rule",
     "[| finite ?S; ?I ?S ?\<sigma>0.0;
         !!x it \<sigma>.
            [| ?c \<sigma>; x : it; it <= ?S; ?I it \<sigma>;
               ALL y:it - {x}. ?R x y; ALL y:?S - it. ?R y x |]
            ==> ?f x \<sigma> <= SPEC (?I (it - {x}));
         !!\<sigma>. ?I {} \<sigma> ==> ?P \<sigma>;
         !!it \<sigma>.
            [| it ~= {}; it <= ?S; ?I it \<sigma>; ~ ?c \<sigma>;
               ALL x:it. ALL y:?S - it. ?R y x |]
            ==> ?P \<sigma> |]
      ==> FOREACH\<^sub>O\<^sub>C\<^bsup>?R,?I\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= SPEC ?P",
     template_implication
      ([template_predicate
         (template_app (template_hole 15, template_var 6)),
        template_predicate
         (
            template_app
             (template_app (template_var 5, template_var 6), template_var 4)
            ),
        template_predicate (template_app (template_hole 14, t_empty)),
        template_predicate (template_app (template_hole 12, t_empty)),
        template_predicate (template_app (template_hole 13, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 2),
                   template_var 5),
                 template_var 6),
               template_var 3),
             template_var 1),
           template_var 4),
         template_app
          (template_hole 4,
           template_app (template_hole 3, template_var 0))))),
    ("Refine_Foreach.FOREACHc_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?c \<sigma>; ?c' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R (FOREACH\<^sub>C ?S' ?c' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 20, template_var 9),
              template_var 8)
            ),
        template_equation
         (template_var 7,
          template_app
           (template_app (template_hole 18, template_var 9),
            template_var 8)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 6),
                  template_var 5)),
              template_var 4)
            ),
        template_predicate (template_app (template_hole 15, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 8),
               template_var 3),
             template_var 1),
           template_var 6),
         template_app
          (template_app (template_hole 2, template_var 4),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 7),
                 template_var 2),
               template_var 0),
             template_var 5))))),
    ("Refine_Foreach.FOREACH_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; x' = ?\<alpha> x; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R; x : it; x' : it' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            (({}, \<sigma>), {}, \<sigma>') : ?R ==>
            (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH ?S ?f ?\<sigma>0.0
          <= \<Down> ?R' (FOREACH ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 31, template_var 8),
              template_var 7)
            ),
        template_equation
         (template_var 6,
          template_app
           (template_app (template_hole 29, template_var 8),
            template_var 7)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 28,
                template_app
                 (template_app
                   (template_hole 27,
                    template_app
                     (template_app (template_hole 26, template_var 7),
                      template_var 5)),
                  template_app
                   (template_app
                     (template_hole 25,
                      template_app
                       (template_app (template_hole 29, template_var 8),
                        template_var 7)),
                    template_var 4))),
              template_var 3)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 22, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app (template_hole 1, template_var 7),
             template_var 2),
           template_var 5),
         template_app
          (template_app (template_hole 12, template_var 0),
           template_app
            (template_app
              (template_app (template_hole 0, template_var 6),
               template_var 1),
             template_var 4))))),
    ("Refine_Foreach.FOREACHi_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^bsup>?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^bsup>?\<Phi>'\<^esup> ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 19, template_var 9),
              template_var 8)
            ),
        template_equation
         (template_var 7,
          template_app
           (template_app (template_hole 17, template_var 9),
            template_var 8)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 16,
                template_app
                 (template_app (template_hole 15, template_var 6),
                  template_var 5)),
              template_var 4)
            ),
        template_predicate (template_app (template_hole 14, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 2),
               template_var 8),
             template_var 1),
           template_var 6),
         template_app
          (template_app (template_hole 2, template_var 4),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 3),
                 template_var 7),
               template_var 0),
             template_var 5))))),
    ("Refine_Foreach.FOREACHci_refine_rcg'",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>'; ?c \<sigma>;
               ?c' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>C\<^bsup>?\<Phi>'\<^esup> ?S' ?c' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 20, template_var 10),
              template_var 9)
            ),
        template_equation
         (template_var 8,
          template_app
           (template_app (template_hole 18, template_var 10),
            template_var 9)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 15, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 3),
             template_var 1),
           template_var 7),
         template_app
          (template_app (template_hole 2, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 4),
                   template_var 8),
                 template_var 2),
               template_var 0),
             template_var 6))))),
    ("Refine_Foreach.FOREACHc_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               ?c \<sigma>; ?c' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R (FOREACH\<^sub>C ?S' ?c' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 29, template_var 10),
              template_var 9)
            ),
        template_equation
         (template_var 8,
          template_app
           (template_app (template_hole 27, template_var 10),
            template_var 9)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 26,
                template_app
                 (template_app (template_hole 25, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 4, template_var 9),
                  template_var 7),
                template_app
                 (template_app (template_hole 27, template_var 10),
                  template_var 9)),
              template_var 6)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 3),
             template_var 1),
           template_var 7),
         template_app
          (template_app (template_hole 11, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 8),
                 template_var 2),
               template_var 0),
             template_var 6))))),
    ("Refine_Foreach.FOREACHoi_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| ALL y:it - {x}. ?RR x y; x' = ?\<alpha> x; x : it; x' : it';
               it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi> it \<sigma>; ?\<Phi>' it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>O\<^bsup>?RR,?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>O\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 23, template_var 11),
              template_var 10)
            ),
        template_equation
         (template_var 9,
          template_app
           (template_app (template_hole 21, template_var 11),
            template_var 10)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 20,
                template_app
                 (template_app (template_hole 19, template_var 8),
                  template_var 7)),
              template_var 6)
            ),
        template_predicate (template_app (template_hole 18, t_empty)),
        template_predicate (template_app (template_hole 16, t_empty)),
        template_predicate (template_app (template_hole 18, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 5),
                 template_var 2),
               template_var 10),
             template_var 1),
           template_var 8),
         template_app
          (template_app (template_hole 2, template_var 6),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 4),
                   template_var 3),
                 template_var 9),
               template_var 0),
             template_var 7))))),
    ("Refine_Foreach.FOREACHi_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH\<^bsup>?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^bsup>?\<Phi>'\<^esup> ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 28, template_var 10),
              template_var 9)
            ),
        template_equation
         (template_var 8,
          template_app
           (template_app (template_hole 26, template_var 10),
            template_var 9)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 25,
                template_app
                 (template_app (template_hole 24, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 4, template_var 9),
                  template_var 7),
                template_app
                 (template_app (template_hole 26, template_var 10),
                  template_var 9)),
              template_var 6)
            ),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 2),
               template_var 9),
             template_var 1),
           template_var 7),
         template_app
          (template_app (template_hole 11, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 3),
                 template_var 8),
               template_var 0),
             template_var 6))))),
    ("Refine_Foreach.FOREACHci_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi> it \<sigma>;
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ?c \<sigma>; ?c' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>C\<^bsup>?\<Phi>\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>C\<^bsup>?\<Phi>'\<^esup> ?S' ?c' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 20, template_var 11),
              template_var 10)
            ),
        template_equation
         (template_var 9,
          template_app
           (template_app (template_hole 18, template_var 11),
            template_var 10)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 17,
                template_app
                 (template_app (template_hole 16, template_var 8),
                  template_var 7)),
              template_var 6)
            ),
        template_predicate (template_app (template_hole 15, t_empty)),
        template_predicate (template_app (template_hole 15, t_empty)),
        template_predicate (template_app (template_hole 8, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 4),
                 template_var 10),
               template_var 3),
             template_var 1),
           template_var 8),
         template_app
          (template_app (template_hole 2, template_var 6),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 5),
                   template_var 9),
                 template_var 2),
               template_var 0),
             template_var 7))))),
    ("Refine_Foreach.FOREACHi_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; x' = ?\<alpha> x;
               it' = ?\<alpha> ` it; ((it, \<sigma>), it', \<sigma>') : ?R;
               x : it; x' : it' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            [| ?\<Phi> {} \<sigma>; ?\<Phi>' {} \<sigma>';
               (({}, \<sigma>), {}, \<sigma>') : ?R |]
            ==> (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH\<^bsup>?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R'
              (FOREACH\<^bsup>?\<Phi>'\<^esup> ?S' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 31, template_var 10),
              template_var 9)
            ),
        template_equation
         (template_var 8,
          template_app
           (template_app (template_hole 29, template_var 10),
            template_var 9)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 28,
                template_app
                 (template_app
                   (template_hole 27,
                    template_app
                     (template_app (template_hole 26, template_var 9),
                      template_var 7)),
                  template_app
                   (template_app
                     (template_hole 25,
                      template_app
                       (template_app (template_hole 29, template_var 10),
                        template_var 9)),
                    template_var 6))),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 18, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 3),
               template_var 9),
             template_var 2),
           template_var 7),
         template_app
          (template_app (template_hole 12, template_var 0),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 4),
                 template_var 8),
               template_var 1),
             template_var 6))))),
    ("Refine_Foreach.nfoldli_invar_refine",
     "[| (?li, ?l) : \<langle>?S\<rangle>list_rel; (?si, ?s) : ?R;
         ?I [] ?li ?si;
         !!l1i l2i l1 l2 si s.
            [| ?li = l1i @ l2i; ?l = l1 @ l2;
               (l1i, l1) : \<langle>?S\<rangle>list_rel;
               (l2i, l2) : \<langle>?S\<rangle>list_rel; ?I l1i l2i si;
               (si, s) : ?R |]
            ==> (?ci si, ?c s) : bool_rel;
         !!l1i xi l2i si.
            [| ?li = l1i @ xi # l2i; ?I l1i (xi # l2i) si |]
            ==> ?fi xi si \<le>\<^sub>n SPEC (?I (l1i @ [xi]) l2i);
         !!l1i xi l2i l1 x l2 si s.
            [| ?li = l1i @ xi # l2i; ?l = l1 @ x # l2;
               (l1i, l1) : \<langle>?S\<rangle>list_rel; (xi, x) : ?S;
               (l2i, l2) : \<langle>?S\<rangle>list_rel;
               ?I l1i (xi # l2i) si; (si, s) : ?R |]
            ==> ?fi xi si <= \<Down> ?R (?f x s) |]
      ==> nfoldli ?li ?ci ?fi ?si <= \<Down> ?R (nfoldli ?l ?c ?f ?s)",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app
               (template_hole 30,
                template_app
                 (template_app (template_hole 29, template_var 10),
                  template_var 9)),
              template_app
               (template_app (template_hole 28, template_hole 27),
                template_var 8))
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 26,
                template_app
                 (template_app (template_hole 25, template_var 7),
                  template_var 6)),
              template_var 5)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app (template_var 4, template_hole 24),
                template_var 10),
              template_var 7)
            ),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 10),
               template_var 3),
             template_var 1),
           template_var 7),
         template_app
          (template_app (template_hole 2, template_var 5),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 9),
                 template_var 2),
               template_var 0),
             template_var 6))))),
    ("Refine_Foreach.FOREACHoi_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| ALL y:it - {x}. ?RR x y; x' = ?\<alpha> x; x : it; x' : it';
               it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi> it \<sigma>; ?\<Phi>' it' \<sigma>';
               ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>O\<^bsup>?RR,?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>O\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 29, template_var 12),
              template_var 11)
            ),
        template_equation
         (template_var 10,
          template_app
           (template_app (template_hole 27, template_var 12),
            template_var 11)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 26,
                template_app
                 (template_app (template_hole 25, template_var 9),
                  template_var 8)),
              template_var 7)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 4, template_var 11),
                  template_var 9),
                template_app
                 (template_app (template_hole 27, template_var 12),
                  template_var 11)),
              template_var 8)
            ),
        template_predicate (template_app (template_hole 22, t_empty)),
        template_predicate (template_app (template_hole 24, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 6),
                 template_var 2),
               template_var 11),
             template_var 1),
           template_var 9),
         template_app
          (template_app (template_hole 8, template_var 7),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 5),
                   template_var 3),
                 template_var 10),
               template_var 0),
             template_var 8))))),
    ("Refine_Foreach.FOREACHoci_refine_rcg",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi> it \<sigma>;
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| ALL y:it - {x}. ?RR x y; x' = ?\<alpha> x; x : it; x' : it';
               it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi> it \<sigma>; ?\<Phi>' it' \<sigma>'; ?c \<sigma>;
               ?c' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma> <= \<Down> ?R (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?\<Phi>\<^esup> ?S ?c ?f
           ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>O\<^sub>C\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?c'
                ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 24, template_var 13),
              template_var 12)
            ),
        template_equation
         (template_var 11,
          template_app
           (template_app (template_hole 22, template_var 13),
            template_var 12)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 21,
                template_app
                 (template_app (template_hole 20, template_var 10),
                  template_var 9)),
              template_var 8)
            ),
        template_predicate (template_app (template_hole 19, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty)),
        template_predicate (template_app (template_hole 19, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 1, template_var 7),
                   template_var 4),
                 template_var 12),
               template_var 3),
             template_var 1),
           template_var 10),
         template_app
          (template_app (template_hole 2, template_var 8),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 6),
                     template_var 5),
                   template_var 11),
                 template_var 2),
               template_var 0),
             template_var 9))))),
    ("Refine_Foreach.FOREACHci_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               ?\<Phi> it \<sigma>; (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| x' = ?\<alpha> x; x : it; x' : it'; it' = ?\<alpha> ` it;
               it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               ?c \<sigma>; ?c' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>C\<^bsup>?\<Phi>\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>C\<^bsup>?\<Phi>'\<^esup> ?S' ?c' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 29, template_var 12),
              template_var 11)
            ),
        template_equation
         (template_var 10,
          template_app
           (template_app (template_hole 27, template_var 12),
            template_var 11)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 26,
                template_app
                 (template_app (template_hole 25, template_var 9),
                  template_var 8)),
              template_var 7)
            ),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 6, template_var 11),
                  template_var 9),
                template_app
                 (template_app (template_hole 27, template_var 12),
                  template_var 11)),
              template_var 8)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 17, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 4),
                 template_var 11),
               template_var 3),
             template_var 1),
           template_var 9),
         template_app
          (template_app (template_hole 11, template_var 7),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 5),
                   template_var 10),
                 template_var 2),
               template_var 0),
             template_var 8))))),
    ("Refine_Foreach.FOREACHc_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; x' = ?\<alpha> x; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R; x : it; x' : it';
               ?c \<sigma>; ?c' \<sigma>' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            (({}, \<sigma>), {}, \<sigma>') : ?R ==>
            (\<sigma>, \<sigma>') : ?R';
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R; it ~= {}; it' ~= {};
               ~ ?c \<sigma>; ~ ?c' \<sigma>' |]
            ==> (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH\<^sub>C ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R' (FOREACH\<^sub>C ?S' ?c' ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 34, template_var 10),
              template_var 9)
            ),
        template_equation
         (template_var 8,
          template_app
           (template_app (template_hole 32, template_var 10),
            template_var 9)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 31,
                template_app
                 (template_app
                   (template_hole 30,
                    template_app
                     (template_app (template_hole 29, template_var 9),
                      template_var 7)),
                  template_app
                   (template_app
                     (template_hole 28,
                      template_app
                       (template_app (template_hole 32, template_var 10),
                        template_var 9)),
                    template_var 6))),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 27, t_empty)),
        template_predicate (template_app (template_hole 20, t_empty)),
        template_predicate (template_app (template_hole 26, t_empty)),
        template_predicate (template_app (template_hole 27, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app (template_hole 1, template_var 9),
               template_var 4),
             template_var 2),
           template_var 7),
         template_app
          (template_app (template_hole 14, template_var 0),
           template_app
            (template_app
              (template_app
                (template_app (template_hole 0, template_var 8),
                 template_var 3),
               template_var 1),
             template_var 6))))),
    ("Refine_Foreach.FOREACHoci_refine",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         (?\<sigma>0.0, ?\<sigma>0') : ?R;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         ?\<Phi>'' ?S ?\<sigma>0.0 (?\<alpha> ` ?S) ?\<sigma>0';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               ?\<Phi> it \<sigma>; (\<sigma>, \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi>' it' \<sigma>'; ?\<Phi>'' it \<sigma> it' \<sigma>';
               (\<sigma>, \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| ALL y:it - {x}. ?RR x y; x' = ?\<alpha> x; x : it; x' : it';
               it' = ?\<alpha> ` it; it <= ?S; it' <= ?S';
               ?\<Phi> it \<sigma>; ?\<Phi>' it' \<sigma>';
               ?\<Phi>'' it \<sigma> it' \<sigma>'; ?c \<sigma>;
               ?c' \<sigma>'; (\<sigma>, \<sigma>') : ?R |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     (\<sigma>, \<sigma>') : ?R &
                     ?\<Phi>'' (it - {x}) \<sigma> (it' - {x'}) \<sigma>'}
                    (?f' x' \<sigma>') |]
      ==> FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?\<Phi>\<^esup> ?S ?c ?f
           ?\<sigma>0.0
          <= \<Down> ?R
              (FOREACH\<^sub>O\<^sub>C\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?c'
                ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 30, template_var 14),
              template_var 13)
            ),
        template_equation
         (template_var 12,
          template_app
           (template_app (template_hole 28, template_var 14),
            template_var 13)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 27,
                template_app
                 (template_app (template_hole 26, template_var 11),
                  template_var 10)),
              template_var 9)
            ),
        template_predicate (template_app (template_hole 25, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_app
                 (template_app (template_var 6, template_var 13),
                  template_var 11),
                template_app
                 (template_app (template_hole 28, template_var 14),
                  template_var 13)),
              template_var 10)
            ),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty)),
        template_predicate (template_app (template_hole 25, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 1, template_var 8),
                   template_var 4),
                 template_var 13),
               template_var 3),
             template_var 1),
           template_var 11),
         template_app
          (template_app (template_hole 8, template_var 9),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 7),
                     template_var 5),
                   template_var 12),
                 template_var 2),
               template_var 0),
             template_var 10))))),
    ("Refine_Foreach.FOREACHoi_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; x' = ?\<alpha> x;
               it' = ?\<alpha> ` it; ((it, \<sigma>), it', \<sigma>') : ?R;
               x : it; ALL y:it - {x}. ?RR x y; x' : it';
               ALL y':it' - {x'}. ?RR' x' y' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            [| ?\<Phi> {} \<sigma>; ?\<Phi>' {} \<sigma>';
               (({}, \<sigma>), {}, \<sigma>') : ?R |]
            ==> (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH\<^sub>O\<^bsup>?RR,?\<Phi>\<^esup> ?S ?f ?\<sigma>0.0
          <= \<Down> ?R'
              (FOREACH\<^sub>O\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 33, template_var 12),
              template_var 11)
            ),
        template_equation
         (template_var 10,
          template_app
           (template_app (template_hole 31, template_var 12),
            template_var 11)),
        template_predicate (template_app (template_hole 30, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 28,
                template_app
                 (template_app
                   (template_hole 27,
                    template_app
                     (template_app (template_hole 26, template_var 11),
                      template_var 7)),
                  template_app
                   (template_app
                     (template_hole 25,
                      template_app
                       (template_app (template_hole 31, template_var 12),
                        template_var 11)),
                    template_var 6))),
              template_var 5)
            ),
        template_predicate (template_app (template_hole 24, t_empty)),
        template_predicate (template_app (template_hole 30, t_empty)),
        template_predicate (template_app (template_hole 23, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 9),
                 template_var 3),
               template_var 11),
             template_var 2),
           template_var 7),
         template_app
          (template_app (template_hole 6, template_var 0),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 8),
                   template_var 4),
                 template_var 10),
               template_var 1),
             template_var 6))))),
    ("Refine_Foreach.FOREACHci_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               ?\<Phi> it \<sigma>; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; x' = ?\<alpha> x;
               it' = ?\<alpha> ` it; ((it, \<sigma>), it', \<sigma>') : ?R;
               x : it; x' : it'; ?c \<sigma>; ?c' \<sigma>' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            [| ?\<Phi> {} \<sigma>; ?\<Phi>' {} \<sigma>';
               (({}, \<sigma>), {}, \<sigma>') : ?R |]
            ==> (\<sigma>, \<sigma>') : ?R';
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R; it ~= {}; it' ~= {};
               ~ ?c \<sigma>; ~ ?c' \<sigma>' |]
            ==> (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH\<^sub>C\<^bsup>?\<Phi>\<^esup> ?S ?c ?f ?\<sigma>0.0
          <= \<Down> ?R'
              (FOREACH\<^sub>C\<^bsup>?\<Phi>'\<^esup> ?S' ?c' ?f'
                ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 34, template_var 12),
              template_var 11)
            ),
        template_equation
         (template_var 10,
          template_app
           (template_app (template_hole 32, template_var 12),
            template_var 11)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 31,
                template_app
                 (template_app
                   (template_hole 30,
                    template_app
                     (template_app (template_hole 29, template_var 11),
                      template_var 9)),
                  template_app
                   (template_app
                     (template_hole 28,
                      template_app
                       (template_app (template_hole 32, template_var 12),
                        template_var 11)),
                    template_var 8))),
              template_var 7)
            ),
        template_predicate (template_app (template_hole 27, t_empty)),
        template_predicate (template_app (template_hole 27, t_empty)),
        template_predicate (template_app (template_hole 20, t_empty)),
        template_predicate (template_app (template_hole 26, t_empty)),
        template_predicate (template_app (template_hole 27, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app (template_hole 1, template_var 5),
                 template_var 11),
               template_var 4),
             template_var 2),
           template_var 9),
         template_app
          (template_app (template_hole 14, template_var 0),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 0, template_var 6),
                   template_var 10),
                 template_var 3),
               template_var 1),
             template_var 8))))),
    ("Refine_Foreach.FOREACHoci_refine_genR",
     "[| inj_on ?\<alpha> ?S; ?S' = ?\<alpha> ` ?S;
         !!x y.
            [| x : ?S; y : ?S; ?RR x y |]
            ==> ?RR' (?\<alpha> x) (?\<alpha> y);
         ((?S, ?\<sigma>0.0), ?\<alpha> ` ?S, ?\<sigma>0') : ?R;
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               ?\<Phi> it \<sigma>; ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?c \<sigma> = ?c' \<sigma>';
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi>' it' \<sigma>';
               ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R |]
            ==> ?\<Phi> it \<sigma>;
         !!x it \<sigma> x' it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; x' = ?\<alpha> x;
               it' = ?\<alpha> ` it; ((it, \<sigma>), it', \<sigma>') : ?R;
               x : it; ALL y:it - {x}. ?RR x y; x' : it';
               ALL y':it' - {x'}. ?RR' x' y'; ?c \<sigma>; ?c' \<sigma>' |]
            ==> ?f x \<sigma>
                <= \<Down>
                    {(\<sigma>, \<sigma>').
                     ((it - {x}, \<sigma>), it' - {x'}, \<sigma>') : ?R}
                    (?f' x' \<sigma>');
         !!\<sigma> \<sigma>'.
            [| ?\<Phi> {} \<sigma>; ?\<Phi>' {} \<sigma>';
               (({}, \<sigma>), {}, \<sigma>') : ?R |]
            ==> (\<sigma>, \<sigma>') : ?R';
         !!it \<sigma> it' \<sigma>'.
            [| it <= ?S; it' <= ?S'; ?\<Phi> it \<sigma>;
               ?\<Phi>' it' \<sigma>'; ALL x:?S - it. ALL y:it. ?RR x y;
               ALL x:?S' - it'. ALL y:it'. ?RR' x y; it' = ?\<alpha> ` it;
               ((it, \<sigma>), it', \<sigma>') : ?R; it ~= {}; it' ~= {};
               ~ ?c \<sigma>; ~ ?c' \<sigma>' |]
            ==> (\<sigma>, \<sigma>') : ?R' |]
      ==> FOREACH\<^sub>O\<^sub>C\<^bsup>?RR,?\<Phi>\<^esup> ?S ?c ?f
           ?\<sigma>0.0
          <= \<Down> ?R'
              (FOREACH\<^sub>O\<^sub>C\<^bsup>?RR',?\<Phi>'\<^esup> ?S' ?c'
                ?f' ?\<sigma>0')",
     template_implication
      ([template_predicate
         (
            template_app
             (template_app (template_hole 36, template_var 14),
              template_var 13)
            ),
        template_equation
         (template_var 12,
          template_app
           (template_app (template_hole 34, template_var 14),
            template_var 13)),
        template_predicate (template_app (template_hole 33, t_empty)),
        template_predicate
         (
            template_app
             (template_app
               (template_hole 31,
                template_app
                 (template_app
                   (template_hole 30,
                    template_app
                     (template_app (template_hole 29, template_var 13),
                      template_var 9)),
                  template_app
                   (template_app
                     (template_hole 28,
                      template_app
                       (template_app (template_hole 34, template_var 14),
                        template_var 13)),
                    template_var 8))),
              template_var 7)
            ),
        template_predicate (template_app (template_hole 27, t_empty)),
        template_predicate (template_app (template_hole 27, t_empty)),
        template_predicate (template_app (template_hole 33, t_empty)),
        template_predicate (template_app (template_hole 26, t_empty)),
        template_predicate (template_app (template_hole 27, t_empty))],
       template_inequation
        (less_equals,
         template_app
          (template_app
            (template_app
              (template_app
                (template_app
                  (template_app (template_hole 1, template_var 11),
                   template_var 5),
                 template_var 13),
               template_var 4),
             template_var 2),
           template_var 9),
         template_app
          (template_app (template_hole 8, template_var 0),
           template_app
            (template_app
              (template_app
                (template_app
                  (template_app
                    (template_app (template_hole 0, template_var 10),
                     template_var 6),
                   template_var 12),
                 template_var 3),
               template_var 1),
             template_var 8)))))]
